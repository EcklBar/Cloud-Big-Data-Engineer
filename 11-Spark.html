<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apache Spark - ××“×¨×™×š ××§×™×£</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Heebo:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Spark Brand Colors */
            --spark-orange: #E25A1C;
            --spark-dark-orange: #C84A0C;
            --spark-light-orange: #FF6B35;
            --spark-blue: #1E88E5;
            --spark-green: #4CAF50;
            --spark-purple: #7B1FA2;
            --spark-red: #E53935;

            /* UI Colors */
            --primary-dark: #1a1c20;
            --bg-body: #f4f6f8;
            --bg-surface: #ffffff;
            --text-primary: #1a202c;
            --text-secondary: #4a5568;
            --text-tertiary: #718096;
            --border-color: #e2e8f0;

            /* Code */
            --code-bg: #1e293b;
            --code-text: #e2e8f0;

            /* Effects */
            --radius-lg: 16px;
            --radius-md: 8px;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Heebo', 'Inter', sans-serif;
            background: var(--bg-body);
            color: var(--text-primary);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* === HEADER === */
        header {
            background: linear-gradient(135deg, var(--spark-dark-orange) 0%, var(--spark-orange) 100%);
            border-bottom: 2px solid var(--border-color);
            padding: 0 40px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
            box-shadow: var(--shadow-md);
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .brand-logo {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, var(--spark-orange), #FFB74D);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 800;
            font-size: 20px;
            box-shadow: 0 4px 10px rgba(226, 90, 28, 0.3);
        }

        .header-logo {
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 2px;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 5px;
        }

        .brand-text h1 {
            font-size: 1.3rem;
            margin: 0;
            font-weight: 800;
            color: white;
        }

        .brand-text p {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.8);
            margin: 0;
        }

        /* === TABS === */
        .nav-tabs {
            display: flex;
            gap: 10px;
            background: rgba(255, 255, 255, 0.15);
            padding: 6px;
            border-radius: var(--radius-md);
        }

        .nav-item {
            padding: 10px 28px;
            font-size: 0.95rem;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .nav-item.active {
            background: white;
            color: var(--spark-orange);
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        /* === MAIN CONTENT === */
        .main-wrapper {
            flex: 1;
            overflow: hidden;
            position: relative;
        }

        .view-section {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            overflow-y: auto;
            padding: 40px;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .view-section.active {
            display: block;
            opacity: 1;
        }

        /* === CARDS === */
        .content-card {
            background: var(--bg-surface);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            overflow: hidden;
            margin-bottom: 30px;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .content-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .card-header {
            padding: 24px 30px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(to left, #ffffff, #fafafa);
        }

        .card-header h2 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-body {
            padding: 30px;
        }

        /* === INFO BOXES === */
        .info-box, .success-box, .warning-box {
            padding: 20px 25px;
            border-radius: var(--radius-md);
            margin: 20px 0;
            border-right: 4px solid;
            line-height: 1.8;
        }

        .info-box {
            background: rgba(30, 136, 229, 0.1);
            border-color: var(--spark-blue);
        }

        .success-box {
            background: rgba(76, 175, 80, 0.1);
            border-color: var(--spark-green);
        }

        .warning-box {
            background: rgba(226, 90, 28, 0.1);
            border-color: var(--spark-orange);
        }

        /* === FEATURE GRID === */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .feature-card {
            background: white;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 25px;
            text-align: center;
            transition: all 0.3s;
            border-top: 4px solid var(--spark-orange);
        }

        .feature-card:hover {
            border-color: var(--spark-orange);
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }

        .feature-card h4 {
            color: var(--primary-dark);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        /* === CODE BLOCKS === */
        .code-block {
            background: var(--code-bg);
            color: var(--code-text);
            padding: 25px;
            border-radius: var(--radius-md);
            margin: 20px 0;
            overflow-x: auto;
            direction: ltr;
            text-align: left;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.95rem;
            line-height: 2;
            cursor: pointer;
            transition: background 0.3s;
            position: relative;
            white-space: pre-wrap;
            word-wrap: break-word;
            border: 1px solid #334155;
        }

        .code-block:hover {
            background: #2a3142;
            border-color: var(--spark-orange);
        }

        .code-block::before {
            content: 'ğŸ“‹ ×œ×—×¥ ×œ×”×¢×ª×§×”';
            position: absolute;
            top: 8px;
            left: 8px;
            font-size: 0.75rem;
            color: #94a3b8;
            background: #1e293b;
            padding: 4px 10px;
            border-radius: 4px;
            opacity: 0;
            transition: opacity 0.3s;
            border: 1px solid #334155;
        }

        .code-block:hover::before {
            opacity: 1;
        }

        /* Syntax Highlighting */
        .code-block .comment {
            color: #6b7280;
            font-style: italic;
        }

        .code-block .keyword {
            color: #f472b6;
        }

        .code-block .string {
            color: #86efac;
        }

        .code-block .number {
            color: #fbbf24;
        }

        .code-block .function {
            color: #60a5fa;
        }

        /* === THEORY SIDEBAR === */
        .theory-layout {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 0;
            height: 100%;
            max-width: 1400px;
            margin: 0 auto;
        }

        .theory-sidebar {
            background: white;
            border-left: 1px solid var(--border-color);
            padding: 30px 0;
            overflow-y: auto;
        }

        .theory-nav-item {
            padding: 14px 30px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95rem;
            font-weight: 500;
            border-right: 3px solid transparent;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .theory-nav-item:hover {
            background: #f8fafc;
            color: var(--text-primary);
        }

        .theory-nav-item.active {
            background: #fff3e0;
            color: var(--spark-orange);
            border-right-color: var(--spark-orange);
            font-weight: 600;
        }

        .theory-content {
            padding: 40px;
            overflow-y: auto;
        }

        .theory-section {
            display: none;
            animation: fadeIn 0.3s;
        }

        .theory-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .theory-section h1 {
            font-size: 2rem;
            margin-bottom: 25px;
            color: var(--text-primary);
            font-weight: 800;
        }

        .theory-section h2 {
            font-size: 1.5rem;
            margin: 30px 0 20px 0;
            color: var(--text-primary);
            font-weight: 700;
        }

        .theory-section h3 {
            font-size: 1.2rem;
            margin: 25px 0 15px 0;
            color: var(--spark-orange);
            font-weight: 600;
        }

        .theory-section p, .theory-section li {
            line-height: 1.8;
            color: var(--text-secondary);
            margin-bottom: 15px;
        }

        .theory-section ul, .theory-section ol {
            padding-right: 25px;
        }

        /* === EXERCISES === */
        .exercise-list {
            display: flex;
            flex-direction: column;
            gap: 25px;
            max-width: 1000px;
            margin: 0 auto;
        }

        .exercise-card {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s;
        }

        .exercise-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .ex-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            gap: 20px;
        }

        .ex-number {
            background: linear-gradient(135deg, var(--spark-orange), #FFB74D);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 0.8rem;
            box-shadow: 0 2px 6px rgba(226, 90, 28, 0.3);
        }

        .ex-title {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--text-primary);
            flex: 1;
        }

        .ex-content {
            color: var(--text-secondary);
            line-height: 1.8;
        }

        .ex-content ul {
            padding-right: 25px;
            margin: 15px 0;
        }

        .ex-content li {
            margin-bottom: 10px;
        }

        /* === COPY NOTIFICATION === */
        .copy-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--spark-green);
            color: white;
            padding: 12px 20px;
            border-radius: 6px;
            transform: translateX(400px);
            transition: transform 0.3s;
            z-index: 1000;
            box-shadow: var(--shadow-lg);
        }

        .copy-notification.show {
            transform: translateX(0);
        }

        /* === RESPONSIVE === */
        @media (max-width: 768px) {
            .nav-tabs { flex-wrap: wrap; }
            .theory-layout { grid-template-columns: 1fr; }
            .theory-sidebar { display: none; }
            .feature-grid { grid-template-columns: 1fr; }
            header { padding: 0 20px; }
        }

        /* === SCROLLBAR === */
        ::-webkit-scrollbar { width: 10px; height: 10px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e0; border-radius: 5px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* === DARK MODE === */
        body.dark-mode {
            --bg-body: #1a1c20;
            --bg-surface: #2d3748;
            --text-primary: #e2e8f0;
            --text-secondary: #cbd5e1;
            --text-tertiary: #94a3b8;
            --border-color: #4a5568;
            background: #1a1c20;
            color: #e2e8f0;
        }

        body.dark-mode .content-card {
            background: #2d3748;
            border-color: #4a5568;
        }

        body.dark-mode .card-header {
            background: linear-gradient(to left, #2d3748, #374151);
        }

        body.dark-mode .code-block {
            background: #1e293b;
            border-color: #475569;
        }

        body.dark-mode .info-box {
            background: rgba(30, 136, 229, 0.15);
        }

        body.dark-mode .success-box {
            background: rgba(76, 175, 80, 0.15);
        }

        body.dark-mode .warning-box {
            background: rgba(226, 90, 28, 0.15);
        }

        body.dark-mode .theory-sidebar {
            background: #2d3748;
            border-color: #4a5568;
        }

        body.dark-mode .theory-nav-item:hover {
            background: #374151;
        }

        body.dark-mode .theory-nav-item.active {
            background: rgba(226, 90, 28, 0.2);
        }

        body.dark-mode .exercise-card {
            background: #2d3748;
            border-color: #4a5568;
        }

        body.dark-mode #searchBar {
            background: #2d3748;
            border-color: #4a5568;
        }

        body.dark-mode #searchInput {
            background: #374151;
            color: #e2e8f0;
            border-color: #4a5568;
        }

        /* === SEARCH RESULTS === */
        .search-result-item {
            padding: 12px;
            margin: 8px 0;
            background: #f8f9fa;
            border-radius: 8px;
            border-right: 4px solid var(--spark-orange);
            cursor: pointer;
            transition: all 0.3s;
        }

        .search-result-item:hover {
            background: #e9ecef;
            transform: translateX(-4px);
        }

        body.dark-mode .search-result-item {
            background: #374151;
        }

        body.dark-mode .search-result-item:hover {
            background: #4b5563;
        }

        .search-highlight {
            background: #ffd700;
            color: #000;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: 600;
        }

        /* === SOLUTION TOGGLE === */
        .solution-toggle {
            margin: 20px 0;
            padding: 15px;
            background: linear-gradient(135deg, var(--spark-orange), #FFB74D);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1rem;
            width: 100%;
            transition: all 0.3s;
            font-family: 'Heebo', sans-serif;
        }

        .solution-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(226, 90, 28, 0.4);
        }

        .solution-content {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: rgba(76, 175, 80, 0.1);
            border-right: 4px solid var(--spark-green);
            border-radius: 8px;
        }

        .solution-content.show {
            display: block;
            animation: fadeIn 0.3s;
        }
    </style>
</head>
<body>

<header>
    <div class="brand">
        <div class="brand-logo">âš¡</div>
        <div class="brand-text">
            <div class="header-logo">BIG DATA PROCESSING</div>
            <h1>Apache Spark - ××“×¨×™×š ××§×™×£</h1>
            <p>×¢×™×‘×•×“ × ×ª×•× ×™× ××‘×•×–×¨ | ××“×¨×™×š ××™× ×˜×¨××§×˜×™×‘×™</p>
        </div>
    </div>

    <div class="nav-tabs">
        <div class="nav-item active" onclick="switchView('theory', this)">ğŸ“š ×ª×™××•×¨×™×”</div>
        <div class="nav-item" onclick="switchView('cheatsheet', this)">ğŸ“‹ Cheat Sheet</div>
        <div class="nav-item" onclick="switchView('rdd', this)">ğŸ”¥ RDD</div>
        <div class="nav-item" onclick="switchView('dataframes', this)">ğŸ“Š DataFrames & SQL</div>
        <div class="nav-item" onclick="switchView('streaming', this)">ğŸŒŠ Streaming</div>
        <div class="nav-item" onclick="switchView('advanced', this)">âš™ï¸ ××ª×§×“×</div>
        <div class="nav-item" onclick="switchView('troubleshooting', this)">ğŸ”§ ×¤×ª×¨×•×Ÿ ×‘×¢×™×•×ª</div>
        <div class="nav-item" onclick="switchView('bestpractices', this)">â­ Best Practices</div>
        <div class="nav-item" onclick="switchView('exercises', this)">ğŸ“ ×ª×¨×’×™×œ×™×</div>
    </div>

    <div style="display: flex; gap: 15px; align-items: center;">
        <button id="darkModeToggle" onclick="toggleDarkMode()" style="background: rgba(255,255,255,0.2); border: none; padding: 10px 20px; border-radius: 8px; color: white; cursor: pointer; font-weight: 600; transition: all 0.3s;">
            ğŸŒ™ ××¦×‘ ×œ×™×œ×”
        </button>
        <button onclick="toggleSearch()" style="background: rgba(255,255,255,0.2); border: none; padding: 10px 20px; border-radius: 8px; color: white; cursor: pointer; font-weight: 600; transition: all 0.3s;">
            ğŸ” ×—×™×¤×•×©
        </button>
    </div>
</header>

<!-- Search Bar -->
<div id="searchBar" style="display: none; background: white; padding: 20px 40px; border-bottom: 2px solid var(--border-color); box-shadow: var(--shadow-md);">
    <div style="max-width: 800px; margin: 0 auto; display: flex; gap: 15px; align-items: center;">
        <input type="text" id="searchInput" placeholder="×—×¤×© ×¤×§×•×“×•×ª, ×¤×•× ×§×¦×™×•×ª, ××• × ×•×©××™×..." style="flex: 1; padding: 12px 20px; font-size: 1rem; border: 2px solid var(--border-color); border-radius: 8px; font-family: 'Heebo', sans-serif;" oninput="performSearch(this.value)">
        <button onclick="toggleSearch()" style="padding: 12px 24px; background: var(--spark-orange); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">×¡×’×•×¨</button>
    </div>
    <div id="searchResults" style="max-width: 800px; margin: 15px auto 0; max-height: 400px; overflow-y: auto;"></div>
</div>

<div class="main-wrapper">

    <!-- === THEORY VIEW === -->
    <div id="view-theory" class="view-section active">
        <div class="theory-layout">
            <aside class="theory-sidebar">
                <div class="theory-nav-item active" onclick="showTheorySection('intro', this)">
                    <span>ğŸ¯</span> ××‘×•× ×œ-Big Data
                </div>
                <div class="theory-nav-item" onclick="showTheorySection('hadoop', this)">
                    <span>ğŸ˜</span> Hadoop Ecosystem
                </div>
                <div class="theory-nav-item" onclick="showTheorySection('spark-intro', this)">
                    <span>âš¡</span> ××‘×•× ×œ-Spark
                </div>
                <div class="theory-nav-item" onclick="showTheorySection('architecture', this)">
                    <span>ğŸ—ï¸</span> ××¨×›×™×˜×§×˜×•×¨×”
                </div>
            </aside>

            <main class="theory-content">
                <!-- ××‘×•× -->
                <div id="theory-intro" class="theory-section active">
                    <h1>ğŸ¯ ××‘×•× ×œ-Big Data</h1>

                    <h2>×’×™×“×•×œ ×‘× ×¤×— ×”× ×ª×•× ×™×</h2>
                    <div class="info-box">
                        <h3>×™×—×™×“×•×ª ××™×“×” ×©×œ × ×ª×•× ×™×</h3>
                        <ul>
                            <li><strong>Gigabyte</strong> - 1,000,000,000 bytes (××™×œ×™××¨×“)</li>
                            <li><strong>Terabyte</strong> - 1,000,000,000,000 bytes (×˜×¨×™×œ×™×•×Ÿ)</li>
                            <li><strong>Petabyte</strong> - 1,000,000,000,000,000 bytes (×§×•×•×“×¨×™×œ×™×•×Ÿ)</li>
                            <li><strong>Exabyte</strong> - 1,000,000,000,000,000,000 bytes</li>
                            <li><strong>Zettabyte</strong> - 1,000,000,000,000,000,000,000 bytes ğŸŒ</li>
                            <li><strong>Yottabyte</strong> - 1,000,000,000,000,000,000,000,000 bytes</li>
                        </ul>
                    </div>

                    <div class="success-box">
                        <h3>ğŸ“ˆ ×’×™×“×•×œ ×”× ×ª×•× ×™× ×‘×¢×•×œ×</h3>
                        <p>×›×™×•×, × ×¤×— ×”× ×ª×•× ×™× ×‘×¢×•×œ× × ××“×“ ×‘-<strong>Zettabytes</strong>.</p>
                        <p>×”×’×™×“×•×œ ×‘××™×¡×•×£ ×•×¢×™×‘×•×“ × ×ª×•× ×™× ××”×™×¨ ×××™ ×¤×¢×, ×•×“×•×¨×© ×›×œ×™× ×—×“×©× ×™×™× ×œ×¢×™×‘×•×“ ×‘×™×¢×™×œ×•×ª.</p>
                    </div>

                    <h2>××ª××•×œ ××•×œ ×”×™×•×</h2>
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4>ğŸ“ ××§×•×¨ ×”× ×ª×•× ×™×</h4>
                            <p><strong>××ª××•×œ:</strong> ××¡×“×™ × ×ª×•× ×™× ××¡×•×¨×ª×™×™×</p>
                            <p><strong>×”×™×•×:</strong> IoT, Social Media, Sensors, Logs</p>
                        </div>
                        <div class="feature-card">
                            <h4>âš¡ ×¦×•×•××¨ ×”×‘×§×‘×•×§</h4>
                            <p><strong>××ª××•×œ:</strong> ×¢×™×‘×•×“ ×¢×œ ×©×¨×ª ×™×—×™×“</p>
                            <p><strong>×”×™×•×:</strong> ×¢×™×‘×•×“ ××‘×•×–×¨ ×¢×œ ×××•×ª/××œ×¤×™ ×©×¨×ª×™×</p>
                        </div>
                        <div class="feature-card">
                            <h4>ğŸ—ï¸ ×”××•×“×œ ×”×—×“×©</h4>
                            <p>×¢×™×‘×•×“ ××‘×•×–×¨ (Distributed Processing)</p>
                            <p>××—×¡×•×Ÿ ××‘×•×–×¨ (Distributed Storage)</p>
                        </div>
                    </div>
                </div>

                <!-- Hadoop -->
                <div id="theory-hadoop" class="theory-section">
                    <h1>ğŸ˜ Hadoop Ecosystem</h1>

                    <div class="info-box">
                        <h3>×¨×›×™×‘×™ Hadoop</h3>
                        <ul>
                            <li><strong>HDFS</strong> - ××¢×¨×›×ª ×§×‘×¦×™× ××‘×•×–×¨×ª ×œ××—×¡×•×Ÿ</li>
                            <li><strong>YARN</strong> - ×× ×”×œ ××©××‘×™× ×•× ×™×”×•×œ Tasks</li>
                            <li><strong>MapReduce</strong> - ××•×“×œ ×¢×™×‘×•×“ ××‘×•×–×¨ (×“×•×¨ ×™×©×Ÿ)</li>
                            <li><strong>ZooKeeper</strong> - × ×™×”×•×œ ×ª×¦×•×¨×” ××¨×›×–×™</li>
                        </ul>
                    </div>

                    <h2>HDFS - Hadoop Distributed File System</h2>
                    <div class="success-box">
                        <h3>×¢×§×¨×•× ×•×ª ×¢×‘×•×“×”</h3>
                        <ul>
                            <li>×§×‘×¦×™× ××¤×•×¦×œ×™× ×œ-<strong>Blocks</strong> (×‘×¨×™×¨×ª ××—×“×œ: 128MB)</li>
                            <li>×›×œ Block ××©×•×›×¤×œ ×¢×œ ××¡×¤×¨ DataNodes (×‘×¨×™×¨×ª ××—×“×œ: 3 ×¢×•×ª×§×™×)</li>
                            <li><strong>NameNode</strong> ×××—×¡×Ÿ ××ª ×”××˜×-×“××˜×”</li>
                            <li><strong>DataNodes</strong> ×××—×¡× ×™× ××ª ×”× ×ª×•× ×™× ×‘×¤×•×¢×œ</li>
                        </ul>
                    </div>

                    <div class="code-block"># ×“×•×’××”: ××‘× ×” HDFS

NameNode (Metadata):
  /logs/031512.log: B1,B2,B3
  /logs/042313.log: B4,B5


Block Locations:
  B1: NodeA, NodeB, NodeD
  B2: NodeB, NodeD, NodeE
  B3: NodeA, NodeB, NodeC
  B4: NodeA, NodeB, NodeE
  B5: NodeC, NodeE, NodeD</div>

                    <h2>YARN - Yet Another Resource Negotiator</h2>
                    <div class="info-box">
                        <h3>×ª×¤×§×™×“×™×</h3>
                        <ul>
                            <li><strong>Resource Manager</strong> - ×× ×”×œ ××©××‘×™× ×¨××©×™</li>
                            <li><strong>Node Manager</strong> - ×× ×”×œ ××©××‘×™× ×‘×›×œ Node</li>
                            <li><strong>Application Master</strong> - ×× ×”×œ ×™×™×©×•× ×¡×¤×¦×™×¤×™</li>
                            <li><strong>Container</strong> - ×™×—×™×“×ª ×”×¨×¦×” ×¢× ××©××‘×™× ××•×§×¦×™×</li>
                        </ul>
                    </div>

                    <div class="warning-box">
                        <h3>âš™ï¸ ×™×ª×¨×•× ×•×ª YARN</h3>
                        <ul>
                            <li>××¤×©×¨×•×ª ×œ×”×¨×™×¥ ××¡×¤×¨ Jobs ×‘××§×‘×™×œ</li>
                            <li>××™× ×˜×’×¨×¦×™×” ×¢× HDFS ×œ×‘×™×¦×•×¢×™× ×˜×•×‘×™×</li>
                            <li>× ×™×”×•×œ ××©××‘×™× ×™×¢×™×œ</li>
                        </ul>
                    </div>

                    <h2>ZooKeeper</h2>
                    <div class="success-box">
                        <h3>×©×™××•×©×™×</h3>
                        <ul>
                            <li><strong>Centralized Configuration</strong> - × ×™×”×•×œ ×ª×¦×•×¨×” ××¨×›×–×™</li>
                            <li><strong>Naming Service</strong> - ×©×™×¨×•×ª ×©××•×ª</li>
                            <li><strong>Synchronization</strong> - ×¡× ×›×¨×•×Ÿ ×‘×™×Ÿ processes</li>
                            <li><strong>Voting System</strong> - ××¢×¨×›×ª ×”×¦×‘×¢×”</li>
                            <li><strong>Majority Strategy</strong> - ×”×—×œ×˜×” ×œ×¤×™ ×¨×•×‘</li>
                            <li><strong>Odd Number of Nodes</strong> - ××¡×¤×¨ ××™-×–×•×’×™ ×©×œ nodes</li>
                        </ul>
                    </div>
                </div>

                <!-- Spark Intro -->
                <div id="theory-spark-intro" class="theory-section">
                    <h1>âš¡ ××‘×•× ×œ-Apache Spark</h1>

                    <div class="info-box">
                        <h3>××”×• Apache Spark?</h3>
                        <p><strong>Apache Spark</strong> ×”×•× ×× ×•×¢ ×× ×œ×™×˜×™×§×” ×××•×—×“ ×œ×¢×™×‘×•×“ × ×ª×•× ×™× ××‘×•×–×¨.</p>
                        <p>Spark ××”×™×¨ ×¤×™ 10-100 ×-MapReduce ×”××¡×•×¨×ª×™!</p>
                    </div>

                    <h2>×ª×›×•× ×•×ª ×¢×™×§×¨×™×•×ª</h2>
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4>âš¡ ××”×™×¨×•×ª</h4>
                            <p>×¢×™×‘×•×“ ××‘×•×¡×¡ ×–×™×›×¨×•×Ÿ (In-Memory)</p>
                        </div>
                        <div class="feature-card">
                            <h4>ğŸŒ ××‘×•×–×¨</h4>
                            <p>Distributed Processing ×¢×œ Cluster</p>
                        </div>
                        <div class="feature-card">
                            <h4>ğŸ’» ×¨×‘-×©×¤×ª×™</h4>
                            <p>Java, Scala, Python, R</p>
                        </div>
                        <div class="feature-card">
                            <h4>ğŸ¦¥ Lazy Execution</h4>
                            <p>××•×¤×˜×™××™×–×¦×™×” ×œ×¤× ×™ ×”×¨×¦×”</p>
                        </div>
                        <div class="feature-card">
                            <h4>ğŸ“Š API ×¢×©×™×¨</h4>
                            <p>RDD, DataFrame, Dataset, SQL</p>
                        </div>
                        <div class="feature-card">
                            <h4>ğŸŒŠ Streaming</h4>
                            <p>×¢×™×‘×•×“ ×–××Ÿ-×××ª</p>
                        </div>
                    </div>

                    <h2>Spark vs MapReduce</h2>
                    <div class="success-box">
                        <h3>Spark ×”×¨×‘×” ×™×•×ª×¨ ×¤×©×•×˜!</h3>
                        <p><strong>MapReduce (Java):</strong> ×“×•×¨×© ×××•×ª ×©×•×¨×•×ª ×§×•×“</p>
                        <p><strong>Spark (Python):</strong> 4 ×©×•×¨×•×ª ×‘×œ×‘×“!</p>
                    </div>

                    <div class="code-block"># Spark Python API - Word Count

text_file = spark.textFile("hdfs://...")

text_file.flatMap(lambda line: line.split()) \
    .map(lambda word: (word, 1)) \
    .reduceByKey(lambda a, b: a+b)</div>

                    <h2>×”×™×¡×˜×•×¨×™×”</h2>
                    <div class="info-box">
                        <ul>
                            <li><strong>2009</strong> - × ×•×œ×“ ×‘-UC Berkeley</li>
                            <li><strong>2012</strong> - ×’×¨×¡××•×ª ×¨××©×•× ×•×ª</li>
                            <li><strong>2016</strong> - Spark 2.0 ×©×•×—×¨×¨</li>
                            <li><strong>×›×™×•×</strong> - Spark 3.x ×¢× ×©×™×¤×•×¨×™× ×¨×‘×™×</li>
                        </ul>
                    </div>

                    <h2>××¤×©×¨×•×™×•×ª ×”×¨×¦×”</h2>
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4>ğŸ’» Local Mode</h4>
                            <p>×”×¨×¦×” ×¢×œ ××—×©×‘ ×™×—×™×“</p>
                            <p>××¦×•×™×Ÿ ×œ×¤×™×ª×•×— ×•×‘×“×™×§×•×ª</p>
                        </div>
                        <div class="feature-card">
                            <h4>â˜ï¸ Cluster Mode</h4>
                            <p>×”×¨×¦×” ×¢×œ Cluster</p>
                            <p>YARN, Kubernetes, Standalone</p>
                        </div>
                    </div>
                </div>

                <!-- Architecture -->
                <div id="theory-architecture" class="theory-section">
                    <h1>ğŸ—ï¸ ××¨×›×™×˜×§×˜×•×¨×ª Spark</h1>

                    <h2>Driver Program</h2>
                    <div class="info-box">
                        <h3>××”×• Driver?</h3>
                        <p>×”-<strong>Driver</strong> ×”×•× ×”×ª×”×œ×™×š ×©××¨×™×¥ ××ª ×¤×•× ×§×¦×™×™×ª main() ×•×™×•×¦×¨ ××ª SparkContext.</p>
                        <ul>
                            <li>×ª×¤×§×™×“ <strong>Master</strong></li>
                            <li>×¢×•×‘×¨ ×¢×œ ×”×§×•×“ ×•×××™×¨ ××•×ª×• ×œ-Tasks</li>
                            <li>××ª×–××Ÿ ×•×× ×˜×¨ Tasks ×¢×œ ×¤× ×™ ×”-Cluster</li>
                            <li>×“×•××” ×œ-JDBC Driver</li>
                        </ul>
                    </div>

                    <h2>Spark ×¢× YARN</h2>
                    <div class="warning-box">
                        <h3>âš ï¸ ×—×©×•×‘ ×××•×“!</h3>
                        <p><strong>×—×œ×§ ××”×§×•×“ ××ª×‘×¦×¢ ×‘-Driver</strong></p>
                        <p><strong>×—×œ×§ ××”×§×•×“ ××ª×‘×¦×¢ ×‘-Cluster</strong></p>
                        <p>×”×‘× ×ª ×”×”×‘×“×œ ×§×¨×™×˜×™×ª ×œ×›×ª×™×‘×ª ×§×•×“ Spark × ×›×•×Ÿ!</p>
                    </div>

                    <h2>×¨×›×™×‘×™× ×‘××¢×¨×›×ª</h2>
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4>ğŸ¯ Driver Program</h4>
                            <p>××¨×™×¥ ××ª main()</p>
                            <p>×™×•×¦×¨ SparkContext</p>
                            <p>××ª×–××Ÿ Tasks</p>
                        </div>
                        <div class="feature-card">
                            <h4>ğŸ“‹ Cluster Manager</h4>
                            <p>×× ×”×œ ××©××‘×™×</p>
                            <p>YARN / Kubernetes / Standalone</p>
                        </div>
                        <div class="feature-card">
                            <h4>âš™ï¸ Executors</h4>
                            <p>××¨×™×¦×™× Tasks</p>
                            <p>×××—×¡× ×™× × ×ª×•× ×™× ×‘×–×™×›×¨×•×Ÿ</p>
                        </div>
                        <div class="feature-card">
                            <h4>ğŸ“¦ Tasks</h4>
                            <p>×™×—×™×“×ª ×¢×‘×•×“×” ×‘×¡×™×¡×™×ª</p>
                            <p>×¨×¦×•×ª ×¢×œ Executors</p>
                        </div>
                    </div>

                    <h2>SparkContext / JavaSparkContext</h2>
                    <div class="success-box">
                        <h3>× ×§×•×“×ª ×”×›× ×™×¡×” ×œ-Spark</h3>
                        <p>SparkContext ×”×•× ×”×›× ×™×¡×” ×”×¨××©×™×ª ×œ×¤×•× ×§×¦×™×•× ×œ×™×•×ª Spark.</p>
                    </div>

                    <div class="code-block"># Python - ×™×¦×™×¨×ª SparkContext
from pyspark import SparkContext

sc = SparkContext(
    master='local[*]',
    appName='my_app'
)</div>

                    <div class="code-block">// Scala - ×™×¦×™×¨×ª SparkContext
import org.apache.spark.SparkContext
import org.apache.spark.SparkConf


val conf = new SparkConf()
    .setAppName("my_app")
    .setMaster("local[*]")

val sc = new SparkContext(conf)</div>

                    <h2>Medallion Architecture - Data Lake Layers</h2>
                    <div class="info-box">
                        <h3>××¨×›×™×˜×§×˜×•×¨×ª ×©×›×‘×•×ª × ×ª×•× ×™×</h3>
                        <p>××¨×›×™×˜×§×˜×•×¨×” ××•×“×¨× ×™×ª ×œ× ×™×”×•×œ × ×ª×•× ×™× ×‘××¢×¨×›×•×ª Big Data, ×”××‘×•×¡×¡×ª ×¢×œ ×©×›×‘×•×ª ××™×›×•×ª ×¢×•×œ×”.</p>
                    </div>

                    <div class="content-card" style="margin: 30px 0; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
                        <div class="card-header" style="background: linear-gradient(135deg, var(--spark-orange), #FFB74D);">
                            <h3 style="color: white; margin: 0;">ğŸ—ï¸ Data Lake Architecture - ×–×¨×™××ª × ×ª×•× ×™× ××œ××”</h3>
                        </div>
                        <div class="card-body">
                            <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; line-height: 1.8; direction: ltr; text-align: left; overflow-x: auto; padding: 20px; background: white; border-radius: 8px;">
<pre style="margin: 0; direction: ltr; text-align: left;">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   <strong style="color: var(--spark-blue);">SYSTEM</strong>   â”‚  ğŸ“Š ××§×•×¨×•×ª × ×ª×•× ×™×
â”‚  (Sources)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                                                  â”‚
       â–¼                                                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    <strong style="color: #8B4513;">BRONZE STORAGE</strong>   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  	<strong style="color: #C0C0C0;">SILVER STORAGE</strong> â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   	<strong style="color: #FFD700;">GOLD STORAGE</strong>   â”‚
â”‚   Raw Data/Logs     â”‚  Clean  â”‚    Transform         â”‚   AGG   â”‚   Business Level    â”‚
â”‚                     â”‚  Parse  â”‚                      â”‚         â”‚                     â”‚
â”‚  ğŸ“„ JSON            â”‚         â”‚  ğŸ“¦ Parquet          â”‚         â”‚  ğŸ“¦ Parquet         â”‚
â”‚  ğŸ“„ CSV             â”‚  using  â”‚  âœ… Schema           â”‚  using  â”‚  âœ… Partitioned     â”‚
â”‚  ğŸ“„ Logs            â”‚  âš¡Spark â”‚  âœ… Validated        â”‚  âš¡Spark â”‚  âœ… Aggregated      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚                                 â”‚
                                          â”‚                                 â”‚
                                          â–¼                                 â–¼
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚     DWH     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  QUERY ENGINE  â”‚
                                   â”‚  (Optional) â”‚                  â”‚                â”‚
                                   â”‚             â”‚                  â”‚  ğŸ” Trino      â”‚
                                   â”‚ Snowflake   â”‚                  â”‚  ğŸ˜ Hive       â”‚
                                   â”‚ Redshift    â”‚                  â”‚  ğŸ¦… Impala     â”‚
                                   â”‚ BigQuery    â”‚                  â”‚  â˜ï¸  Athena    â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚  ğŸ”´ Redshift   â”‚
                                                                    â”‚     Spectrum   â”‚
                                                                    â”‚  â˜ï¸  BigQuery  â”‚
                                                                    â”‚  ğŸ“Š Kusto/ADX  â”‚
                                                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                             â”‚
                                                                             â–¼
                                                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                    â”‚   <strong style="color: var(--spark-green);">BI TOOLS</strong>      â”‚
                                                                    â”‚                 â”‚
                                                                    â”‚  ğŸ“Š Tableau     â”‚
                                                                    â”‚  ğŸ“ˆ Power BI    â”‚
                                                                    â”‚  ğŸ“‰ Looker      â”‚
                                                                    â”‚  ğŸ“± Grafana     â”‚
                                                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

<strong style="color: var(--spark-orange);">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</strong>

<strong>ğŸ’¡ ×”×¢×¨×•×ª ×—×©×•×‘×•×ª:</strong>

<strong style="color: var(--spark-blue);">ğŸ“ Deployment Options:</strong>
  â€¢ â˜ï¸  Cloud          - AWS S3, Azure Data Lake, GCP Cloud Storage
  â€¢ ğŸ¢ On-premise     - HDFS, Local Storage, NAS
  â€¢ ğŸ”€ Hybrid         - ×©×™×œ×•×‘ Cloud + On-premise

<strong style="color: var(--spark-green);">âš¡ Processing Types:</strong>
  â€¢ RT  (Real-time)        - Streaming ×¢× Kafka + Spark Streaming
  â€¢ NRT (Near Real-time)   - Micro-batches ×›×œ ×“×§×•×ª ×¡×¤×•×¨×•×ª
  â€¢ Batch                  - ×¢×™×‘×•×“ ××—×–×•×¨×™ (×©×¢×ª×™/×™×•××™)

<strong style="color: var(--spark-purple);">ğŸ“Š Data Scale:</strong>
  â€¢ Big Data      - Petabytes, ×××•×ª TB
  â€¢ Medium Data   - Terabytes, ×××•×ª GB
  â€¢ Small Data    - Gigabytes

<strong style="color: var(--spark-red);">ğŸ”§ ×˜×›× ×•×œ×•×’×™×•×ª ×¢×™×§×¨×™×•×ª:</strong>
  â€¢ Ingestion:  Kafka, Flume, NiFi, AWS Kinesis
  â€¢ Processing: <strong>Apache Spark</strong> (PySpark/Scala), Flink, Beam
  â€¢ Storage:    HDFS, S3, Azure Data Lake, GCS
  â€¢ Formats:    Parquet, ORC, Avro, Delta Lake
  â€¢ Query:      Trino/Presto, Hive, Athena, BigQuery
</pre>
                            </div>

                            <div class="warning-box" style="margin-top: 20px;">
                                <h3>ğŸ¯ ×œ××” ×”××¨×›×™×˜×§×˜×•×¨×” ×”×–×•?</h3>
                                <ul>
                                    <li><strong>Separation of Concerns</strong> - ×›×œ ×©×›×‘×” ×¢× ××—×¨×™×•×ª ×‘×¨×•×¨×”</li>
                                    <li><strong>Reprocessing</strong> - ××¤×©×¨ ×ª××™×“ ×œ×—×–×•×¨ ×œ-Bronze ×•×œ×¢×‘×“ ××—×“×©</li>
                                    <li><strong>Performance</strong> - Gold ××•×›×Ÿ ×•××”×™×¨ ×œ×©××™×œ×ª×•×ª</li>
                                    <li><strong>Flexibility</strong> - ×§×œ ×œ×”×•×¡×™×£ ×¦×¨×›× ×™× ×—×“×©×™× (BI/ML/Apps)</li>
                                    <li><strong>Cost Effective</strong> - Parquet ×—×•×¡×š ××—×¡×•×Ÿ, Partitioning ×—×•×¡×š ×—×™×©×•×‘</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4>ğŸ¥‰ Bronze Layer</h4>
                            <p><strong>Raw Data / Landing Zone</strong></p>
                            <p>â€¢ × ×ª×•× ×™× ×’×•×œ××™×™× ×›×¤×™ ×©×”×ª×§×‘×œ×•</p>
                            <p>â€¢ ×¤×•×¨××˜: JSON, CSV, Logs</p>
                            <p>â€¢ ×œ×œ× ×˜×¨× ×¡×¤×•×¨××¦×™×•×ª</p>
                            <p>â€¢ Single source of truth</p>
                        </div>
                        <div class="feature-card">
                            <h4>ğŸ¥ˆ Silver Layer</h4>
                            <p><strong>Cleaned & Transformed</strong></p>
                            <p>â€¢ × ×™×§×•×™ ×•×•×œ×™×“×¦×™×”</p>
                            <p>â€¢ ×¤×•×¨××˜: Parquet (××•××œ×¥!)</p>
                            <p>â€¢ Schema enforcement</p>
                            <p>â€¢ Deduplication</p>
                        </div>
                        <div class="feature-card">
                            <h4>ğŸ¥‡ Gold Layer</h4>
                            <p><strong>Business-Level Aggregates</strong></p>
                            <p>â€¢ Aggregations ××•×›× ×™×</p>
                            <p>â€¢ ×¤×•×¨××˜: Parquet + Partitioning</p>
                            <p>â€¢ ××•×›×Ÿ ×œ-BI / Analytics</p>
                            <p>â€¢ ××•×¤×˜×™××œ×™ ×œ×©××™×œ×ª×•×ª</p>
                        </div>
                    </div>

                    <div class="success-box">
                        <h3>ğŸ”„ ×–×¨×™××ª ×”× ×ª×•× ×™×</h3>
                        <ol style="line-height: 2; margin-top: 15px;">
                            <li><strong>Ingestion:</strong> System â†’ Bronze Storage (JSON/CSV)</li>
                            <li><strong>Cleaning/Parsing:</strong> Bronze â†’ Silver (Parquet) ×‘×××¦×¢×•×ª PySpark</li>
                            <li><strong>Aggregation:</strong> Silver â†’ Gold (Parquet Partitioned) ×‘×××¦×¢×•×ª PySpark AGG</li>
                            <li><strong>Consumption:</strong> Gold â†’ Query Engines (Trino, Hive, Impala, Athena, Redshift Spectrum, BigQuery, Kusto/ADX)</li>
                            <li><strong>Analytics:</strong> Query Engines â†’ BI Tools (Tableau, Power BI, Looker)</li>
                            <li><strong>DWH:</strong> ××•×¤×¦×™×” ×œ×”×¢×‘×™×¨ × ×ª×•× ×™× ×œ-Data Warehouse (Snowflake, Redshift, BigQuery)</li>
                        </ol>
                    </div>

                    <div class="warning-box">
                        <h3>ğŸ’¡ Best Practices</h3>
                        <ul>
                            <li><strong>Bronze:</strong> ×©××•×¨ ×”×›×œ - ××¤×©×¨ ×ª××™×“ ×œ×—×–×•×¨ ×œ××§×•×¨</li>
                            <li><strong>Silver:</strong> Parquet + Schema validation - ××”×™×¨ ×œ×§×¨×™××”</li>
                            <li><strong>Gold:</strong> Partitioning ×œ×¤×™ ×©×™××•×© (date, region, category)</li>
                            <li><strong>Cloud/On-premise/Hybrid:</strong> ×”××¨×›×™×˜×§×˜×•×¨×” ×¢×•×‘×“×ª ×‘×›×œ ×”×¡×‘×™×‘×•×ª</li>
                            <li><strong>RT/NRT/Batch:</strong> ×ª×•××š ×‘×›×œ ×“×¤×•×¡×™ ×¢×™×‘×•×“ (Real-time, Near-real-time, Batch)</li>
                            <li><strong>Big Data / Medium Data / Small Data:</strong> × ×™×ª×Ÿ ×œ×”×ª××™× ×œ×›×œ ×¡×§××œ×”</li>
                        </ul>
                    </div>

                    <div class="code-block"># ×“×•×’××” - Pipeline ××œ×

# === BRONZE â†’ SILVER ===
# ×§×¨×™××ª × ×ª×•× ×™× ×’×•×œ××™×™× (JSON)
bronze_df = spark.read.json("/data/bronze/events/")

# × ×™×§×•×™ ×•×•×•×œ×™×“×¦×™×”
silver_df = bronze_df \
    .filter(col("timestamp").isNotNull()) \
    .filter(col("user_id").isNotNull()) \
    .dropDuplicates(["event_id"]) \
    .withColumn("date", to_date(col("timestamp"))) \
    .withColumn("hour", hour(col("timestamp")))

# ×©××™×¨×” ×œ-Silver (Parquet)
silver_df.write \
    .mode("overwrite") \
    .parquet("/data/silver/events/")


# === SILVER â†’ GOLD ===
# ×§×¨×™××” ×-Silver
silver_df = spark.read.parquet("/data/silver/events/")

# Aggregations
gold_df = silver_df \
    .groupBy("date", "event_type", "country") \
    .agg(
        count("*").alias("event_count"),
        countDistinct("user_id").alias("unique_users"),
        avg("session_duration").alias("avg_duration")
    )

# ×©××™×¨×” ×œ-Gold ×¢× Partitioning
gold_df.write \
    .partitionBy("date", "country") \
    .mode("overwrite") \
    .parquet("/data/gold/events_summary/")


# === CONSUMPTION ===
# ×›×¢×ª × ×™×ª×Ÿ ×œ×§×¨×•× ×-Gold ×‘-Trino/Athena/Hive:
# SELECT * FROM events_summary
# WHERE date = '2024-01-01' AND country = 'US'
# â†’ Partition Pruning = ×§×¨×™××” ×¨×§ ×©×œ × ×ª×•× ×™× ×¨×œ×•×•× ×˜×™×™×!</div>
                </div>
            </main>
        </div>
    </div>

    <!-- === RDD VIEW === -->
    <div id="view-rdd" class="view-section">
        <div class="theory-layout">
            <aside class="theory-sidebar">
                <div class="theory-nav-item active" onclick="scrollToSection('rdd-what', this)">
                    <span>ğŸ¯</span> ××”×• RDD?
                </div>
                <div class="theory-nav-item" onclick="scrollToSection('rdd-create', this)">
                    <span>ğŸ“</span> ×™×¦×™×¨×ª RDD
                </div>
                <div class="theory-nav-item" onclick="scrollToSection('rdd-lazy', this)">
                    <span>ğŸ¦¥</span> Lazy Evaluation
                </div>
                <div class="theory-nav-item" onclick="scrollToSection('rdd-pair', this)">
                    <span>ğŸ”‘</span> Pair RDD
                </div>
                <div class="theory-nav-item" onclick="scrollToSection('rdd-transformations', this)">
                    <span>ğŸ”„</span> Transformations vs Actions
                </div>
                <div class="theory-nav-item" onclick="scrollToSection('rdd-partitions', this)">
                    <span>ğŸ“¦</span> Partitioning
                </div>
                <div class="theory-nav-item" onclick="scrollToSection('rdd-issues', this)">
                    <span>âš ï¸</span> ×‘×¢×™×•×ª × ×¤×•×¦×•×ª
                </div>
                <div class="theory-nav-item" onclick="scrollToSection('rdd-broadcast', this)">
                    <span>ğŸ“¡</span> Broadcast & Accumulators
                </div>
            </aside>

            <main class="theory-content">
            <div style="text-align: center; margin-bottom: 50px;">
                <h1 style="font-size: 2.2rem; margin-bottom: 12px; font-weight: 800; color: var(--text-primary);">ğŸ”¥ RDD - Resilient Distributed Dataset</h1>
                <p style="color: var(--text-secondary); font-size: 1.05rem;">××‘× ×” ×”× ×ª×•× ×™× ×”×‘×¡×™×¡×™ ×©×œ Spark</p>
            </div>

            <!-- What is RDD -->
            <div id="rdd-what" class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-orange)">â—</span> ××”×• RDD?</h2>
                </div>
                <div class="card-body">
                    <div class="info-box">
                        <h3>Resilient Distributed Dataset</h3>
                        <ul>
                            <li><strong>Resilient</strong> - ×¢××™×“ ×œ×›×©×œ×™×, ×™×›×•×œ ×œ×”×ª××•×©×©</li>
                            <li><strong>Distributed</strong> - ××‘×•×–×¨ ×¢×œ ×¤× ×™ Cluster</li>
                            <li><strong>Dataset</strong> - ××•×¡×£ × ×ª×•× ×™×</li>
                        </ul>
                        <p style="margin-top: 20px;"><strong>×—×©×•×‘:</strong> RDD ×”×•× <strong>Immutable</strong> (×œ× × ×™×ª×Ÿ ×œ×©×™× ×•×™)!</p>
                    </div>
                </div>
            </div>

            <!-- Creating RDD -->
            <div id="rdd-create" class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-blue)">â—</span> ××™×š ×™×•×¦×¨×™× RDD?</h2>
                </div>
                <div class="card-body">
                    <div class="warning-box">
                        <h3>ğŸ¯ sc.parallelize() vs .rdd - ××” ×”×”×‘×“×œ?</h3>
                        <p style="font-size: 1.05rem; margin-bottom: 20px;"><strong>Short answer: use sc.parallelize(data) ğŸ‘</strong></p>

                        <h4 style="color: var(--spark-orange); margin-top: 20px;">ğŸ“ sc.parallelize(data)</h4>
                        <p><strong>What it is:</strong> Creates an RDD from a local Python collection (list, tuple, etc.).</p>

                        <p style="margin-top: 15px;"><strong>When to use:</strong></p>
                        <ul style="margin-top: 10px;">
                            <li>âœ… You already have data in memory (e.g. a Python list)</li>
                            <li>âœ… Testing, small datasets, demos</li>
                        </ul>

                        <div class="code-block" style="margin-top: 15px;">data = [1, 2, 3, 4]
rdd = sc.parallelize(data)

# You can control partitions:
rdd = sc.parallelize(data, numSlices=4)</div>

                        <h4 style="color: var(--spark-blue); margin-top: 25px;">ğŸ“Š .rdd</h4>
                        <p><strong>What it is:</strong> Converts an existing Spark DataFrame or Dataset into an RDD.</p>

                        <p style="margin-top: 15px;"><strong>When to use:</strong></p>
                        <ul style="margin-top: 10px;">
                            <li>âœ… You already loaded data using Spark (spark.read...)</li>
                            <li>âœ… You need RDD-level operations (low-level transformations)</li>
                        </ul>

                        <div class="code-block" style="margin-top: 15px;">df = spark.read.csv("file.csv", header=True)
rdd = df.rdd</div>

                        <h4 style="color: var(--spark-green); margin-top: 25px;">ğŸ¯ Key difference (TL;DR)</h4>
                        <table style="width: 100%; margin-top: 15px; border-collapse: collapse; font-size: 0.95rem;">
                            <thead style="background: var(--spark-orange); color: white;">
                                <tr>
                                    <th style="padding: 10px; text-align: left; border: 1px solid var(--border-color);">Use case</th>
                                    <th style="padding: 10px; text-align: left; border: 1px solid var(--border-color);">Correct choice</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: white;">You have a Python list</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: #e8f5e9;"><code>sc.parallelize()</code></td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: white;">You have a DataFrame</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: #e8f5e9;"><code>.rdd</code></td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: white;">New RDD from scratch</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: #e8f5e9;"><code>sc.parallelize()</code></td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: white;">Convert DF â†’ RDD</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: #e8f5e9;"><code>.rdd</code></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="success-box">
                        <h3>ğŸ§  Important BI / Data Engineering tip</h3>
                        <p>In real production pipelines (Airflow, Spark on BQ/S3/HDFS):</p>
                        <ul>
                            <li><strong>Prefer DataFrames over RDDs</strong> (optimized by Catalyst & Tungsten)</li>
                            <li><strong>Use RDDs only when you truly need low-level control</strong></li>
                            <li>If loading from files â†’ use <code>spark.read.csv()</code> â†’ DataFrame (not RDD!)</li>
                            <li>If you have Python data â†’ use <code>sc.parallelize()</code> â†’ RDD</li>
                        </ul>
                    </div>

                    <h3>3 ×“×¨×›×™× ×œ×™×¦×™×¨×ª RDD:</h3>

                    <h4 style="margin-top: 25px;">1ï¸âƒ£ ××§×•×‘×¥ ××• ×ª×™×§×™×™×”</h4>
                    <div class="code-block"># ×§×¨×™××” ×-path ×™×—×¡×™ (××©×ª××© ×‘-default fs configuration)
rdd = sc.textFile('/data/sample/table1/')


# ×§×¨×™××” ×-HDFS
rdd = sc.textFile('hdfs://my-hdfs:8020/data/sample/table1/')


# ×§×¨×™××” ×-local filesystem
rdd = sc.textFile('file:///home/my_user/my_data/')


# ×§×¨×™××” ×-S3
rdd = sc.textFile('s3a://spark/data/sample/table1/')


# ×§×¨×™××” ×¨×§ ×©×œ ×§×‘×¦×™ CSV
rdd = sc.textFile('/data/sample/table1/*.csv')</div>

                    <h4 style="margin-top: 25px;">2ï¸âƒ£ ×× ×ª×•× ×™× ×‘×–×™×›×¨×•×Ÿ</h4>
                    <div class="code-block"># Python - Regular RDD
data = [7, 17, 25, 88, 28]
rdd = sc.parallelize(data)


# Python - Key-Value RDD
data = [('avi', 40), ('yossi', 17), ('eli', 8)]
rdd = sc.parallelize(data)</div>

                    <div class="code-block">// Java - Regular RDD
List<Integer> data = Arrays.asList(7, 17, 25, 88, 28);
JavaRDD<Integer> rdd = sc.parallelize(data);


// Java - Key-Value RDD
List<Tuple2<String, Integer>> data = Arrays.asList(
    new Tuple2<>("avi", 40),
    new Tuple2<>("yossi", 17)
);

JavaPairRDD<String, Integer> rdd = sc.parallelizePairs(data);</div>

                    <h4 style="margin-top: 25px;">3ï¸âƒ£ ×-RDD ××—×¨</h4>
                    <div class="success-box">
                        <p>×‘×××¦×¢×•×ª Transformations ×¢×œ RDD ×§×™×™×, × ×•×¦×¨ RDD ×—×“×©.</p>
                    </div>
                </div>
            </div>

            <!-- Lazy Evaluation -->
            <div id="rdd-lazy" class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-orange)">â—</span> Lazy Evaluation</h2>
                </div>
                <div class="card-body">
                    <div class="info-box">
                        <h3>××”×™ Lazy Evaluation?</h3>
                        <p>Spark ×œ× ××‘×¦×¢ Transformations ××™×“ - ×”×•× ×‘×•× ×” ×ª×•×›× ×™×ª ×‘×™×¦×•×¢ (DAG) ×•××‘×¦×¢ ××•×ª×” ×¨×§ ×›××©×¨ Action × ×§×¨×.</p>
                    </div>

                    <div class="success-box">
                        <h3>âœ… ×™×ª×¨×•× ×•×ª</h3>
                        <ul>
                            <li><strong>××•×¤×˜×™××™×–×¦×™×”</strong> - Spark ×™×›×•×œ ×œ××¤×˜× ××ª ×›×œ ×”×ª×•×›× ×™×ª ×œ×¤× ×™ ×”×‘×™×¦×•×¢</li>
                            <li><strong>×™×¢×™×œ×•×ª</strong> - ×”×™×× ×¢×•×ª ××—×™×©×•×‘×™× ××™×•×ª×¨×™×</li>
                            <li><strong>Pipeline Optimization</strong> - ××™×—×•×“ ×¤×¢×•×œ×•×ª</li>
                        </ul>
                    </div>

                    <div class="code-block"># ×›×œ ×”×©×•×¨×•×ª ×”××œ×• ×œ× ××‘×¦×¢×•×ª ×›×œ×•×!
rdd1 = sc.textFile('/data/input.txt')  # Lazy
rdd2 = rdd1.filter(lambda x: len(x) > 0)  # Lazy
rdd3 = rdd2.map(lambda x: x.upper())  # Lazy

# ×¨×§ ×›××Ÿ Spark ××ª×—×™×œ ×œ×¢×‘×•×“ ×‘×¤×•×¢×œ
count = rdd3.count()  # Action - ××¤×¢×™×œ ××ª ×›×œ ×”×‘×™×¦×•×¢!</div>

                    <div class="warning-box">
                        <h3>âš ï¸ ×—×©×•×‘ ×œ×–×›×•×¨</h3>
                        <p>×× ×ª×§×¨× ×œ-Action ×¤×¢××™×™× ×¢×œ ××•×ª×• RDD, ×”×—×™×©×•×‘ ×™×ª×‘×¦×¢ ×¤×¢××™×™×!</p>
                        <p>×œ×›×Ÿ ×›×“××™ ×œ×”×©×ª××© ×‘-<code>cache()</code> ×× ××ª×” ×¦×¨×™×š ××ª ×”×ª×•×¦××” ×™×•×ª×¨ ××¤×¢× ××—×ª.</p>
                    </div>
                </div>
            </div>

            <!-- Pair RDD -->
            <div id="rdd-pair" class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-blue)">â—</span> Pair RDD (Key-Value)</h2>
                </div>
                <div class="card-body">
                    <div class="info-box">
                        <h3>××”×• Pair RDD?</h3>
                        <p><strong>Pair RDD</strong> ×”×•× RDD ×©×œ ×–×•×’×•×ª (Key, Value).</p>
                        <p>×××¤×©×¨ ×¤×¢×•×œ×•×ª ××ª×§×“××•×ª ×›××• groupByKey, reduceByKey, join ×•×¢×•×“.</p>
                    </div>

                    <div class="code-block"># ×™×¦×™×¨×ª Pair RDD
data = [('apple', 5), ('banana', 3), ('apple', 2), ('orange', 8)]
pair_rdd = sc.parallelize(data)

# ××• ×”××¨×” ×-RDD ×¨×’×™×œ
lines = sc.textFile('/data/users.txt')
# ×›×œ ×©×•×¨×”: "John,25"
pairs = lines.map(lambda line: (line.split(',')[0], int(line.split(',')[1])))
# ×ª×•×¦××”: [('John', 25), ('Mary', 30), ...]</div>

                    <h3>×¤×¢×•×œ×•×ª ×¢×œ Pair RDD</h3>
                    <div class="code-block"># reduceByKey - ×¦××¦×•× ×œ×¤×™ ××¤×ª×— (×©×•××¨ ×¢×œ Partitioning!)
word_counts = pairs.reduceByKey(lambda a, b: a + b)

# groupByKey - ×§×™×‘×•×¥ ×¢×¨×›×™× ×œ×¤×™ ××¤×ª×—
grouped = pairs.groupByKey()

# mapValues - map ×¨×§ ×¢×œ ×”×¢×¨×›×™×
doubled = pairs.mapValues(lambda x: x * 2)

# keys / values - ×§×‘×œ×ª ×¨×§ ×”××¤×ª×—×•×ª ××• ×”×¢×¨×›×™×
all_keys = pairs.keys()
all_values = pairs.values()

# sortByKey - ××™×•×Ÿ ×œ×¤×™ ××¤×ª×—
sorted_pairs = pairs.sortByKey(ascending=True)

# join - ×—×™×‘×•×¨ ×©× ×™ Pair RDDs
rdd1.join(rdd2)

# leftOuterJoin / rightOuterJoin
rdd1.leftOuterJoin(rdd2)</div>

                    <div class="warning-box">
                        <h3>âš ï¸ groupByKey vs reduceByKey</h3>
                        <p><strong>groupByKey</strong> - ××¢×‘×™×¨ ××ª ×›×œ ×”× ×ª×•× ×™× ×“×¨×š ×”×¨×©×ª (Shuffle ×›×‘×“!)</p>
                        <p><strong>reduceByKey</strong> - ××‘×¦×¢ ×¦××¦×•× ××§×•××™ ×œ×¤× ×™ Shuffle (×™×¢×™×œ ×™×•×ª×¨!)</p>
                    </div>

                    <div class="code-block"># âŒ ×œ× ×™×¢×™×œ - groupByKey
pairs.groupByKey().mapValues(lambda values: sum(values))

# âœ… ×™×¢×™×œ - reduceByKey
pairs.reduceByKey(lambda a, b: a + b)</div>
                </div>
            </div>

            <!-- Transformations vs Actions -->
            <div id="rdd-transformations" class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-green)">â—</span> Transformations vs Actions</h2>
                </div>
                <div class="card-body">
                    <div class="warning-box">
                        <h3>×©× ×™ ×¡×•×’×™ ×¤×¢×•×œ×•×ª ×‘-RDD</h3>
                        <p><strong>Transformation</strong> - ×ª××™×“ ×¨×¥ ×¢×œ ×”-Cluster, Lazy Evaluation</p>
                        <p><strong>Action</strong> - ××¤×¢×™×œ ×‘×™×¦×•×¢ ×‘×¤×•×¢×œ, ×™×›×•×œ ×œ×”×—×–×™×¨ ×¢×¨×š ×œ-Driver ××• ×œ×›×ª×•×‘ ×œ-Data Store</p>
                    </div>

                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4>ğŸ”„ Transformation</h4>
                            <p>×™×•×¦×¨ RDD ×—×“×©</p>
                            <p>Lazy - ×œ× ××ª×‘×¦×¢ ××™×“</p>
                            <p>×“×•×’×××•×ª: map, filter, flatMap</p>
                        </div>
                        <div class="feature-card">
                            <h4>âš¡ Action</h4>
                            <p>××—×–×™×¨ ×¢×¨×š ××• ×›×•×ª×‘</p>
                            <p>××¤×¢×™×œ ×‘×™×¦×•×¢ ×‘×¤×•×¢×œ</p>
                            <p>×“×•×’×××•×ª: count, collect, save</p>
                        </div>
                    </div>

                    <h3>Transformations × ×¤×•×¦×•×ª:</h3>
                    <div class="code-block"># map - ××™×¤×•×™ ×›×œ ××œ×× ×˜ (1:1)
rdd = sc.parallelize([1, 2, 3, 4])
rdd.map(lambda x: x * 2)  # [2, 4, 6, 8]


# filter - ×¡×™× ×•×Ÿ ××œ×× ×˜×™×
rdd.filter(lambda x: x > 10)  # ×¨×§ ××œ×× ×˜×™× ×’×“×•×œ×™× ×-10


# flatMap - ××™×¤×•×™ ×•×”×©×˜×—×” (1:N)
lines = sc.parallelize(["hello world", "spark rocks"])
words = lines.flatMap(lambda line: line.split())
# ["hello", "world", "spark", "rocks"]


# mapPartitions - ×¢×™×‘×•×“ partition ×©×œ× ×‘×‘×ª ××—×ª (×™×¢×™×œ!)
def process_partition(iterator):
    # ×¤×¢×•×œ×” ×™×§×¨×” ×©× ×¢×©×™×ª ×¤×¢× ××—×ª per partition
    connection = create_db_connection()
    for record in iterator:
        yield process_record(connection, record)
    connection.close()

rdd.mapPartitions(process_partition)


# mapPartitionsWithIndex - ×›××• mapPartitions ×¢× ××¡×¤×¨ partition
def process_with_index(partition_index, iterator):
    yield f"Partition {partition_index}: {sum(iterator)}"

rdd.mapPartitionsWithIndex(process_with_index)


# sample - ×“×’×™××” ××§×¨××™×ª
rdd.sample(withReplacement=False, fraction=0.1)  # 10% ×“×’×™××”


# distinct - ×¢×¨×›×™× ×™×™×—×•×“×™×™× ×‘×œ×‘×“
rdd.distinct()


# union - ××™×—×•×“ ×©× ×™ RDDs (×›×•×œ×œ ×›×¤×™×œ×•×™×•×ª)
rdd1.union(rdd2)


# intersect - ×—×™×ª×•×š (×¢×¨×›×™× ××©×•×ª×¤×™×)
rdd1.intersect(rdd2)


# subtract - ×”×¤×¨×© (×¢×¨×›×™× ×‘-rdd1 ×©×œ× ×‘-rdd2)
rdd1.subtract(rdd2)


# === Pair RDD Transformations ===

# reduceByKey - ×¦××¦×•× ×œ×¤×™ ××¤×ª×— (×™×¢×™×œ!)
pairs.reduceByKey(lambda a, b: a + b)


# groupByKey - ×§×™×‘×•×¥ ×¢×¨×›×™× ×œ×¤×™ ××¤×ª×— (×¤×—×•×ª ×™×¢×™×œ)
pairs.groupByKey()


# sortByKey - ××™×•×Ÿ ×œ×¤×™ ××¤×ª×—
pairs.sortByKey(ascending=True)


# mapValues - map ×¨×§ ×¢×œ ×”×¢×¨×›×™×
pairs.mapValues(lambda x: x * 2)


# join - ×—×™×‘×•×¨ ×©× ×™ Pair RDDs
rdd1.join(rdd2)  # Inner Join
rdd1.leftOuterJoin(rdd2)
rdd1.rightOuterJoin(rdd2)


# cogroup - ×§×™×‘×•×¥ ××©× ×™ RDDs
rdd1.cogroup(rdd2)</div>

                    <h3>Actions × ×¤×•×¦×•×ª:</h3>
                    <div class="code-block"># count - ×¡×¤×™×¨×ª ××œ×× ×˜×™×
count = rdd.count()  # ××—×–×™×¨ ××¡×¤×¨


# collect - ×”×—×–×¨×ª ×›×œ ×”××œ×× ×˜×™× ×œ-Driver (×–×”×™×¨×•×ª! ×¨×§ ×œ× ×ª×•× ×™× ×§×˜× ×™×)
data = rdd.collect()  # ××—×–×™×¨ list


# take - ×”×—×–×¨×ª N ××œ×× ×˜×™× ×¨××©×•× ×™×
first_5 = rdd.take(5)  # ××—×–×™×¨ list ×©×œ 5 ××œ×× ×˜×™×


# takeSample - ×“×’×™××” ××§×¨××™×ª
sample = rdd.takeSample(withReplacement=False, num=10)


# takeOrdered - N ××œ×× ×˜×™× ×”×§×˜× ×™× ×‘×™×•×ª×¨ (×××•×™×™× ×™×)
smallest_5 = rdd.takeOrdered(5)
largest_5 = rdd.takeOrdered(5, key=lambda x: -x)  # ×”×¤×•×š


# first - ×”×—×–×¨×ª ××œ×× ×˜ ×¨××©×•×Ÿ
first = rdd.first()


# reduce - ×¦××¦×•× ×œ×¢×¨×š ×™×—×™×“
sum_all = rdd.reduce(lambda a, b: a + b)
max_value = rdd.reduce(lambda a, b: a if a > b else b)


# fold - ×›××• reduce ××‘×œ ×¢× ×¢×¨×š ×”×ª×—×œ×ª×™
total = rdd.fold(0, lambda acc, value: acc + value)


# aggregate - aggregation ××ª×§×“×
# aggregate(zeroValue, seqOp, combOp)
sum_and_count = rdd.aggregate(
    (0, 0),  # (sum, count)
    lambda acc, value: (acc[0] + value, acc[1] + 1),  # per partition
    lambda acc1, acc2: (acc1[0] + acc2[0], acc1[1] + acc2[1])  # combine
)
average = sum_and_count[0] / sum_and_count[1]


# foreach - ×‘×™×¦×•×¢ ×¤×¢×•×œ×” ×¢×œ ×›×œ ××œ×× ×˜ (×‘-Executors)
rdd.foreach(lambda x: print(x))  # ×™×•×“×¤×¡ ×‘-Executors, ×œ× ×‘-Driver!


# foreachPartition - ×‘×™×¦×•×¢ ×¤×¢×•×œ×” ×¢×œ partition ×©×œ×
def save_partition(iterator):
    connection = create_db_connection()
    for record in iterator:
        connection.insert(record)
    connection.close()

rdd.foreachPartition(save_partition)


# === ×¤×¢×•×œ×•×ª ×©××™×¨×” ===

# saveAsTextFile - ×©××™×¨×” ×›×§×‘×¦×™ ×˜×§×¡×˜
rdd.saveAsTextFile('/output/path')

# saveAsSequenceFile - Hadoop SequenceFile (Pair RDD)
pair_rdd.saveAsSequenceFile('/output/path')


# === Pair RDD Actions ===

# countByKey - ×¡×¤×™×¨×ª ×¢×¨×›×™× ×œ×›×œ ××¤×ª×—
counts = pair_rdd.countByKey()  # dict: {key: count}


# collectAsMap - ×”××¨×” ×œ-dictionary (×–×”×™×¨×•×ª! ×¨×§ ×œ× ×ª×•× ×™× ×§×˜× ×™×)
result_dict = pair_rdd.collectAsMap()


# lookup - ×§×‘×œ×ª ×›×œ ×”×¢×¨×›×™× ×œ××¤×ª×— ××¡×•×™×
values = pair_rdd.lookup('key1')  # list ×©×œ ×¢×¨×›×™×</div>
                </div>
            </div>

            <!-- Partitioning -->
            <div id="rdd-partitions" class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-purple)">â—</span> Partitioning</h2>
                </div>
                <div class="card-body">
                    <div class="info-box">
                        <h3>××”×• Partition?</h3>
                        <p>RDD ××—×•×œ×§ ×œ-<strong>Partitions</strong> - ×—×œ×§×™× ×œ×•×’×™×™× ×©×œ ×”× ×ª×•× ×™×.</p>
                        <p>×›×œ Partition ××¢×•×‘×“ ×¢×œ Executor ×©×•× ×”.</p>
                    </div>

                    <div class="success-box">
                        <h3>×œ××” ×—×©×•×‘?</h3>
                        <ul>
                            <li><strong>×‘×™×¦×•×¢×™×</strong> - ××¡×¤×¨ Partitions ××©×¤×™×¢ ×¢×œ ××§×‘×™×œ×•×ª</li>
                            <li><strong>×–×™×›×¨×•×Ÿ</strong> - ×›×œ Partition ×¦×¨×™×š ×œ×”×™×›× ×¡ ×œ×–×™×›×¨×•×Ÿ Executor</li>
                            <li><strong>Shuffle</strong> - ×¤×—×•×ª Shuffle = ×‘×™×¦×•×¢×™× ×˜×•×‘×™× ×™×•×ª×¨</li>
                        </ul>
                    </div>

                    <div class="code-block"># ×‘×“×™×§×ª ××¡×¤×¨ Partitions
num_partitions = rdd.getNumPartitions()


# ×©×™× ×•×™ ××¡×¤×¨ Partitions - coalesce (×¨×§ ×”×§×˜× ×”)
rdd = rdd.coalesce(2)


# ×©×™× ×•×™ ××¡×¤×¨ Partitions - repartition (×”×’×“×œ×”/×”×§×˜× ×”)
rdd = rdd.repartition(10)


# ×™×¦×™×¨×ª RDD ×¢× ××¡×¤×¨ Partitions ××•×’×“×¨
rdd = sc.textFile('/path', minPartitions=10)</div>
                </div>
            </div>

            <!-- Common Issues -->
            <div id="rdd-issues" class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-red)">â—</span> ×‘×¢×™×•×ª × ×¤×•×¦×•×ª ×•×¤×ª×¨×•× ×•×ª</h2>
                </div>
                <div class="card-body">
                    <h3>âš ï¸ ×‘×¢×™×•×ª ×–×™×›×¨×•×Ÿ (Out of Memory)</h3>
                    <div class="warning-box">
                        <h3>Container is running beyond physical memory limits</h3>
                        <p>×”×•×“×¢×ª ×©×’×™××” × ×¤×•×¦×”:</p>
                        <code style="display: block; background: #2d2d2d; color: #ff6b6b; padding: 10px; border-radius: 4px; margin: 10px 0;">
Container [container_id] is running beyond physical memory limits.<br>
Current usage: 1.6 GB of 1.4 GB physical memory used.<br>
Killing container.
                        </code>
                    </div>

                    <div class="success-box">
                        <h3>âœ… ×¤×ª×¨×•× ×•×ª</h3>
                        <ul>
                            <li><strong>×”×’×“×œ×ª Executor Memory:</strong> <code>--executor-memory 4g</code></li>
                            <li><strong>×”×’×“×œ×ª Driver Memory:</strong> <code>--driver-memory 4g</code></li>
                            <li><strong>×”×§×˜× ×ª Executor Cores:</strong> <code>--executor-cores 2</code> (×¤×—×•×ª tasks ×‘××§×‘×™×œ)</li>
                            <li><strong>×”×’×“×œ×ª ××¡×¤×¨ Partitions:</strong> ×¤×—×•×ª × ×ª×•× ×™× per task</li>
                            <li><strong>×”×™×× ×¢×•×ª ×-collect():</strong> ××œ ×ª×—×–×™×¨ × ×ª×•× ×™× ×’×“×•×œ×™× ×œ-Driver</li>
                        </ul>
                    </div>

                    <div class="code-block"># ×“×•×’××” ×œ×”×’×“×¨×ª ×–×™×›×¨×•×Ÿ
spark-submit \
    --master yarn \
    --deploy-mode cluster \
    --executor-memory 4g \
    --driver-memory 2g \
    --executor-cores 4 \
    --num-executors 10 \
    my_app.py</div>

                    <h3>âš ï¸ Data Skew (×—×œ×•×§×” ×œ× ××—×™×“×”)</h3>
                    <div class="warning-box">
                        <p>×‘×¢×™×”: ××¤×ª×— ××—×“ ××›×™×œ ×”×¨×‘×” ×™×•×ª×¨ × ×ª×•× ×™× ×××—×¨×™× â†’ Task ××—×“ ×œ×•×§×— ×”×¨×‘×” ×–××Ÿ!</p>
                    </div>

                    <div class="success-box">
                        <h3>âœ… ×¤×ª×¨×•× ×•×ª</h3>
                        <ul>
                            <li><strong>Salting:</strong> ×”×•×¡×¤×ª ××¤×ª×— ××§×¨××™ ×œ×¤×™×–×•×¨</li>
                            <li><strong>Custom Partitioner:</strong> ×—×œ×•×§×” ××•×ª×××ª ××™×©×™×ª</li>
                            <li><strong>Filter + Broadcast:</strong> ×˜×™×¤×•×œ × ×¤×¨×“ ×‘××¤×ª×—×•×ª ×’×“×•×œ×™×</li>
                        </ul>
                    </div>

                    <div class="code-block"># ×“×•×’××” ×œ-Salting (×¤×ª×¨×•×Ÿ ×œ-Data Skew)
from random import randint

# ×”×•×¡×¤×ª salt ×œ××¤×ª×—
def add_salt(key, num_salts=10):
    return f"{key}_{randint(0, num_salts-1)}"

# ×©×™××•×©
salted_rdd = rdd.map(lambda kv: (add_salt(kv[0]), kv[1]))
result = salted_rdd.reduceByKey(lambda a, b: a + b)

# ×”×¡×¨×ª salt
final_result = result.map(lambda kv: (kv[0].split('_')[0], kv[1])) \
                     .reduceByKey(lambda a, b: a + b)</div>

                    <h3>âš ï¸ Shuffle Spill</h3>
                    <div class="warning-box">
                        <p>×›××©×¨ Shuffle ×’×“×•×œ ××“×™, Spark ×›×•×ª×‘ ×œ×“×™×¡×§ â†’ ××™×˜×™!</p>
                    </div>

                    <div class="success-box">
                        <h3>âœ… ×¤×ª×¨×•× ×•×ª</h3>
                        <ul>
                            <li><strong>×”×’×“×œ×ª spark.executor.memory</strong></li>
                            <li><strong>×”×’×“×œ×ª spark.shuffle.memoryFraction</strong></li>
                            <li><strong>×©×™××•×© ×‘-reduceByKey ×‘××§×•× groupByKey</strong></li>
                            <li><strong>Broadcast Join</strong> ×œ×˜×‘×œ××•×ª ×§×˜× ×•×ª</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Broadcast & Accumulators -->
            <div id="rdd-broadcast" class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-purple)">â—</span> Broadcast & Accumulators</h2>
                </div>
                <div class="card-body">
                    <h3>Broadcast Variables</h3>
                    <div class="info-box">
                        <p><strong>Broadcast</strong> ×××¤×©×¨ ×œ×©×ª×£ ××©×ª× ×” read-only ×¢× ×›×œ ×”-Executors ×‘×™×¢×™×œ×•×ª.</p>
                        <p>×‘××§×•× ×œ×©×œ×•×— ××ª ×”××©×ª× ×” ×¢× ×›×œ Task, ×”×•× × ×©×œ×— ×¤×¢× ××—×ª ×œ×›×œ Executor.</p>
                    </div>

                    <div class="code-block"># ×™×¦×™×¨×ª Broadcast Variable
lookup_table = {"key1": "value1", "key2": "value2"}
broadcast_lookup = sc.broadcast(lookup_table)


# ×©×™××•×© ×‘-Broadcast Variable
def enrich_data(x):
    return broadcast_lookup.value.get(x, "unknown")

enriched = rdd.map(enrich_data)</div>

                    <h3>Accumulators</h3>
                    <div class="info-box">
                        <p><strong>Accumulator</strong> ×”×•× ××©×ª× ×” ×©× ×™×ª×Ÿ ×¨×§ ×œ×”×•×¡×™×£ ×œ×• ×¢×¨×›×™× (×‘-Executors) ×•×œ×§×¨×•× (×‘-Driver).</p>
                        <p>×©×™××•×©×™ ×œ×¡×¤×™×¨×•×ª ×•-sums ×¢×œ ×¤× ×™ ×›×œ ×”-Cluster.</p>
                    </div>

                    <div class="code-block"># ×™×¦×™×¨×ª Accumulator
error_counter = sc.accumulator(0)


def process_line(line):
    global error_counter
    try:
        # process line
        return processed_line
    except:
        error_counter.add(1)
        return None


processed = rdd.map(process_line)
processed.count()  # ××¤×¢×™×œ ××ª ×”×—×™×©×•×‘


print(f"Total errors: {error_counter.value}")</div>
                </div>
            </div>

            </main>
        </div>
    </div>

    <!-- === DATAFRAMES VIEW === -->
    <div id="view-dataframes" class="view-section">
        <div class="theory-layout">
            <aside class="theory-sidebar">
                <div class="theory-nav-item active" onclick="scrollToSection('df-intro', this)">
                    <span>ğŸ“Š</span> ××”×• DataFrame?
                </div>
                <div class="theory-nav-item" onclick="scrollToSection('df-create', this)">
                    <span>ğŸ“</span> ×™×¦×™×¨×ª DataFrames
                </div>
                <div class="theory-nav-item" onclick="scrollToSection('df-operations', this)">
                    <span>âš™ï¸</span> ×¤×¢×•×œ×•×ª ×¢×œ DataFrames
                </div>
                <div class="theory-nav-item" onclick="scrollToSection('df-sql', this)">
                    <span>ğŸ”</span> Spark SQL
                </div>
                <div class="theory-nav-item" onclick="scrollToSection('df-udfs', this)">
                    <span>ğŸ”§</span> UDFs
                </div>
                <div class="theory-nav-item" onclick="scrollToSection('df-window', this)">
                    <span>ğŸªŸ</span> Window Functions
                </div>
                <div class="theory-nav-item" onclick="scrollToSection('df-catalyst', this)">
                    <span>âš¡</span> Catalyst Optimizer
                </div>
                <div class="theory-nav-item" onclick="scrollToSection('df-dataset', this)">
                    <span>ğŸ“¦</span> Dataset
                </div>
                <div class="theory-nav-item" onclick="scrollToSection('df-sources', this)">
                    <span>ğŸ’¾</span> Data Sources
                </div>
            </aside>

            <main class="theory-content">
            <div style="text-align: center; margin-bottom: 50px;">
                <h1 style="font-size: 2.2rem; margin-bottom: 12px; font-weight: 800; color: var(--text-primary);">ğŸ“Š DataFrames & Spark SQL</h1>
                <p style="color: var(--text-secondary); font-size: 1.05rem;">×¢×‘×•×“×” ×¢× × ×ª×•× ×™× ××•×‘× ×™×</p>
            </div>

            <!-- DataFrame Intro -->
            <div id="df-intro" class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-orange)">â—</span> ××”×• DataFrame?</h2>
                </div>
                <div class="card-body">
                    <div class="info-box">
                        <h3>DataFrame</h3>
                        <p><strong>DataFrame</strong> ×”×•× RDD ×¢× Schema - ×˜×‘×œ×” ×¢× ×©××•×ª ×¢××•×“×•×ª ×•×˜×™×¤×•×¡×™×.</p>
                        <p>×“×•××” ×œ-Pandas DataFrame ××• ×˜×‘×œ×ª SQL.</p>
                    </div>

                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4>ğŸ“‹ Schema</h4>
                            <p>××‘× ×” ××•×’×“×¨ ×¢× ×¢××•×“×•×ª</p>
                        </div>
                        <div class="feature-card">
                            <h4>âš¡ ××•×¤×˜×™××™×–×¦×™×”</h4>
                            <p>Catalyst Optimizer</p>
                        </div>
                        <div class="feature-card">
                            <h4>ğŸ” SQL</h4>
                            <p>×ª××™×›×” ××œ××” ×‘-SQL</p>
                        </div>
                        <div class="feature-card">
                            <h4>ğŸ“Š API ×¢×©×™×¨</h4>
                            <p>×¤×¢×•×œ×•×ª ×“×•××•×ª ×œ-SQL</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Creating DataFrames -->
            <div id="df-create" class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-blue)">â—</span> ×™×¦×™×¨×ª DataFrames</h2>
                </div>
                <div class="card-body">
                    <h3>SparkSession</h3>
                    <div class="info-box">
                        <p>×‘-Spark 2.0+, <strong>SparkSession</strong> ×”×•× × ×§×•×“×ª ×”×›× ×™×¡×” ×”×××•×—×“×ª.</p>
                    </div>

                    <div class="code-block"># Python - ×™×¦×™×¨×ª SparkSession
from pyspark.sql import SparkSession


spark = SparkSession.builder \
    .appName("my_app") \
    .master("local[*]") \
    .getOrCreate()</div>

                    <h3>×§×¨×™××ª × ×ª×•× ×™×</h3>
                    <div class="code-block"># ×§×¨×™××” ×-CSV
df = spark.read.csv('/path/to/file.csv',
                    header=True,
                    inferSchema=True)


# ×§×¨×™××” ×-JSON
df = spark.read.json('/path/to/file.json')


# ×§×¨×™××” ×-Parquet
df = spark.read.parquet('/path/to/file.parquet')


# ×§×¨×™××” ×-JDBC (Database)
df = spark.read \
    .format("jdbc") \
    .option("url", "jdbc:mysql://localhost:3306/mydb") \
    .option("dbtable", "users") \
    .option("user", "root") \
    .option("password", "password") \
    .load()</div>

                    <h3>×™×¦×™×¨×” ×× ×ª×•× ×™× ×‘×–×™×›×¨×•×Ÿ</h3>
                    <div class="code-block"># Python - ×-list ×©×œ tuples
data = [("Alice", 25), ("Bob", 30), ("Charlie", 35)]
df = spark.createDataFrame(data, ["name", "age"])


# ×-Pandas DataFrame
import pandas as pd

pandas_df = pd.DataFrame({
    "name": ["Alice", "Bob"],
    "age": [25, 30]
})

df = spark.createDataFrame(pandas_df)</div>
                </div>
            </div>

            <!-- DataFrame Operations -->
            <div id="df-operations" class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-green)">â—</span> ×¤×¢×•×œ×•×ª ×¢×œ DataFrames</h2>
                </div>
                <div class="card-body">
                    <h3>×‘×—×™×¨×ª ×¢××•×“×•×ª (Select)</h3>
                    <div class="code-block"># ×‘×—×™×¨×ª ×¢××•×“×•×ª - ×“×¨×›×™× ×©×•× ×•×ª
df.select("name", "age")

df.select(df.name, df.age)

df.select(df["name"], df["age"])


# ×‘×—×™×¨×” ×¢× ×‘×™×˜×•×™×™×
from pyspark.sql.functions import col
from pyspark.sql.types import IntegerType, DoubleType

df.select(col("age") + 1)


# âœ… ×“×•×’××” ××¢×©×™×ª - cast, alias, transformations
airports_df = airports_raw_df.select(
    col('airport_id').cast(IntegerType()).alias('airport_id'),
    col('airport_name').alias('name'),
    col('city'),
    col('country'),
    col('latitude').cast(DoubleType()),
    col('longitude').cast(DoubleType()),
    (col('latitude') + col('longitude')).alias('geo_sum')
)</div>

                    <div class="info-box" style="margin-top: 20px;">
                        <h3>ğŸ’¡ ×˜×™×¤ ×—×©×•×‘ - select ××ª×§×“×</h3>
                        <p><strong>×ª××™×“ ×”×©×ª××© ×‘-col() ×¢× cast() ×•-alias()</strong> ×œ×§×•×“ × ×§×™ ×•××§×¦×•×¢×™!</p>
                        <ul>
                            <li><code>.cast(IntegerType())</code> - ×”××¨×ª ×˜×™×¤×•×¡ × ×ª×•× ×™×</li>
                            <li><code>.alias("new_name")</code> - ×©×™× ×•×™ ×©× ×¢××•×“×”</li>
                            <li><code>col("name")</code> - ×’×™×©×” ×œ×¢××•×“×” (×¢×“×™×£ ×¢×œ df.name)</li>
                        </ul>
                    </div>

                    <h3>×¡×™× ×•×Ÿ (Filter / Where)</h3>
                    <div class="code-block"># ×¡×™× ×•×Ÿ
df.filter(df.age > 25)

df.where(df.age > 25)

df.filter("age > 25")


# ×¡×™× ×•×Ÿ ××•×¨×›×‘
df.filter((df.age > 25) & (df.name.startswith("A")))</div>

                    <h3>×§×™×‘×•×¥ (GroupBy)</h3>
                    <div class="code-block"># ×§×™×‘×•×¥ ×•×¡×¤×™×¨×”
df.groupBy("department").count()


# ×§×™×‘×•×¥ ×¢× aggregations
df.groupBy("department").agg({
    "salary": "avg",
    "age": "max"
})


# ×¢× functions
from pyspark.sql.functions import avg, max, min

df.groupBy("department").agg(
    avg("salary").alias("avg_salary"),
    max("age").alias("max_age")
)</div>

                    <h3>××™×•×Ÿ (OrderBy / Sort)</h3>
                    <div class="code-block"># ××™×•×Ÿ
df.orderBy("age")

df.orderBy(df.age.desc())

df.sort("age", ascending=False)</div>

                    <h3>×”×•×¡×¤×ª ×¢××•×“×•×ª</h3>
                    <div class="code-block"># ×”×•×¡×¤×ª ×¢××•×“×” ×—×“×©×”
from pyspark.sql.functions import lit

df = df.withColumn("new_age", df.age + 1)

df = df.withColumn("country", lit("Israel"))


# ×©×™× ×•×™ ×©× ×¢××•×“×”
df = df.withColumnRenamed("name", "full_name")</div>

                    <h3>Joins</h3>
                    <div class="code-block"># Inner Join
df1.join(df2, df1.id == df2.user_id, "inner")


# Left Join
df1.join(df2, df1.id == df2.user_id, "left")


# Join ×¢×œ ×©× ×¢××•×“×” ×–×”×”
df1.join(df2, "id", "inner")</div>

                    <h3>×”×¦×’×ª × ×ª×•× ×™×</h3>
                    <div class="code-block"># ×”×¦×’×ª ×©×•×¨×•×ª ×¨××©×•× ×•×ª
df.show()

df.show(10)

df.show(10, truncate=False)


# ×”×¦×’×ª Schema
df.printSchema()


# ××™×“×¢ ×¢×œ DataFrame
df.describe().show()


# ×”××¨×” ×œ-Pandas
pandas_df = df.toPandas()</div>
                </div>
            </div>

            <!-- Spark SQL -->
            <div id="df-sql" class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-purple)">â—</span> Spark SQL</h2>
                </div>
                <div class="card-body">
                    <div class="info-box">
                        <h3>×©×™××•×© ×‘-SQL</h3>
                        <p>× ×™×ª×Ÿ ×œ×”×¨×™×¥ ×©××™×œ×ª×•×ª SQL ×™×©×™×¨×•×ª ×¢×œ DataFrames!</p>
                    </div>

                    <div class="code-block"># ×¨×™×©×•× DataFrame ×›×˜×‘×œ×” ×–×× ×™×ª
df.createOrReplaceTempView("users")


# ×”×¨×¦×ª SQL
result = spark.sql("""
    SELECT
        department,
        AVG(salary) as avg_salary
    FROM users
    WHERE age > 25
    GROUP BY department
    ORDER BY avg_salary DESC
""")


result.show()</div>

                    <div class="code-block"># Global Temp View (×–××™× ×” ×‘×™×Ÿ Sessions)
df.createGlobalTempView("global_users")


# ×’×™×©×” ×“×¨×š global_temp
spark.sql("SELECT * FROM global_temp.global_users")</div>

                    <h3>×¤×•× ×§×¦×™×•×ª SQL ××•×‘× ×•×ª</h3>
                    <div class="code-block">from pyspark.sql.functions import *

# String functions
df.select(
    upper(col("name")),
    lower(col("name")),
    length(col("name")),
    concat(col("first_name"), lit(" "), col("last_name")),
    substring(col("name"), 1, 3)
)

# Date functions
df.select(
    current_date(),
    current_timestamp(),
    year(col("date")),
    month(col("date")),
    dayofmonth(col("date")),
    datediff(col("end_date"), col("start_date"))
)

# Aggregation functions
df.select(
    count("*"),
    sum("salary"),
    avg("age"),
    min("age"),
    max("salary"),
    stddev("salary")
)

# Conditional functions
df.select(
    when(col("age") > 65, "Senior")
     .when(col("age") > 18, "Adult")
     .otherwise("Minor")
     .alias("age_group")
)</div>
                </div>
            </div>

            <!-- UDFs -->
            <div id="df-udfs" class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-blue)">â—</span> User Defined Functions (UDFs)</h2>
                </div>
                <div class="card-body">
                    <div class="info-box">
                        <h3>××”×™ UDF?</h3>
                        <p><strong>UDF</strong> ×××¤×©×¨×ª ×œ×”×’×“×™×¨ ×¤×•× ×§×¦×™×” ××•×ª×××ª ××™×©×™×ª ×•×œ×”×©×ª××© ×‘×” ×‘-DataFrames ×•-SQL.</p>
                    </div>

                    <div class="warning-box">
                        <h3>âš ï¸ ×‘×™×¦×•×¢×™×</h3>
                        <p>UDFs ×‘-Python ××™×˜×™×•×ª ×™×•×ª×¨ ××¤×•× ×§×¦×™×•×ª ××•×‘× ×•×ª!</p>
                        <p>×”×Ÿ ×“×•×¨×©×•×ª ×¡×™×¨×™××œ×™×–×¦×™×” Python â†” JVM</p>
                        <p><strong>×ª××™×“ ×”×¢×“×£ ×¤×•× ×§×¦×™×•×ª ××•×‘× ×•×ª ×× ××¤×©×¨!</strong></p>
                    </div>

                    <div class="code-block"># Python UDF - ×“×¨×š 1
from pyspark.sql.functions import udf
from pyspark.sql.types import StringType

def categorize_age(age):
    if age < 18:
        return "Minor"
    elif age < 65:
        return "Adult"
    else:
        return "Senior"

# ×¨×™×©×•× UDF
categorize_udf = udf(categorize_age, StringType())

# ×©×™××•×©
df.withColumn("age_category", categorize_udf(col("age")))


# Python UDF - ×“×¨×š 2 (×¢× decorator)
@udf(returnType=StringType())
def categorize_age_udf(age):
    if age < 18:
        return "Minor"
    elif age < 65:
        return "Adult"
    else:
        return "Senior"

df.withColumn("age_category", categorize_age_udf(col("age")))</div>

                    <div class="code-block"># ×¨×™×©×•× UDF ×œ-SQL
spark.udf.register("categorize_age", categorize_age, StringType())

# ×©×™××•×© ×‘-SQL
spark.sql("""
    SELECT
        name,
        age,
        categorize_age(age) as age_category
    FROM users
""")</div>

                    <h3>Pandas UDF (××”×™×¨ ×™×•×ª×¨!)</h3>
                    <div class="success-box">
                        <h3>âœ… ××•××œ×¥!</h3>
                        <p>Pandas UDF ×¢×•×‘×“ ×¢×œ batches ×©×œ × ×ª×•× ×™× â†’ ×”×¨×‘×” ×™×•×ª×¨ ××”×™×¨!</p>
                    </div>

                    <div class="code-block">from pyspark.sql.functions import pandas_udf
import pandas as pd

# Pandas UDF - Series to Series
@pandas_udf("double")
def multiply_by_two(s: pd.Series) -> pd.Series:
    return s * 2

df.withColumn("doubled", multiply_by_two(col("value")))


# Pandas UDF - DataFrame to DataFrame (grouped map)
@pandas_udf("id long, value double")
def normalize_per_group(pdf: pd.DataFrame) -> pd.DataFrame:
    pdf['value'] = (pdf['value'] - pdf['value'].mean()) / pdf['value'].std()
    return pdf

df.groupBy("group").applyInPandas(normalize_per_group, schema="id long, value double")</div>
                </div>
            </div>

            <!-- Window Functions -->
            <div id="df-window" class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-green)">â—</span> Window Functions</h2>
                </div>
                <div class="card-body">
                    <div class="info-box">
                        <h3>××”×Ÿ Window Functions?</h3>
                        <p><strong>Window Functions</strong> ×××¤×©×¨×•×ª ×œ×‘×¦×¢ ×—×™×©×•×‘×™× ×¢×œ "×—×œ×•×Ÿ" ×©×œ ×©×•×¨×•×ª.</p>
                        <p>×“×•××” ×œ-SQL Window Functions.</p>
                    </div>

                    <div class="code-block">from pyspark.sql.window import Window
from pyspark.sql.functions import row_number, rank, dense_rank, lag, lead

# ×”×’×“×¨×ª Window
window_spec = Window.partitionBy("department").orderBy("salary")

# ×©×™××•×© ×‘-Window Functions
df.withColumn("row_num", row_number().over(window_spec)) \
  .withColumn("rank", rank().over(window_spec)) \
  .withColumn("dense_rank", dense_rank().over(window_spec))


# Lag / Lead - ×’×™×©×” ×œ×©×•×¨×•×ª ×§×•×“××•×ª/×”×‘××•×ª
df.withColumn("prev_salary", lag("salary", 1).over(window_spec)) \
  .withColumn("next_salary", lead("salary", 1).over(window_spec))


# Ntile - ×—×œ×•×§×” ×œ×§×‘×•×¦×•×ª (quartiles, percentiles)
from pyspark.sql.functions import ntile

df.withColumn("quartile", ntile(4).over(window_spec)) \
  .withColumn("decile", ntile(10).over(window_spec))


# Percent Rank - ××—×•×–×•×Ÿ ×™×—×¡×™ (0 ×¢×“ 1)
from pyspark.sql.functions import percent_rank

df.withColumn("percent_rank", percent_rank().over(window_spec))


# Cumulative Distribution - ×”×ª×¤×œ×’×•×ª ××¦×˜×‘×¨×ª
from pyspark.sql.functions import cume_dist

df.withColumn("cume_dist", cume_dist().over(window_spec))


# Aggregations ×¢×œ Window
from pyspark.sql.functions import sum, avg, max, min

window_spec2 = Window.partitionBy("department") \
                     .orderBy("date") \
                     .rowsBetween(Window.unboundedPreceding, Window.currentRow)

df.withColumn("running_total", sum("amount").over(window_spec2)) \
  .withColumn("running_avg", avg("amount").over(window_spec2))


# Top N per group
window_spec3 = Window.partitionBy("department").orderBy(col("salary").desc())

top_earners = df.withColumn("rank", rank().over(window_spec3)) \
                .filter(col("rank") <= 3)</div>

                    <div class="success-box">
                        <h3>×¡×•×’×™ Window Frames</h3>
                        <ul>
                            <li><strong>rowsBetween</strong> - ××‘×•×¡×¡ ×¢×œ ××¡×¤×¨ ×©×•×¨×•×ª</li>
                            <li><strong>rangeBetween</strong> - ××‘×•×¡×¡ ×¢×œ ×¢×¨×›×™×</li>
                            <li><strong>unboundedPreceding</strong> - ××ª×—×™×œ×ª ×”-partition</li>
                            <li><strong>unboundedFollowing</strong> - ×¢×“ ×¡×•×£ ×”-partition</li>
                            <li><strong>currentRow</strong> - ×”×©×•×¨×” ×”× ×•×›×—×™×ª</li>
                        </ul>
                    </div>

                    <div class="info-box">
                        <h3>ğŸ’¡ ×”×”×‘×“×œ ×‘×™×Ÿ percent_rank ×•-cume_dist</h3>
                        <ul>
                            <li><strong>percent_rank()</strong> - (rank - 1) / (total - 1) â†’ ××—×•×–×•×Ÿ ×©×œ ×”-rank</li>
                            <li><strong>cume_dist()</strong> - ××¡×¤×¨ ×©×•×¨×•×ª â‰¤ ×¢×¨×š × ×•×›×—×™ / ×¡×š ×©×•×¨×•×ª â†’ ××—×•×– ××¦×˜×‘×¨</li>
                            <li><strong>ntile(N)</strong> - ×—×œ×•×§×” ×©×•×•×” ×œ-N ×§×‘×•×¦×•×ª (quartiles, deciles, ×•×›×•')</li>
                        </ul>
                        <p style="margin-top: 10px;"><strong>×“×•×’××”:</strong> ×‘×§×‘×•×¦×” ×©×œ 5 ×©×•×¨×•×ª ×¢× ×¢×¨×›×™× [10, 20, 30, 40, 50]:</p>
                        <ul>
                            <li>percent_rank: [0.0, 0.25, 0.5, 0.75, 1.0]</li>
                            <li>cume_dist: [0.2, 0.4, 0.6, 0.8, 1.0]</li>
                            <li>ntile(4): [1, 1, 2, 3, 4]</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Catalyst Optimizer -->
            <div id="df-catalyst" class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-orange)">â—</span> Catalyst Optimizer</h2>
                </div>
                <div class="card-body">
                    <div class="info-box">
                        <h3>××”×• Catalyst?</h3>
                        <p><strong>Catalyst</strong> ×”×•× ×× ×•×¢ ×”××•×¤×˜×™××™×–×¦×™×” ×©×œ Spark SQL.</p>
                        <p>×”×•× ×××™×¨ ×©××™×œ×ª×•×ª SQL ×•×¤×¢×•×œ×•×ª DataFrame ×œ×ª×•×›× ×™×ª ×‘×™×¦×•×¢ ×××•×¤×˜××ª.</p>
                    </div>

                    <div class="success-box">
                        <h3>×©×œ×‘×™ ××•×¤×˜×™××™×–×¦×™×”</h3>
                        <ol>
                            <li><strong>Logical Plan</strong> - ×™×™×¦×•×’ ×œ×•×’×™ ×©×œ ×”×©××™×œ×ª×”</li>
                            <li><strong>Optimized Logical Plan</strong> - ××•×¤×˜×™××™×–×¦×™×•×ª (predicate pushdown, column pruning)</li>
                            <li><strong>Physical Plans</strong> - ××¡×¤×¨ ××¡×˜×¨×˜×’×™×•×ª ×‘×™×¦×•×¢ ××¤×©×¨×™×•×ª</li>
                            <li><strong>Cost Model</strong> - ×‘×—×™×¨×ª ×”×ª×•×›× ×™×ª ×”×–×•×œ×” ×‘×™×•×ª×¨</li>
                            <li><strong>Code Generation</strong> - ×™×¦×™×¨×ª ×§×•×“ JVM ×××•×˜×‘</li>
                        </ol>
                    </div>

                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4>ğŸ” Predicate Pushdown</h4>
                            <p>×“×—×™×¤×ª ×¡×™× ×•× ×™× ×œ××§×•×¨ ×”× ×ª×•× ×™×</p>
                            <p>×§×¨×™××ª ×¤×—×•×ª × ×ª×•× ×™×!</p>
                        </div>
                        <div class="feature-card">
                            <h4>âœ‚ï¸ Column Pruning</h4>
                            <p>×§×¨×™××” ×¨×§ ×©×œ ×¢××•×“×•×ª × ×“×¨×©×•×ª</p>
                            <p>×™×¢×™×œ ×‘-Parquet/ORC!</p>
                        </div>
                        <div class="feature-card">
                            <h4>ğŸ”„ Constant Folding</h4>
                            <p>×—×™×©×•×‘ ×¢×¨×›×™× ×§×‘×•×¢×™× ××¨××©</p>
                            <p>×¤×—×•×ª ×¢×‘×•×“×” ×‘×–××Ÿ ×¨×™×¦×”</p>
                        </div>
                        <div class="feature-card">
                            <h4>âš¡ Code Generation</h4>
                            <p>×™×¦×™×¨×ª ×§×•×“ ×××•×˜×‘</p>
                            <p>WholeStageCodegen</p>
                        </div>
                    </div>

                    <div class="code-block"># ×“×•×’××” - Catalyst ××™×™×¢×œ ××•×˜×•××˜×™×ª!
df = spark.read.parquet("/data/users")

# ×©××™×œ×ª×”
result = df.filter(df.age > 25) \
           .select("name", "age") \
           .filter(df.name.startswith("A"))

# Catalyst ×™×‘×¦×¢:
# 1. ××™×—×•×“ ×©× ×™ filters ×œ××—×“: age > 25 AND name LIKE 'A%'
# 2. Predicate Pushdown - ×“×—×™×¤×ª ×”×¡×™× ×•×Ÿ ×œ-Parquet
# 3. Column Pruning - ×§×¨×™××” ×¨×§ ×©×œ name, age (×œ× ×›×œ ×”×¢××•×“×•×ª!)
# 4. Code Generation - ×§×•×“ ×××•×˜×

# × ×™×ª×Ÿ ×œ×¨××•×ª ××ª ×”×ª×•×›× ×™×ª:
result.explain(True)  # ×”×“×¤×¡×ª ×›×œ ×©×œ×‘×™ ×”××•×¤×˜×™××™×–×¦×™×”</div>

                    <div class="warning-box">
                        <h3>ğŸ’¡ ×˜×™×¤ ×—×©×•×‘</h3>
                        <p>×”×©×ª××© ×‘-<code>explain()</code> ×›×“×™ ×œ×¨××•×ª ××™×š Spark ××™×™×¢×œ ××ª ×”×©××™×œ×ª×” ×©×œ×š!</p>
                        <code style="display: block; background: #2d2d2d; color: #86efac; padding: 10px; border-radius: 4px; margin: 10px 0;">
df.explain()  # Physical Plan<br>
df.explain(True)  # Logical + Physical + Optimized
                        </code>
                    </div>
                </div>
            </div>

            <!-- Dataset -->
            <div id="df-dataset" class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-red)">â—</span> Dataset</h2>
                </div>
                <div class="card-body">
                    <div class="info-box">
                        <h3>××”×• Dataset?</h3>
                        <p><strong>Dataset</strong> ×”×•× DataFrame ×¢× type-safety (×¨×§ ×‘-Scala/Java).</p>
                        <p>×‘-Python, DataFrame ×•-Dataset ×”× ××•×ª×• ×“×‘×¨.</p>
                    </div>

                    <div class="code-block">// Scala - Dataset
case class User(name: String, age: Int, salary: Double)


val ds: Dataset[User] = spark.read
    .json("/path/to/users.json")
    .as[User]


// ×¤×¢×•×œ×•×ª type-safe
ds.filter(_.age > 25)
  .map(_.salary * 1.1)
  .show()</div>

                    <div class="success-box">
                        <h3>×™×ª×¨×•× ×•×ª Dataset (Scala/Java)</h3>
                        <ul>
                            <li><strong>Type Safety</strong> - ×‘×“×™×§×ª ×˜×™×¤×•×¡×™× ×‘×–××Ÿ Compile</li>
                            <li><strong>××•×¤×˜×™××™×–×¦×™×”</strong> - Catalyst Optimizer</li>
                            <li><strong>Performance</strong> - Encoder ×™×¢×™×œ</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Data Sources -->
            <div id="df-sources" class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-orange)">â—</span> ×¢×‘×•×“×” ×¢× Data Sources</h2>
                </div>
                <div class="card-body">
                    <h3>×¤×•×¨××˜×™× ×©×•× ×™× ×©×œ ×§×‘×¦×™×</h3>

                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4>ğŸ“„ CSV</h4>
                            <p>âœ… ×§×¨×™× ×œ×‘× ×™ ××“×</p>
                            <p>âŒ ×’×“×•×œ, ××™×˜×™</p>
                            <p>âŒ ××™×Ÿ Schema ××•×‘× ×”</p>
                        </div>
                        <div class="feature-card">
                            <h4>ğŸ“¦ Parquet</h4>
                            <p>âœ… ××”×™×¨ ×××•×“!</p>
                            <p>âœ… ×“×—×•×¡ (columnar)</p>
                            <p>âœ… Schema ××•×‘× ×”</p>
                            <p><strong>××•××œ×¥!</strong></p>
                        </div>
                        <div class="feature-card">
                            <h4>ğŸ—œï¸ ORC</h4>
                            <p>âœ… ×“×—×•×¡ ×××•×“</p>
                            <p>âœ… ××”×™×¨ (columnar)</p>
                            <p>âœ… Schema ××•×‘× ×”</p>
                            <p>×¤×•×¤×•×œ×¨×™ ×‘-Hive</p>
                        </div>
                        <div class="feature-card">
                            <h4>ğŸ”· Avro</h4>
                            <p>âœ… Schema evolution</p>
                            <p>âœ… Row-based</p>
                            <p>âœ… ××¢×•×œ×” ×œ-Streaming</p>
                            <p>×¤×•×¤×•×œ×¨×™ ×‘-Kafka</p>
                        </div>
                    </div>

                    <div class="info-box">
                        <h3>ğŸ¯ ××ª×™ ×œ×”×©×ª××© ×‘××”?</h3>
                        <ul>
                            <li><strong>Parquet</strong> - ×‘×¨×™×¨×ª ××—×“×œ ××•××œ×¦×ª! ××¢×•×œ×” ×œ×× ×œ×™×˜×™×§×” (×§×¨×™××” ×¨×§ ×©×œ ×¢××•×“×•×ª ×¡×¤×¦×™×¤×™×•×ª)</li>
                            <li><strong>ORC</strong> - ×× ××ª×” ×¢×•×‘×“ ×¢× Hive, ×“×•××” ×œ-Parquet</li>
                            <li><strong>Avro</strong> - ×›××©×¨ Schema ××©×ª× ×” ×œ×¢×ª×™× ×§×¨×•×‘×•×ª, ××¢×•×œ×” ×œ-Kafka Streaming</li>
                            <li><strong>CSV/JSON</strong> - ×¨×§ ×œ×¤×™×ª×•×—/×“×•×’×××•×ª, ×œ× ×œ×¤×¨×•×“×§×©×Ÿ!</li>
                        </ul>
                    </div>

                    <h3>Parquet - Columnar Storage</h3>
                    <div class="success-box">
                        <h3>×™×ª×¨×•× ×•×ª</h3>
                        <ul>
                            <li><strong>Columnar Format</strong> - × ×ª×•× ×™× ×××•×—×¡× ×™× ×œ×¤×™ ×¢××•×“×•×ª</li>
                            <li><strong>×“×—×™×¡×” ××¢×•×œ×”</strong> - × ×ª×•× ×™× ×“×•××™× ×‘××•×ª×” ×¢××•×“×” â†’ ×“×—×™×¡×” ×˜×•×‘×”</li>
                            <li><strong>Predicate Pushdown</strong> - ×§×¨×™××” ×¨×§ ×©×œ ×¢××•×“×•×ª ×•×©×•×¨×•×ª ×¨×œ×•×•× ×˜×™×•×ª</li>
                            <li><strong>Schema ××•×‘× ×”</strong> - ×œ× ×¦×¨×™×š inferSchema</li>
                            <li><strong>×ª×•×× ×œ××’×•×•×Ÿ ×›×œ×™×</strong> - Spark, Hive, Impala, Presto</li>
                        </ul>
                    </div>

                    <h3>Avro - Schema Evolution</h3>
                    <div class="info-box">
                        <h3>×™×ª×¨×•× ×•×ª</h3>
                        <ul>
                            <li><strong>Schema Evolution</strong> - × ×™×ª×Ÿ ×œ×©× ×•×ª Schema ×œ××•×¨×š ×–××Ÿ</li>
                            <li><strong>Row-based</strong> - ××¢×•×œ×” ×œ×›×ª×™×‘×” ××”×™×¨×”</li>
                            <li><strong>××™× ×˜×’×¨×¦×™×” ×¢× Kafka</strong> - ×¤×•×¨××˜ ×¤×•×¤×•×œ×¨×™ ×‘-Streaming</li>
                            <li><strong>Schema Registry</strong> - × ×™×”×•×œ ××¨×›×–×™ ×©×œ schemas</li>
                        </ul>
                    </div>

                    <h3>×§×¨×™××” ××¤×•×¨××˜×™× ×©×•× ×™×</h3>
                    <div class="code-block"># CSV ×¢× ××•×¤×¦×™×•×ª
df = spark.read \
    .option("header", "true") \
    .option("inferSchema", "true") \
    .option("delimiter", ",") \
    .option("quote", '"') \
    .option("escape", "\\") \
    .csv("/path/to/file.csv")


# JSON
df = spark.read.json("/path/to/file.json")


# Parquet (××•××œ×¥!)
df = spark.read.parquet("/path/to/file.parquet")


# ORC
df = spark.read.orc("/path/to/file.orc")


# Avro (×¦×¨×™×š spark-avro package)
df = spark.read.format("avro").load("/path/to/file.avro")</div>

                    <h3>×›×ª×™×‘×”</h3>
                    <div class="code-block"># ×›×ª×™×‘×” ×œ-CSV
df.write.csv("/output/path")


# ×›×ª×™×‘×” ×œ-Parquet
df.write.parquet("/output/path")


# ×›×ª×™×‘×” ×¢× modes
df.write.mode("overwrite").parquet("/output/path")
# modes: append, overwrite, ignore, error (default)


# Partitioning
df.write.partitionBy("year", "month").parquet("/output/path")


# ×›×ª×™×‘×” ×œ-Database
df.write \
    .format("jdbc") \
    .option("url", "jdbc:mysql://localhost:3306/mydb") \
    .option("dbtable", "users") \
    .option("user", "root") \
    .option("password", "password") \
    .save()</div>
                </div>
            </div>
            </main>
        </div>
    </div>

    <!-- === STREAMING VIEW === -->
    <div id="view-streaming" class="view-section">
        <div class="theory-layout">
            <aside class="theory-sidebar">
                <div class="theory-nav-item active" onclick="scrollToSection('stream-kafka', this)">
                    <span>ğŸ“¨</span> Apache Kafka
                </div>
                <div class="theory-nav-item" onclick="scrollToSection('stream-dstreams', this)">
                    <span>ğŸ“¡</span> DStreams (Legacy)
                </div>
                <div class="theory-nav-item" onclick="scrollToSection('stream-structured', this)">
                    <span>âš¡</span> Structured Streaming
                </div>
                <div class="theory-nav-item" onclick="scrollToSection('stream-comparison', this)">
                    <span>âš–ï¸</span> DStreams vs Structured
                </div>
            </aside>

            <main class="theory-content">
            <div style="text-align: center; margin-bottom: 50px;">
                <h1 style="font-size: 2.2rem; margin-bottom: 12px; font-weight: 800; color: var(--text-primary);">ğŸŒŠ Spark Streaming</h1>
                <p style="color: var(--text-secondary); font-size: 1.05rem;">×¢×™×‘×•×“ × ×ª×•× ×™× ×‘×–××Ÿ ×××ª</p>
            </div>

            <!-- Kafka -->
            <div id="stream-kafka" class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-orange)">â—</span> Apache Kafka</h2>
                </div>
                <div class="card-body">
                    <div class="info-box">
                        <h3>××”×• Kafka?</h3>
                        <p><strong>Apache Kafka</strong> ×”×•× ×¤×œ×˜×¤×•×¨××” ××‘×•×–×¨×ª ×œ-streaming ×©×œ ××™×¨×•×¢×™×.</p>
                        <p>××©××© ×›-Message Queue ××”×™×¨ ×•××“×¨×’×™, ××¦×•×™×Ÿ ×œ××™× ×˜×’×¨×¦×™×” ×¢× Spark Streaming.</p>
                    </div>

                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4>ğŸ“¨ Topics</h4>
                            <p>×¢×¨×•×¦×™ × ×ª×•× ×™× (×›××• ×˜×‘×œ××•×ª)</p>
                            <p>×›×œ Topic ××—×•×œ×§ ×œ-Partitions</p>
                        </div>
                        <div class="feature-card">
                            <h4>ğŸ“¤ Producers</h4>
                            <p>×©×•×œ×—×™× ×”×•×“×¢×•×ª ×œ-Topics</p>
                            <p>×™×›×•×œ×™× ×œ×‘×—×•×¨ Partition</p>
                        </div>
                        <div class="feature-card">
                            <h4>ğŸ“¥ Consumers</h4>
                            <p>×§×•×¨××™× ×”×•×“×¢×•×ª ×-Topics</p>
                            <p>Consumer Groups ×œ××§×‘×™×œ×™×•×ª</p>
                        </div>
                        <div class="feature-card">
                            <h4>ğŸ”„ Partitions</h4>
                            <p>×××¤×©×¨ ××§×‘×™×œ×™×•×ª</p>
                            <p>×©××™×¨×ª ×¡×“×¨ per partition</p>
                        </div>
                    </div>

                    <h3>××¨×›×™×˜×§×˜×•×¨×ª Kafka</h3>
                    <div class="success-box">
                        <ul>
                            <li><strong>Broker</strong> - ×©×¨×ª Kafka (×‘×“×¨×š ×›×œ×œ ×›××” brokers ×‘-cluster)</li>
                            <li><strong>Topic</strong> - ×§×˜×’×•×¨×™×” ×©×œ ×”×•×“×¢×•×ª (×œ×“×•×’××”: "user-events", "transactions")</li>
                            <li><strong>Partition</strong> - ×—×œ×•×§×” ×œ×•×’×™×ª ×©×œ Topic (×××¤×©×¨ ××§×‘×™×œ×™×•×ª)</li>
                            <li><strong>Offset</strong> - ××–×”×” ×™×™×—×•×“×™ ×©×œ ×”×•×“×¢×” ×‘×ª×•×š Partition</li>
                            <li><strong>Consumer Group</strong> - ×§×‘×•×¦×ª Consumers ×©×¢×•×‘×“×™× ×‘×™×—×“</li>
                            <li><strong>ZooKeeper</strong> - × ×™×”×•×œ metadata (×¢×“ Kafka 2.8, ××—×¨ ×›×š KRaft)</li>
                        </ul>
                    </div>

                    <h3>×™×ª×¨×•× ×•×ª Kafka</h3>
                    <div class="info-box">
                        <ul>
                            <li><strong>Throughput ×’×‘×•×”</strong> - ××™×œ×™×•× ×™ ×”×•×“×¢×•×ª ×œ×©× ×™×™×”</li>
                            <li><strong>Low Latency</strong> - ××™×œ×™×©× ×™×•×ª</li>
                            <li><strong>Durability</strong> - ×”×•×“×¢×•×ª × ×©××¨×•×ª ×œ×“×™×¡×§</li>
                            <li><strong>Scalability</strong> - ×”×•×¡×¤×ª brokers/partitions</li>
                            <li><strong>Fault Tolerance</strong> - ×©×›×¤×•×œ (replication)</li>
                            <li><strong>Ordering</strong> - ×©××™×¨×ª ×¡×“×¨ per partition</li>
                        </ul>
                    </div>

                    <div class="code-block"># ×“×•×’××” - ××‘× ×” Topic ×¢× Partitions

Topic: "user-events"
â”œâ”€â”€ Partition 0: [msg0, msg3, msg6, msg9, ...]
â”œâ”€â”€ Partition 1: [msg1, msg4, msg7, msg10, ...]
â””â”€â”€ Partition 2: [msg2, msg5, msg8, msg11, ...]

# ×›×œ ×”×•×“×¢×” ×™×© ×œ×”:
# - Key (××•×¤×¦×™×•× ×œ×™) - ×§×•×‘×¢ ×œ××™×–×” partition
# - Value - ×”×ª×•×›×Ÿ
# - Timestamp
# - Offset - ××¡×¤×¨ ×¡×™×“×•×¨×™ ×‘-partition</div>

                    <h3>Consumer Groups</h3>
                    <div class="warning-box">
                        <h3>××™×š ×–×” ×¢×•×‘×“?</h3>
                        <ul>
                            <li>×›×œ Consumer Group ×§×•×¨× ××ª ×›×œ ×”×”×•×“×¢×•×ª</li>
                            <li>×‘×ª×•×š Group, ×›×œ Partition × ×§×¨× ×¨×§ ×¢×œ-×™×“×™ Consumer ××—×“</li>
                            <li>××¡×¤×¨ Consumers â‰¤ ××¡×¤×¨ Partitions (××—×¨×ª ×™×© Consumers ××™×•×ª×¨×™×)</li>
                            <li>Kafka ×©×•××¨ ××ª ×”-Offset ×”××—×¨×•×Ÿ ×©×›×œ Consumer ×§×¨×</li>
                        </ul>
                    </div>

                    <div class="code-block"># ×“×•×’××” - Consumer Group

Topic: "events" (3 partitions)
Consumer Group: "spark-app"
â”œâ”€â”€ Consumer 1 â†’ Partition 0
â”œâ”€â”€ Consumer 2 â†’ Partition 1
â””â”€â”€ Consumer 3 â†’ Partition 2

# ×× ×™×© ×¨×§ 2 Consumers:
â”œâ”€â”€ Consumer 1 â†’ Partition 0, 1
â””â”€â”€ Consumer 2 â†’ Partition 2</div>
                </div>
            </div>

            <!-- DStreams -->
            <div id="stream-dstreams" class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-blue)">â—</span> Spark Streaming (DStreams)</h2>
                </div>
                <div class="card-body">
                    <div class="warning-box">
                        <h3>âš ï¸ ×”×¢×¨×”</h3>
                        <p>DStreams ×”×•× ×”-API ×”×™×©×Ÿ ×©×œ Spark Streaming.</p>
                        <p>××•××œ×¥ ×œ×”×©×ª××© ×‘-<strong>Structured Streaming</strong> ×‘×¤×¨×•×™×§×˜×™× ×—×“×©×™×!</p>
                    </div>

                    <div class="code-block"># Python - Spark Streaming ×¢× DStreams
from pyspark import SparkContext
from pyspark.streaming import StreamingContext


sc = SparkContext("local[2]", "NetworkWordCount")
ssc = StreamingContext(sc, 1)  # batch interval ×©×œ 1 ×©× ×™×”


# ×§×¨×™××” ×-socket
lines = ssc.socketTextStream("localhost", 9999)


# ×¢×™×‘×•×“
words = lines.flatMap(lambda line: line.split())
pairs = words.map(lambda word: (word, 1))
wordCounts = pairs.reduceByKey(lambda a, b: a + b)

wordCounts.pprint()


# ×”×ª×—×œ×”
ssc.start()
ssc.awaitTermination()</div>
                </div>
            </div>

            <!-- Structured Streaming -->
            <div id="stream-structured" class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-green)">â—</span> Structured Streaming</h2>
                </div>
                <div class="card-body">
                    <div class="success-box">
                        <h3>âœ… ×”-API ×”××•××œ×¥!</h3>
                        <p><strong>Structured Streaming</strong> ××‘×•×¡×¡ ×¢×œ DataFrame/Dataset API.</p>
                        <p>×’×™×©×” ××—×™×“×” ×œ×¢×™×‘×•×“ batch ×•-streaming!</p>
                    </div>

                    <h3>×§×¨×™××” ×-Kafka</h3>
                    <div class="code-block"># Python - Structured Streaming ×¢× Kafka
from pyspark.sql import SparkSession

spark = SparkSession.builder \
    .appName("StructuredKafkaWordCount") \
    .getOrCreate()


# ×§×¨×™××” ×-Kafka
df = spark \
    .readStream \
    .format("kafka") \
    .option("kafka.bootstrap.servers", "localhost:9092") \
    .option("subscribe", "my-topic") \
    .load()


# ×”× ×ª×•× ×™× ××’×™×¢×™× ×›-binary, ×¦×¨×™×š ×œ×”××™×¨
from pyspark.sql.functions import col

lines = df.select(col("value").cast("string"))


# ×¢×™×‘×•×“
words = lines.selectExpr("explode(split(value, ' ')) as word")
wordCounts = words.groupBy("word").count()


# ×›×ª×™×‘×” ×œ-console
query = wordCounts \
    .writeStream \
    .outputMode("complete") \
    .format("console") \
    .start()

query.awaitTermination()</div>

                    <h3>Output Modes - ××¦×‘×™ ×¤×œ×˜</h3>
                    <div class="info-box">
                        <h3>××”× Output Modes?</h3>
                        <p>Output Mode ×§×•×‘×¢ ××™×š ×”×ª×•×¦××•×ª × ×›×ª×‘×•×ª ×œ-sink (×™×¢×“ ×”× ×ª×•× ×™×) ×‘×›×œ batch.</p>
                        <p>×‘×—×™×¨×ª ×”-mode ×”× ×›×•×Ÿ ×§×¨×™×˜×™×ª ×œ×‘×™×¦×•×¢×™× ×•×œ×ª×§×™× ×•×ª ×”× ×ª×•× ×™×!</p>
                    </div>

                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4>ğŸ“ Append Mode</h4>
                            <p><strong>×¨×§ ×©×•×¨×•×ª ×—×“×©×•×ª</strong></p>
                            <p>âœ… Default mode</p>
                            <p>âš ï¸ ×œ× × ×™×ª×Ÿ ×œ×¢×“×›×Ÿ ×©×•×¨×•×ª ×§×™×™××•×ª</p>
                        </div>
                        <div class="feature-card">
                            <h4>ğŸ”„ Complete Mode</h4>
                            <p><strong>×›×œ ×˜×‘×œ×ª ×”×ª×•×¦××”</strong></p>
                            <p>âœ… ×¢×•×‘×“ ×¨×§ ×¢× aggregations</p>
                            <p>âš ï¸ ×™×›×•×œ ×œ×”×™×•×ª ×›×‘×“ ×¢×œ ×”××©××‘×™×</p>
                        </div>
                        <div class="feature-card">
                            <h4>ğŸ”€ Update Mode</h4>
                            <p><strong>×¨×§ ×©×•×¨×•×ª ×©×”×©×ª× ×•</strong></p>
                            <p>âœ… ×™×¢×™×œ ×™×•×ª×¨ ×-Complete</p>
                            <p>âœ… ××ª××™× ×œ-aggregations</p>
                        </div>
                    </div>

                    <h3>×”×¡×‘×¨ ××¤×•×¨×˜ + ×“×•×’×××•×ª</h3>

                    <div class="content-card" style="margin: 20px 0;">
                        <div class="card-header">
                            <h3 style="margin: 0;">ğŸ“ Append Mode - ×”×•×¡×¤×” ×‘×œ×‘×“</h3>
                        </div>
                        <div class="card-body">
                            <div class="success-box">
                                <h4>××ª×™ ×œ×”×©×ª××©?</h4>
                                <ul>
                                    <li>×›××©×¨ ×¨×•×¦×™× ×œ×›×ª×•×‘ ×¨×§ ×©×•×¨×•×ª <strong>×—×“×©×•×ª</strong> ×©× ×•×¡×¤×• ×œ×˜×‘×œ×ª ×”×ª×•×¦××”</li>
                                    <li>×©××™×œ×ª×•×ª ×œ×œ× aggregations</li>
                                    <li>aggregations ×¢×œ event-time ×¢× watermark</li>
                                    <li>×“×•×’××”: ×”×•×“×¢×•×ª ×—×“×©×•×ª, ×œ×•×’×™×, ××™×¨×•×¢×™× ×©×œ× ××©×ª× ×™×</li>
                                </ul>
                            </div>

                            <div class="warning-box">
                                <h4>âš ï¸ ××’×‘×œ×•×ª</h4>
                                <ul>
                                    <li>×œ× × ×™×ª×Ÿ ×œ×¢×“×›×Ÿ ×©×•×¨×•×ª ×§×™×™××•×ª</li>
                                    <li>×¢× aggregations - ×“×•×¨×© watermark!</li>
                                </ul>
                            </div>

                            <div class="code-block"># ×“×•×’××” - Append Mode (×œ×œ× aggregation)
df = spark.readStream \
    .format("kafka") \
    .option("kafka.bootstrap.servers", "localhost:9092") \
    .option("subscribe", "events") \
    .load()

# ×”××¨×” ×œ-string
events = df.select(col("value").cast("string"))

# ×›×ª×™×‘×” - ×¨×§ ×©×•×¨×•×ª ×—×“×©×•×ª
query = events.writeStream \
    .outputMode("append") \
    .format("parquet") \
    .option("path", "/output/events") \
    .option("checkpointLocation", "/checkpoint/events") \
    .start()

# ×“×•×’××” ×¢× aggregation + watermark
from pyspark.sql.functions import window

windowed = df.withWatermark("timestamp", "10 minutes") \
    .groupBy(
        window("timestamp", "5 minutes"),
        "event_type"
    ).count()

query = windowed.writeStream \
    .outputMode("append") \
    .format("parquet") \
    .option("path", "/output/windowed") \
    .option("checkpointLocation", "/checkpoint/windowed") \
    .start()</div>
                        </div>
                    </div>

                    <div class="content-card" style="margin: 20px 0;">
                        <div class="card-header">
                            <h3 style="margin: 0;">ğŸ”„ Complete Mode - ×›×œ ×”×˜×‘×œ×”</h3>
                        </div>
                        <div class="card-body">
                            <div class="success-box">
                                <h4>××ª×™ ×œ×”×©×ª××©?</h4>
                                <ul>
                                    <li>×›××©×¨ ×¨×•×¦×™× ×œ×›×ª×•×‘ ××ª <strong>×›×œ ×˜×‘×œ×ª ×”×ª×•×¦××”</strong> ×‘×›×œ batch</li>
                                    <li>×¢×•×‘×“ <strong>×¨×§ ×¢× aggregations</strong></li>
                                    <li>×“×•×’××”: ×¡×¤×™×¨×•×ª ×›×œ×œ×™×•×ª, ×¡×›×•××™× ××¦×˜×‘×¨×™×</li>
                                    <li>××ª××™× ×›×©×˜×‘×œ×ª ×”×ª×•×¦××” ×§×˜× ×”</li>
                                </ul>
                            </div>

                            <div class="warning-box">
                                <h4>âš ï¸ ××’×‘×œ×•×ª ×•×–×”×™×¨×•×ª</h4>
                                <ul>
                                    <li>×›×œ ×”×˜×‘×œ×” × ×›×ª×‘×ª ××—×“×© ×‘×›×œ batch - ×™×›×•×œ ×œ×”×™×•×ª ×›×‘×“!</li>
                                    <li>×“×•×¨×© aggregation - ×œ× ×¢×•×‘×“ ×¢× ×©××™×œ×ª×•×ª ×¨×’×™×œ×•×ª</li>
                                    <li>×¦×¨×™×š ×–×™×›×¨×•×Ÿ ××¡×¤×™×§ ×œ×›×œ ×”×˜×‘×œ×”</li>
                                </ul>
                            </div>

                            <div class="code-block"># ×“×•×’××” - Complete Mode
# ×¡×¤×™×¨×ª ××™×œ×™× - running count
df = spark.readStream \
    .format("kafka") \
    .option("kafka.bootstrap.servers", "localhost:9092") \
    .option("subscribe", "messages") \
    .load()

words = df.select(explode(split(col("value").cast("string"), " ")).alias("word"))

# aggregation - ×¡×¤×™×¨×” ×œ×›×œ ××™×œ×”
word_counts = words.groupBy("word").count()

# Complete Mode - ×›×œ ×”×¡×¤×™×¨×•×ª ×‘×›×œ ×¤×¢×
query = word_counts.writeStream \
    .outputMode("complete") \
    .format("console") \
    .start()

# Output ×“×•×’××”:
# Batch 1:
# +------+-----+
# | word |count|
# +------+-----+
# |hello |    1|
# |world |    1|
# +------+-----+
#
# Batch 2 (×”×›×œ ××—×“×©!):
# +------+-----+
# | word |count|
# +------+-----+
# |hello |    3|  â† ×¢×•×“×›×Ÿ!
# |world |    2|  â† ×¢×•×“×›×Ÿ!
# |spark |    1|  â† ×—×“×©!
# +------+-----+</div>
                        </div>
                    </div>

                    <div class="content-card" style="margin: 20px 0;">
                        <div class="card-header">
                            <h3 style="margin: 0;">ğŸ”€ Update Mode - ×¨×§ ×©×™× ×•×™×™×</h3>
                        </div>
                        <div class="card-body">
                            <div class="success-box">
                                <h4>××ª×™ ×œ×”×©×ª××©?</h4>
                                <ul>
                                    <li>×›××©×¨ ×¨×•×¦×™× ×œ×›×ª×•×‘ ×¨×§ ×©×•×¨×•×ª ×©<strong>×”×©×ª× ×•/×¢×•×“×›× ×•</strong> ×××– ×”-batch ×”××—×¨×•×Ÿ</li>
                                    <li>×™×¢×™×œ ×™×•×ª×¨ ×-Complete Mode</li>
                                    <li>××ª××™× ×œ-aggregations</li>
                                    <li>×“×•×’××”: ×¢×“×›×•×Ÿ counters, aggregations ××¦×˜×‘×¨×•×ª</li>
                                </ul>
                            </div>

                            <div class="info-box">
                                <h4>âœ… ×™×ª×¨×•× ×•×ª</h4>
                                <ul>
                                    <li>×™×¢×™×œ - ×›×•×ª×‘ ×¨×§ ××ª ××” ×©×”×©×ª× ×”</li>
                                    <li>×¤×—×•×ª ×¢×•××¡ ×¢×œ ×”-sink</li>
                                    <li>××ª××™× ×œ×¢×“×›×•× ×™ database</li>
                                </ul>
                            </div>

                            <div class="code-block"># ×“×•×’××” - Update Mode
# ×¡×¤×™×¨×ª ××©×ª××©×™× ×¤×¢×™×œ×™× ×œ×¤×™ ××“×™× ×”
df = spark.readStream \
    .format("kafka") \
    .option("kafka.bootstrap.servers", "localhost:9092") \
    .option("subscribe", "user_events") \
    .load()

events = df.select(
    get_json_object(col("value").cast("string"), "$.user_id").alias("user_id"),
    get_json_object(col("value").cast("string"), "$.country").alias("country")
)

# aggregation
user_counts = events.groupBy("country") \
    .agg(countDistinct("user_id").alias("active_users"))

# Update Mode - ×¨×§ ××“×™× ×•×ª ×©×”×¡×¤×™×¨×” ×©×œ×”×Ÿ ×”×©×ª× ×ª×”
query = user_counts.writeStream \
    .outputMode("update") \
    .format("console") \
    .start()

# Output ×“×•×’××”:
# Batch 1:
# +-------+------------+
# |country|active_users|
# +-------+------------+
# |    US |          10|
# |    IL |           5|
# +-------+------------+
#
# Batch 2 (×¨×§ ×©×™× ×•×™×™×!):
# +-------+------------+
# |country|active_users|
# +-------+------------+
# |    US |          15|  â† ×¨×§ US ×”×©×ª× ×”!
# +-------+------------+</div>
                        </div>
                    </div>

                    <h3>×˜×‘×œ×ª ×”×©×•×•××”</h3>
                    <div style="overflow-x: auto; margin: 20px 0;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                            <thead style="background: linear-gradient(to left, #e3f2fd, #bbdefb); border-bottom: 2px solid var(--spark-blue);">
                                <tr>
                                    <th style="padding: 12px; text-align: right; border: 1px solid var(--border-color); font-weight: 700;">××¦×‘</th>
                                    <th style="padding: 12px; text-align: right; border: 1px solid var(--border-color); font-weight: 700;">×›×•×ª×‘ ×©×•×¨×•×ª ×—×“×©×•×ª</th>
                                    <th style="padding: 12px; text-align: right; border: 1px solid var(--border-color); font-weight: 700;">×›×•×ª×‘ ×©×•×¨×•×ª ××¢×•×“×›× ×•×ª</th>
                                    <th style="padding: 12px; text-align: right; border: 1px solid var(--border-color); font-weight: 700;">×“×•×¨×© Aggregation</th>
                                    <th style="padding: 12px; text-align: right; border: 1px solid var(--border-color); font-weight: 700;">×ª×•××š ×‘-Aggregation</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-blue);">Append</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: #e8f5e9;">âœ… ×›×Ÿ</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: #ffebee;">âŒ ×œ×</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: #ffebee;">âŒ ×œ×</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: #fff3e0;">âš ï¸ ×¨×§ ×¢× watermark</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange);">Complete</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: #e8f5e9;">âœ… ×›×Ÿ (×”×›×œ)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: #e8f5e9;">âœ… ×›×Ÿ (×”×›×œ)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: #e8f5e9;">âœ… ×›×Ÿ</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: #e8f5e9;">âœ… ×›×Ÿ</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-green);">Update</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: #e8f5e9;">âœ… ×›×Ÿ</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: #e8f5e9;">âœ… ×›×Ÿ (×¨×§ ×©×™× ×•×™×™×)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: #ffebee;">âŒ ×œ×</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: #e8f5e9;">âœ… ×›×Ÿ</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="success-box">
                        <h3>ğŸ’¡ ××™×š ×œ×‘×—×•×¨?</h3>
                        <ul>
                            <li><strong>Append</strong> - ×× ××™×Ÿ aggregations ××• ×©×”× ×ª×•× ×™× ×œ× ××©×ª× ×™× (×œ×•×’×™×, ××™×¨×•×¢×™×)</li>
                            <li><strong>Complete</strong> - aggregations ×¤×©×•×˜×•×ª ×¢× ×˜×‘×œ×ª ×ª×•×¦××” ×§×˜× ×” (word count, simple counters)</li>
                            <li><strong>Update</strong> - aggregations ××•×¨×›×‘×•×ª, ×˜×‘×œ××•×ª ×’×“×•×œ×•×ª, ×¢×“×›×•× ×™ database</li>
                        </ul>
                    </div>

                    <h3>×›×ª×™×‘×” ×œ×™×¢×“×™× ×©×•× ×™×</h3>
                    <div class="code-block"># ×›×ª×™×‘×” ×œ-Kafka
query = df \
    .writeStream \
    .format("kafka") \
    .option("kafka.bootstrap.servers", "localhost:9092") \
    .option("topic", "output-topic") \
    .start()


# ×›×ª×™×‘×” ×œ-Parquet
query = df \
    .writeStream \
    .format("parquet") \
    .option("path", "/output/path") \
    .option("checkpointLocation", "/checkpoint/path") \
    .start()


# ×›×ª×™×‘×” ×œ-Memory (×œ×‘×“×™×§×•×ª)
query = df \
    .writeStream \
    .format("memory") \
    .queryName("my_table") \
    .start()


# ××¤×©×¨ ×œ×©××•×œ ×¢× SQL
spark.sql("SELECT * FROM my_table").show()</div>

                    <h3>Watermarking</h3>
                    <div class="info-box">
                        <h3>××”×• Watermark?</h3>
                        <p><strong>Watermarking</strong> ×××¤×©×¨ ×œ×˜×¤×œ ×‘-late data (× ×ª×•× ×™× ×©××’×™×¢×™× ×‘××™×—×•×¨) ×‘×¦×•×¨×” ×—×›××”.</p>
                        <p>Watermark ×§×•×‘×¢: "×× ×™ ××•×›×Ÿ ×œ×—×›×•×ª ×¢×“ X ×–××Ÿ ×œ× ×ª×•× ×™× ×××•×—×¨×™×"</p>
                    </div>

                    <div class="code-block"># ×¢× Watermarking
from pyspark.sql.functions import window

windowedCounts = df \
    .withWatermark("timestamp", "10 minutes") \
    .groupBy(
        window(col("timestamp"), "5 minutes"),
        col("word")
    ) \
    .count()

# ××©××¢×•×ª: ×—×›×” ×¢×“ 10 ×“×§×•×ª ×œ× ×ª×•× ×™× ×××•×—×¨×™×
# ××—×¨×™ 10 ×“×§×•×ª - ×”×©×œ×š × ×ª×•× ×™× ×™×©× ×™×</div>

                    <h3>Checkpoints</h3>
                    <div class="warning-box">
                        <h3>âš ï¸ ×—×•×‘×” ×‘-Production!</h3>
                        <p><strong>Checkpoint</strong> ×©×•××¨ ××ª ×”××¦×‘ ×©×œ ×”-Streaming application.</p>
                        <p>×××¤×©×¨ ×”×ª××•×©×©×•×ª ×œ××—×¨ ×›×©×œ ×œ×œ× ××•×‘×“×Ÿ × ×ª×•× ×™×!</p>
                    </div>

                    <div class="code-block"># Checkpoint × ×“×¨×© ×œ-file sinks
query = df \
    .writeStream \
    .format("parquet") \
    .option("path", "/output/path") \
    .option("checkpointLocation", "/checkpoint/path") \
    .start()

# Checkpoint ×©×•××¨:
# - Offsets ×©× ×§×¨××• ×-Kafka
# - Metadata ×©×œ ×”-stream
# - State ×©×œ aggregations</div>

                    <h3>awaitTermination() - ×”××ª× ×” ×œ×¡×™×•×</h3>
                    <div class="info-box">
                        <h3>××”×• awaitTermination()?</h3>
                        <p><strong>awaitTermination()</strong> ×”×™× ××ª×•×“×” ×©×—×•×¡××ª ××ª ×”-thread ×”×¨××©×™ ×•××•× ×¢×ª ××”×ª×•×›× ×™×ª ×œ×”×¡×ª×™×™×.</p>
                        <p>×‘×œ×¢×“×™×”, ×”×ª×•×›× ×™×ª ×ª×¡×ª×™×™× ××™×“ ××—×¨×™ ×”×¤×¢×œ×ª ×”-streaming query!</p>
                    </div>

                    <div class="code-block"># âœ… × ×›×•×Ÿ - ×¢× awaitTermination
query = df.writeStream \
    .format("console") \
    .start()

query.awaitTermination()  # ×”×ª×•×›× ×™×ª ×××ª×™× ×” ×›××Ÿ!
# ×”×§×•×“ ×›××Ÿ ×œ× ×™×ª×‘×¦×¢ ×¢×“ ×©×”-query ×™×¡×ª×™×™×


# âŒ ×œ× × ×›×•×Ÿ - ×‘×œ×™ awaitTermination
query = df.writeStream \
    .format("console") \
    .start()

# ×”×ª×•×›× ×™×ª ×ª×¡×ª×™×™× ××™×“ ×›××Ÿ!
# ×”-query ×œ× ×™×¡×¤×™×§ ×œ×¢×‘×“ ×›×œ×•×!</div>

                    <div class="success-box">
                        <h3>âœ… ××¤×©×¨×•×™×•×ª ×©×™××•×©</h3>
                        <div class="code-block"># 1. ×”××ª× ×” ×œ×œ× ×”×’×‘×œ×ª ×–××Ÿ (× ×¤×•×¥!)
query.awaitTermination()


# 2. ×”××ª× ×” ×¢× timeout (×©× ×™×•×ª)
query.awaitTermination(timeout=60)
# ××—×–×™×¨ True ×× ×”-query ×”×¡×ª×™×™×, False ×× timeout


# 3. ×‘×“×™×§×ª ×¡×˜×˜×•×¡ ×‘×œ×•×œ××”
while query.isActive:
    time.sleep(1)
    # × ×™×ª×Ÿ ×œ×‘×¦×¢ ×‘×“×™×§×•×ª × ×•×¡×¤×•×ª ×›××Ÿ


# 4. ×©×™××•×© ×¢× ××¡×¤×¨ queries
query1 = df1.writeStream.start()
query2 = df2.writeStream.start()

# ×”××ª× ×” ×œ×›×•×œ×
spark.streams.awaitAnyTermination()  # ×¢×“ ×©××—×“ ××¡×ª×™×™×</div>
                    </div>

                    <div class="warning-box">
                        <h3>ğŸ’¡ ××ª×™ ×”-query ××¡×ª×™×™×?</h3>
                        <ul>
                            <li><strong>×©×’×™××”</strong> - ×× ×™×© exception ×‘×¢×™×‘×•×“</li>
                            <li><strong>query.stop()</strong> - ×¢×¦×™×¨×” ×™×“× ×™×ª</li>
                            <li><strong>SIGTERM/SIGINT</strong> - ××•×ª ××”××¢×¨×›×ª (Ctrl+C)</li>
                            <li><strong>trigger(once=True)</strong> - batch ×™×—×™×“</li>
                        </ul>
                    </div>

                    <div class="code-block"># ×“×•×’××” ××œ××” ×¢× error handling
try:
    query = df.writeStream \
        .format("console") \
        .option("checkpointLocation", "/tmp/checkpoint") \
        .start()

    print("Streaming started. Press Ctrl+C to stop.")
    query.awaitTermination()

except KeyboardInterrupt:
    print("Stopping gracefully...")
    query.stop()

except Exception as e:
    print(f"Error: {e}")
    query.stop()

finally:
    spark.stop()</div>

                    <h3>Triggers - ×©×œ×™×˜×” ×‘×ª×“×™×¨×•×ª</h3>
                    <div class="info-box">
                        <p>Trigger ×§×•×‘×¢ ××ª×™ Spark ××¢×‘×“ batch ×—×“×© ×©×œ × ×ª×•× ×™×.</p>
                    </div>

                    <div class="code-block"># Default - micro-batches ×‘×¨×’×¢ ×©×™×© × ×ª×•× ×™×
query = df.writeStream.start()


# ProcessingTime - ×›×œ X ×–××Ÿ
query = df.writeStream \
    .trigger(processingTime='10 seconds') \
    .start()


# Once - ×¢×‘×“ batch ××—×“ ×•×¢×¦×•×¨ (×œ×‘×“×™×§×•×ª)
query = df.writeStream \
    .trigger(once=True) \
    .start()


# Continuous - experimental, latency × ××•×š ×××•×“
query = df.writeStream \
    .trigger(continuous='1 second') \
    .start()</div>

                    <h3>× ×™×˜×•×¨ Streaming Query</h3>
                    <div class="code-block"># ×‘×“×™×§×ª ×¡×˜×˜×•×¡
query.isActive  # True/False

# ××™×“×¢ ×¢×œ ×”-query
query.status

# ×”×¦×’×ª progress ××—×¨×•×Ÿ
query.lastProgress

# ×”××ª× ×” ×œ×¡×™×•×
query.awaitTermination()

# ×¢×¦×™×¨×”
query.stop()</div>

                    <h3>Stateful Streaming - × ×™×”×•×œ State</h3>
                    <div class="info-box">
                        <h3>××”×• State?</h3>
                        <p>State ×××¤×©×¨ ×œ×–×›×•×¨ ××™×“×¢ ×‘×™×Ÿ batches - ×œ×“×•×’××”, aggregations running.</p>
                    </div>

                    <div class="code-block"># ×“×•×’××” - running count per word
wordCounts = words \
    .groupBy("word") \
    .count()  # State: ×©×•××¨ count ×¢×‘×•×¨ ×›×œ word

# State × ×©××¨ ×‘-checkpoint!
query = wordCounts \
    .writeStream \
    .outputMode("update") \
    .option("checkpointLocation", "/checkpoint") \
    .format("console") \
    .start()</div>

                    <div class="code-block"># mapGroupsWithState - custom state management
from pyspark.sql.streaming import GroupState

def update_state(key, values, state):
    # key = ×”××¤×ª×— ×©×× ×—× ×• ××§×‘×¦×™× ×œ×¤×™×•
    # values = ×¢×¨×›×™× ×—×“×©×™× ×‘-batch ×”× ×•×›×—×™
    # state = ×”-state ×”×§×•×“×

    if state.exists:
        old_count = state.get
    else:
        old_count = 0

    new_count = old_count + sum(values)
    state.update(new_count)

    return (key, new_count)

# ×©×™××•×©
result = df.groupByKey(lambda x: x.key) \
           .mapGroupsWithState(update_state)</div>

                    <div class="warning-box">
                        <h3>âš ï¸ State Size</h3>
                        <p>State ×™×›×•×œ ×œ×’×“×•×œ ×××•×“! ×—×©×•×‘ ×œ×”×©×ª××© ×‘-Watermarking ×›×“×™ ×œ× ×§×•×ª state ×™×©×Ÿ.</p>
                    </div>
                </div>
            </div>

            <!-- Comparison -->
            <div id="stream-comparison" class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-purple)">â—</span> DStreams vs Structured Streaming</h2>
                </div>
                <div class="card-body">
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4>ğŸ“œ DStreams</h4>
                            <p>âœ… API ×™×©×Ÿ, ×™×¦×™×‘</p>
                            <p>âŒ ×§×©×” ×™×•×ª×¨ ×œ×©×™××•×©</p>
                            <p>âŒ ×¤×—×•×ª ××•×¤×˜×™××™×–×¦×™×•×ª</p>
                            <p>âŒ ×œ× ××•××œ×¥ ×œ×¤×¨×•×™×§×˜×™× ×—×“×©×™×</p>
                        </div>
                        <div class="feature-card">
                            <h4>âš¡ Structured Streaming</h4>
                            <p>âœ… API ××•×“×¨× ×™</p>
                            <p>âœ… ××—×™×“ ×¢× DataFrame</p>
                            <p>âœ… Catalyst Optimizer</p>
                            <p>âœ… Event Time, Watermarking</p>
                            <p>âœ… <strong>××•××œ×¥!</strong></p>
                        </div>
                    </div>
                </div>
            </div>
            </main>
        </div>
    </div>

    <!-- === ADVANCED VIEW === -->
    <div id="view-advanced" class="view-section">
        <div class="theory-layout">
            <aside class="theory-sidebar">
                <div class="theory-nav-item active" onclick="scrollToSection('adv-submit', this)">
                    <span>ğŸš€</span> Spark Submit
                </div>
                <div class="theory-nav-item" onclick="scrollToSection('adv-ui', this)">
                    <span>ğŸ“Š</span> Spark UI
                </div>
                <div class="theory-nav-item" onclick="scrollToSection('adv-performance', this)">
                    <span>âš¡</span> ×©×™×¤×•×¨ ×‘×™×¦×•×¢×™×
                </div>
                <div class="theory-nav-item" onclick="scrollToSection('adv-logs', this)">
                    <span>ğŸ“</span> × ×™×”×•×œ Logs
                </div>
                <div class="theory-nav-item" onclick="scrollToSection('adv-shutdown', this)">
                    <span>ğŸ›‘</span> Graceful Shutdown
                </div>
                <div class="theory-nav-item" onclick="scrollToSection('adv-migration', this)">
                    <span>ğŸ”„</span> Migration 1.x â†’ 2.x
                </div>
                <div class="theory-nav-item" onclick="scrollToSection('adv-tungsten', this)">
                    <span>ğŸ”¥</span> Project Tungsten
                </div>
            </aside>

            <main class="theory-content">
            <div style="text-align: center; margin-bottom: 50px;">
                <h1 style="font-size: 2.2rem; margin-bottom: 12px; font-weight: 800; color: var(--text-primary);">âš™ï¸ × ×•×©××™× ××ª×§×“××™×</h1>
                <p style="color: var(--text-secondary); font-size: 1.05rem;">Spark UI, ×‘×™×¦×•×¢×™× ×•× ×™×”×•×œ</p>
            </div>

            <!-- Spark Submit -->
            <div id="adv-submit" class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-orange)">â—</span> Spark Submit</h2>
                </div>
                <div class="card-body">
                    <div class="info-box">
                        <h3>×”×¨×¦×ª Spark Application</h3>
                        <p><code>spark-submit</code> ×”×•× ×”×›×œ×™ ×œ×”×¨×¦×ª ×™×™×©×•××™ Spark ×¢×œ Cluster.</p>
                    </div>

                    <div class="code-block"># ×ª×—×‘×™×¨ ×‘×¡×™×¡×™
spark-submit \
    --master yarn \
    --deploy-mode cluster \
    --executor-memory 4g \
    --executor-cores 4 \
    --num-executors 10 \
    --driver-memory 2g \
    --conf spark.sql.shuffle.partitions=200 \
    my_application.py</div>

                    <h3>××¤×©×¨×•×™×•×ª ×—×©×•×‘×•×ª</h3>
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4>ğŸ¯ --master</h4>
                            <p>local[*] - ××§×•××™</p>
                            <p>yarn - YARN cluster</p>
                            <p>spark://HOST:PORT - Standalone</p>
                            <p>k8s://... - Kubernetes</p>
                        </div>
                        <div class="feature-card">
                            <h4>ğŸ“ --deploy-mode</h4>
                            <p>client - Driver ×¢×œ ×”××›×•× ×” ×”××§×•××™×ª</p>
                            <p>cluster - Driver ×¢×œ ×”-Cluster</p>
                        </div>
                        <div class="feature-card">
                            <h4>âš™ï¸ Resources</h4>
                            <p>--executor-memory 4g</p>
                            <p>--executor-cores 4</p>
                            <p>--num-executors 10</p>
                            <p>--driver-memory 2g</p>
                        </div>
                        <div class="feature-card">
                            <h4>ğŸ“¦ Dependencies</h4>
                            <p>--jars - JAR files</p>
                            <p>--packages - Maven coords</p>
                            <p>--py-files - Python files</p>
                        </div>
                    </div>

                    <div class="code-block"># ×“×•×’××” ××œ××” ×¢× dependencies
spark-submit \
    --master yarn \
    --deploy-mode cluster \
    --executor-memory 8g \
    --executor-cores 4 \
    --num-executors 20 \
    --driver-memory 4g \
    --packages org.apache.spark:spark-sql-kafka-0-10_2.12:3.2.0 \
    --py-files utils.zip,helpers.py \
    --conf spark.sql.shuffle.partitions=400 \
    --conf spark.executor.memoryOverhead=2g \
    --conf spark.dynamicAllocation.enabled=true \
    --conf spark.shuffle.service.enabled=true \
    --name "MySparkApp" \
    app.py arg1 arg2</div>

                    <div class="code-block"># Python - ×§×‘×œ×ª arguments
import sys

if __name__ == "__main__":
    input_path = sys.argv[1]
    output_path = sys.argv[2]

    spark = SparkSession.builder.getOrCreate()
    # ... rest of code</div>

                    <h3>Dynamic Allocation</h3>
                    <div class="success-box">
                        <h3>âœ… ××•××œ×¥!</h3>
                        <p>Dynamic Allocation ×××¤×©×¨ ×œ-Spark ×œ×”×•×¡×™×£/×œ×”×¡×™×¨ Executors ×“×™× ××™×ª ×œ×¤×™ ×”×¢×•××¡.</p>
                    </div>

                    <div class="code-block"># ×”×¤×¢×œ×ª Dynamic Allocation
--conf spark.dynamicAllocation.enabled=true
--conf spark.shuffle.service.enabled=true
--conf spark.dynamicAllocation.minExecutors=2
--conf spark.dynamicAllocation.maxExecutors=50
--conf spark.dynamicAllocation.initialExecutors=10</div>
                </div>
            </div>

            <!-- Spark UI -->
            <div id="adv-ui" class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-blue)">â—</span> Spark UI</h2>
                </div>
                <div class="card-body">
                    <div class="info-box">
                        <h3>×××©×§ × ×™×˜×•×¨</h3>
                        <p>Spark UI ×–××™×Ÿ ×‘-http://localhost:4040 (×‘×“×¨×š ×›×œ×œ)</p>
                        <p>××¦×™×’ ××™×“×¢ ×¢×œ Jobs, Stages, Tasks, Storage ×•×¢×•×“.</p>
                    </div>

                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4>ğŸ“Š Jobs</h4>
                            <p>××™×“×¢ ×¢×œ Jobs ×©×¨×¦×•</p>
                            <p>×–××Ÿ ×‘×™×¦×•×¢, ×¡×˜×˜×•×¡</p>
                        </div>
                        <div class="feature-card">
                            <h4>ğŸ”§ Stages</h4>
                            <p>Stages ×‘×›×œ Job</p>
                            <p>DAG Visualization</p>
                        </div>
                        <div class="feature-card">
                            <h4>âš™ï¸ Tasks</h4>
                            <p>Tasks ×‘×›×œ Stage</p>
                            <p>×–×× ×™×, Executors</p>
                        </div>
                        <div class="feature-card">
                            <h4>ğŸ’¾ Storage</h4>
                            <p>RDDs/DataFrames ×‘-cache</p>
                            <p>×©×™××•×© ×‘×–×™×›×¨×•×Ÿ</p>
                        </div>
                        <div class="feature-card">
                            <h4>ğŸ–¥ï¸ Executors</h4>
                            <p>××™×“×¢ ×¢×œ Executors</p>
                            <p>××©××‘×™×, Tasks</p>
                        </div>
                        <div class="feature-card">
                            <h4>ğŸŒ Environment</h4>
                            <p>×”×’×“×¨×•×ª Spark</p>
                            <p>System Properties</p>
                        </div>
                    </div>

                    <div class="success-box">
                        <h3>ğŸ’¡ ×©×™××•×©×™×</h3>
                        <ul>
                            <li>××™×ª×•×¨ ×¦×•×•××¨×™ ×‘×§×‘×•×§ (bottlenecks)</li>
                            <li>×‘×“×™×§×ª Data Skew</li>
                            <li>××¢×§×‘ ××—×¨ ×©×™××•×© ×‘××©××‘×™×</li>
                            <li>× ×™×¤×•×™ ×‘××’×™×</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Performance Tuning -->
            <div id="adv-performance" class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-blue)">â—</span> ×©×™×¤×•×¨ ×‘×™×¦×•×¢×™×</h2>
                </div>
                <div class="card-body">
                    <h3>××•×¤×˜×™××™×–×¦×™×” ×©×œ Partitions</h3>
                    <div class="info-box">
                        <ul>
                            <li>××¡×¤×¨ ××•×¤×˜×™××œ×™: <code>2-4 partitions ×œ×›×œ CPU core</code></li>
                            <li>Partition ×’×“×•×œ ××“×™ = ×¤×—×•×ª ××§×‘×™×œ×•×ª</li>
                            <li>Partition ×§×˜×Ÿ ××“×™ = overhead ×¨×‘</li>
                        </ul>
                    </div>

                    <h3>Caching & Persistence</h3>
                    <div class="code-block"># Cache ×‘-memory
df.cache()

# ××•
df.persist()


# Cache ×¢× storage level
from pyspark import StorageLevel

df.persist(StorageLevel.MEMORY_AND_DISK)


# × ×™×§×•×™ cache
df.unpersist()</div>

                    <div class="success-box">
                        <h3>Storage Levels:</h3>
                        <ul>
                            <li><strong>MEMORY_ONLY</strong> - ×¨×§ ×–×™×›×¨×•×Ÿ (default)</li>
                            <li><strong>MEMORY_AND_DISK</strong> - ×–×™×›×¨×•×Ÿ + ×“×™×¡×§</li>
                            <li><strong>DISK_ONLY</strong> - ×¨×§ ×“×™×¡×§</li>
                            <li><strong>MEMORY_ONLY_SER</strong> - ×–×™×›×¨×•×Ÿ ××¡×™×¨×™××œ×™×–×“</li>
                        </ul>
                    </div>

                    <h3>×”×™×× ×¢×•×ª ×-Shuffle</h3>
                    <div class="warning-box">
                        <h3>âš ï¸ Shuffle ×”×•× ×™×§×¨!</h3>
                        <p>×¤×¢×•×œ×•×ª ×©×’×•×¨××•×ª ×œ-Shuffle:</p>
                        <ul>
                            <li>groupByKey, reduceByKey</li>
                            <li>join, cogroup</li>
                            <li>repartition, coalesce (×¢× ×”×’×“×œ×”)</li>
                            <li>distinct</li>
                        </ul>
                    </div>

                    <div class="code-block"># âŒ ×’×¨×•×¢ - groupByKey
rdd.groupByKey().mapValues(lambda x: sum(x))


# âœ… ×˜×•×‘ ×™×•×ª×¨ - reduceByKey
rdd.reduceByKey(lambda a, b: a + b)</div>

                    <h3>×”×’×“×¨×•×ª Spark ×—×©×•×‘×•×ª</h3>
                    <div class="code-block"># Python - ×”×’×“×¨×ª configurations
spark = SparkSession.builder \
    .appName("my_app") \
    .config("spark.executor.memory", "4g") \
    .config("spark.executor.cores", "4") \
    .config("spark.sql.shuffle.partitions", "200") \
    .config("spark.default.parallelism", "100") \
    .getOrCreate()</div>

                    <h3>Broadcast Join</h3>
                    <div class="info-box">
                        <p>×× ×˜×‘×œ×” ××—×ª ×§×˜× ×” ××¡×¤×™×§ (< 10MB), ×”×©×ª××© ×‘-Broadcast Join.</p>
                        <p>×–×” ××•× ×¢ Shuffle ×™×§×¨!</p>
                    </div>

                    <div class="code-block"># ×× ×˜×‘×œ×” ××—×ª ×§×˜× ×” (< 10MB)
from pyspark.sql.functions import broadcast

result = large_df.join(broadcast(small_df), "id")

# Spark ×™×¢×ª×™×§ ××ª small_df ×œ×›×œ Executor
# ×‘××§×•× ×œ×¢×©×•×ª Shuffle ×¢×œ large_df!</div>

                    <h3>×¤×•×¨××˜ Parquet ×¢× Partitioning</h3>
                    <div class="success-box">
                        <h3>âœ… Best Practice</h3>
                        <p>×©××•×¨ × ×ª×•× ×™× ×‘-Parquet ×¢× partitioning ×œ×¤×™ ×¢××•×“×•×ª × ×¤×•×¦×•×ª (×ª××¨×™×š, ××–×•×¨, ×•×›×•')</p>
                    </div>

                    <div class="code-block"># ×›×ª×™×‘×” ×¢× partitioning
df.write \
    .partitionBy("year", "month", "day") \
    .mode("overwrite") \
    .parquet("/data/output")

# ××‘× ×” ×”×ª×™×§×™×•×ª:
# /data/output/
#   year=2023/
#     month=01/
#       day=01/
#         part-00000.parquet
#       day=02/
#         part-00000.parquet

# ×§×¨×™××” ×¢× partition pruning
df = spark.read.parquet("/data/output")
result = df.filter("year = 2023 AND month = 1")
# Spark ×™×§×¨× ×¨×§ ××ª ×”×§×‘×¦×™× ×”×¨×œ×•×•× ×˜×™×™×!</div>

                    <h3>×¨×©×™××ª Best Practices</h3>
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4>âœ… DO</h4>
                            <p>â€¢ ×”×©×ª××© ×‘-Parquet</p>
                            <p>â€¢ Cache × ×ª×•× ×™× ×©× ××©×›×™×</p>
                            <p>â€¢ Filter ××•×§×“×</p>
                            <p>â€¢ Broadcast joins ×§×˜× ×™×</p>
                            <p>â€¢ reduceByKey ×‘××§×•× groupByKey</p>
                        </div>
                        <div class="feature-card">
                            <h4>âŒ DON'T</h4>
                            <p>â€¢ collect() ×¢×œ × ×ª×•× ×™× ×’×“×•×œ×™×</p>
                            <p>â€¢ groupByKey ×‘×œ×™ ×¦×•×¨×š</p>
                            <p>â€¢ CSV ×œ×¤×¨×•×“×§×©×Ÿ</p>
                            <p>â€¢ Partitions ×§×˜× ×™× ××“×™/×’×“×•×œ×™× ××“×™</p>
                            <p>â€¢ UDFs ×œ×œ× ×¦×•×¨×š</p>
                        </div>
                    </div>

                    <h3>×˜×™×¤×™× × ×•×¡×¤×™×</h3>
                    <div class="info-box">
                        <ul>
                            <li><strong>filter ×œ×¤× ×™ join</strong> - ×”×§×˜×Ÿ ××ª ×”× ×ª×•× ×™× ×œ×¤× ×™ ×¤×¢×•×œ×•×ª ×™×§×¨×•×ª</li>
                            <li><strong>select ×¨×§ ×¢××•×“×•×ª × ×“×¨×©×•×ª</strong> - Column Pruning</li>
                            <li><strong>repartition ×œ×¤× ×™ ×›×ª×™×‘×”</strong> - ××¡×¤×¨ ×§×‘×¦×™× ×¡×‘×™×¨</li>
                            <li><strong>coalesce ×‘××§×•× repartition</strong> - ×× ×¨×§ ××§×˜×™× ×™× partitions</li>
                            <li><strong>persist() ×¢× storage level ××ª××™×</strong> - ×œ×¤×™ ×¦×¨×›×™ ×”×–×™×›×¨×•×Ÿ</li>
                        </ul>
                    </div>

                    <div class="code-block"># ×“×•×’××” ×œ×§×•×“ ×××•×¤×˜×
result = spark.read.parquet("/data/large_table") \
    .select("id", "name", "amount", "date") \  # ×¨×§ ×¢××•×“×•×ª × ×“×¨×©×•×ª
    .filter(col("date") >= "2023-01-01") \      # ×¡×™× ×•×Ÿ ××•×§×“×
    .join(                                       # join ×œ××—×¨ filter
        broadcast(small_lookup),                 # broadcast ×œ×˜×‘×œ×” ×§×˜× ×”
        "id"
    ) \
    .groupBy("name") \
    .agg(sum("amount").alias("total")) \
    .cache()                                     # cache ×× × ×©×ª××© ×©×•×‘

# ×›×ª×™×‘×” ×¢× repartition
result.coalesce(10).write.parquet("/output")</div>
                </div>
            </div>

            <!-- Log Management -->
            <div id="adv-logs" class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-green)">â—</span> × ×™×”×•×œ Logs</h2>
                </div>
                <div class="card-body">
                    <div class="info-box">
                        <h3>log4j.properties</h3>
                        <p>Spark ××©×ª××© ×‘-Log4j ×œ× ×™×”×•×œ logs.</p>
                    </div>

                    <h3>Rolling Logs</h3>
                    <div class="code-block"># log4j.properties - Rolling File Appender

log4j.appender.RollingAppender=org.apache.log4j.RollingFileAppender
log4j.appender.RollingAppender.File=spark.log
log4j.appender.RollingAppender.MaxFileSize=100MB
log4j.appender.RollingAppender.MaxBackupIndex=10

log4j.appender.RollingAppender.layout=org.apache.log4j.PatternLayout
log4j.appender.RollingAppender.layout.ConversionPattern=[%p] %d %c - %m%n</div>

                    <h3>×”×¤×¨×“×ª Logs</h3>
                    <div class="code-block"># Spark logs
log4j.logger.org.apache.spark=INFO, RollingAppender


# User logs
log4j.logger.il.naya=WARN, userAppender


# User Appender Configuration
log4j.appender.userAppender=org.apache.log4j.RollingFileAppender
log4j.appender.userAppender.File=user.log
log4j.appender.userAppender.MaxFileSize=100MB
log4j.appender.userAppender.MaxBackupIndex=10

log4j.appender.userAppender.layout=org.apache.log4j.PatternLayout
log4j.appender.userAppender.layout.ConversionPattern=[%p] %d %c - %m%n</div>

                    <div class="success-box">
                        <h3>âœ… Best Practices</h3>
                        <ul>
                            <li>Rolling logs ×œ×× ×™×¢×ª ×§×‘×¦×™× ×¢× ×§×™×™× (×§×¨×™×˜×™!)</li>
                            <li>×”×¤×¨×“×” ×‘×™×Ÿ Application logs ×•-Spark logs</li>
                            <li>×©××™×¨×ª ×¨×§ ××™×“×¢ ×¨×œ×•×•× ×˜×™ - ×œ× DEBUG ×‘×¤×¨×•×“×§×©×Ÿ</li>
                            <li>×§×¨×™×˜×™ ×‘-Streaming applications - logs ×¦×•××—×™× ××”×¨!</li>
                            <li>×©×™××•×© ×‘-log retention policies - ××—×™×§×” ××•×˜×•××˜×™×ª ×©×œ logs ×™×©× ×™×</li>
                        </ul>
                    </div>

                    <div class="warning-box">
                        <h3>âš ï¸ × ×§×•×“×•×ª ×—×©×•×‘×•×ª</h3>
                        <ul>
                            <li><strong>Write to bigger file takes longer</strong> - ×§×‘×¦×™× ×’×“×•×œ×™× = ×›×ª×™×‘×” ××™×˜×™×ª</li>
                            <li><strong>Rolling options:</strong> ×œ×¤×™ ×’×•×“×œ ××• ×–××Ÿ</li>
                            <li><strong>Set back files to store</strong> - ×›××” ×§×‘×¦×™× ×™×©× ×™× ×œ×©××•×¨</li>
                            <li><strong>Avoid huge files</strong> - ×™×›×•×œ ×œ×’×¨×•× ×œ×‘×¢×™×•×ª ×‘×™×¦×•×¢×™×</li>
                        </ul>
                    </div>

                    <h3>×’×™×©×” ×œ-Logs</h3>
                    <div class="warning-box">
                        <h3>××™×§×•××™× × ×¤×•×¦×™×:</h3>
                        <ul>
                            <li><strong>YARN:</strong> YARN Resource Manager UI â†’ Application logs</li>
                            <li><strong>Standalone:</strong> <code>$SPARK_HOME/work</code></li>
                            <li><strong>Driver logs:</strong> STDOUT/STDERR</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Graceful Shutdown -->
            <div id="adv-shutdown" class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-purple)">â—</span> Graceful Shutdown</h2>
                </div>
                <div class="card-body">
                    <div class="warning-box">
                        <h3>âš ï¸ ×”×‘×¢×™×” ×¢× SIGTERM</h3>
                        <p>×›××©×¨ ×©×•×œ×—×™× SIGTERM ×œ-Spark:</p>
                        <ul>
                            <li>×›×œ ×”×ª×”×œ×™×›×™× × ×¢×¦×¨×™× ××™×“</li>
                            <li>Threads ×œ× × ×¡×’×¨×™× ×›×¨××•×™</li>
                            <li>× ×ª×•× ×™× ×¢×œ×•×œ×™× ×œ×œ×›×ª ×œ××™×‘×•×“</li>
                        </ul>
                    </div>

                    <h3>Graceful Shutdown - Configuration</h3>
                    <div class="code-block"># ×”×•×¡×¤×ª configuration
spark.streaming.stopGracefullyOnShutdown = true</div>

                    <h3>Shutdown Listener</h3>
                    <div class="code-block"># Python - Graceful Shutdown
import atexit
from time import sleep


def graceful_shutdown(spark, query_stream):
    """×¢×¦×™×¨×” ×—×œ×§×” ×©×œ Streaming"""
    query_stream.stop()

    while query_stream.isActive():
        sleep(5)

    spark.stop()


# ×¨×™×©×•× ×”-shutdown handler
atexit.register(graceful_shutdown, spark, query_stream)</div>

                    <h3>×¢× While Loop ×‘××§×•× awaitTermination</h3>
                    <div class="code-block"># ×‘××§×•× awaitTermination
# query.awaitTermination()


# ×”×©×ª××© ×‘-while loop
import signal
import sys

stop_flag = False


def signal_handler(sig, frame):
    global stop_flag
    print("Stopping gracefully...")
    stop_flag = True


signal.signal(signal.SIGTERM, signal_handler)
signal.signal(signal.SIGINT, signal_handler)


while not stop_flag:
    if not query.isActive:
        break
    sleep(1)


graceful_shutdown(spark, query)</div>

                    <div class="success-box">
                        <h3>âœ… ×™×ª×¨×•× ×•×ª Graceful Shutdown</h3>
                        <ul>
                            <li>×¡×™×•× × ×§×™ ×©×œ ×›×œ ×”-batches</li>
                            <li>×©××™×¨×ª checkpoints</li>
                            <li>×¡×’×™×¨×” × ×›×•× ×” ×©×œ connections</li>
                            <li>××™×Ÿ ××•×‘×“×Ÿ × ×ª×•× ×™×</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Migration -->
            <div id="adv-migration" class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-red)">â—</span> Migration: Spark 1.x â†’ 2.x</h2>
                </div>
                <div class="card-body">
                    <div class="info-box">
                        <h3>×©×™× ×•×™×™× ×¢×™×§×¨×™×™×</h3>
                    </div>

                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4>ğŸ”„ SparkSession</h4>
                            <p><strong>Spark 1.x:</strong> SQLContext, HiveContext</p>
                            <p><strong>Spark 2.x:</strong> SparkSession (×××•×—×“)</p>
                        </div>
                        <div class="feature-card">
                            <h4>ğŸ“Š Dataset API</h4>
                            <p>DataFrame = Dataset[Row]</p>
                            <p>API ×××•×—×“ ×•××©×•×¤×¨</p>
                        </div>
                        <div class="feature-card">
                            <h4>âš¡ Structured Streaming</h4>
                            <p>API ×—×“×© ×œ-streaming</p>
                            <p>××—×œ×™×£ DStreams</p>
                        </div>
                        <div class="feature-card">
                            <h4>ğŸš€ Catalyst Optimizer</h4>
                            <p>×©×™×¤×•×¨×™× ××©××¢×•×ª×™×™×</p>
                            <p>×‘×™×¦×•×¢×™× ×˜×•×‘×™× ×™×•×ª×¨</p>
                        </div>
                    </div>

                    <div class="code-block"># Spark 1.x
from pyspark import SparkContext
from pyspark.sql import SQLContext

sc = SparkContext()
sqlContext = SQLContext(sc)
df = sqlContext.read.json("file.json")


# ============================================

# Spark 2.x
from pyspark.sql import SparkSession

spark = SparkSession.builder.getOrCreate()
df = spark.read.json("file.json")</div>

                    <h3>SQLContext vs HiveContext (Spark 1.x)</h3>
                    <div class="info-box">
                        <p>×‘-Spark 1.x ×”×™×• ×©× ×™ contexts × ×¤×¨×“×™×:</p>
                        <ul>
                            <li><strong>SQLContext</strong> - ×¤×•× ×§×¦×™×•× ×œ×™×•×ª SQL ×‘×¡×™×¡×™×ª</li>
                            <li><strong>HiveContext</strong> - SQLContext + ×ª××™×›×” ×‘-Hive (Window functions, UDAFs)</li>
                        </ul>
                        <p>×‘-Spark 2.x, SparkSession ×›×•×œ×œ ××ª ×›×œ ×”×¤×•× ×§×¦×™×•× ×œ×™×•×ª!</p>
                    </div>

                    <div class="code-block"># Spark 1.x - HiveContext
from pyspark.sql import HiveContext

hiveContext = HiveContext(sc)
df = hiveContext.sql("SELECT * FROM hive_table")


# Spark 2.x - ×”×›×œ ×‘-SparkSession
spark = SparkSession.builder \
    .enableHiveSupport() \
    .getOrCreate()

df = spark.sql("SELECT * FROM hive_table")</div>

                    <div class="success-box">
                        <h3>âœ… ×™×ª×¨×•× ×•×ª Spark 2.x</h3>
                        <ul>
                            <li><strong>API ×××•×—×“</strong> - SparkSession ×‘××§×•× ××¡×¤×¨ contexts</li>
                            <li><strong>Structured Streaming</strong> - API ×—×“×© ×œ×–××Ÿ ×××ª</li>
                            <li><strong>Tungsten Phase 2</strong> - Whole-stage code generation</li>
                            <li><strong>Native CSV/JSON</strong> - ×ª××™×›×” ××•×‘× ×™×ª</li>
                            <li><strong>Vectorized Parquet</strong> - ×§×¨×™××” ××”×™×¨×” ×™×•×ª×¨</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Tungsten -->
            <div id="adv-tungsten" class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-green)">â—</span> Project Tungsten</h2>
                </div>
                <div class="card-body">
                    <div class="info-box">
                        <h3>××”×• Tungsten?</h3>
                        <p><strong>Project Tungsten</strong> ×”×•× ×× ×•×¢ ×”×‘×™×¦×•×¢ ×”××©×•×“×¨×’ ×©×œ Spark.</p>
                        <p>×©×™×¤×•×¨×™× ××©××¢×•×ª×™×™× ×‘× ×™×”×•×œ ×–×™×›×¨×•×Ÿ ×•×‘×™×¦×•×¢×™ CPU.</p>
                    </div>

                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4>ğŸ’¾ Memory Management</h4>
                            <p>× ×™×”×•×œ ×–×™×›×¨×•×Ÿ off-heap ×™×“× ×™</p>
                            <p>×¤×—×•×ª Garbage Collection</p>
                        </div>
                        <div class="feature-card">
                            <h4>âš¡ Cache-aware</h4>
                            <p>××‘× ×” × ×ª×•× ×™× ××•×ª×× ×œCache</p>
                            <p>×’×™×©×” ×¨×¦×™×¤×” ×œ×–×™×›×¨×•×Ÿ</p>
                        </div>
                        <div class="feature-card">
                            <h4>ğŸ”§ Code Generation</h4>
                            <p>Whole-stage codegen</p>
                            <p>×§×•×“ ×××•×˜× ×‘×–××Ÿ ×¨×™×¦×”</p>
                        </div>
                        <div class="feature-card">
                            <h4>ğŸ“Š Binary Format</h4>
                            <p>×¤×•×¨××˜ ×‘×™× ××¨×™ ×§×•××¤×§×˜×™</p>
                            <p>×¤×—×•×ª overhead</p>
                        </div>
                    </div>

                    <div class="success-box">
                        <h3>Whole-Stage Code Generation</h3>
                        <p>Tungsten ×™×•×¦×¨ ×§×•×“ Java ×××•×˜× ×¢×‘×•×¨ ×›×œ ×”-pipeline!</p>
                        <p>×‘××§×•× ×œ×§×¨×•× ×œ×¤×•× ×§×¦×™×•×ª ×•×™×¨×˜×•××œ×™×•×ª ×¢×‘×•×¨ ×›×œ ×©×•×¨×”, ×”×•× ×™×•×¦×¨ ×§×•×“ ××—×“ ×™×¢×™×œ.</p>
                    </div>

                    <div class="code-block"># ×“×•×’××” - Spark ×™×•×¦×¨ ×§×•×“ ×××•×˜× ×¢×‘×•×¨:
df.filter(col("age") > 25) \
  .select("name", "age") \
  .groupBy("name").count()

# ×‘××§×•×:
# for each row:
#   if filter(row):
#     row = select(row)
#     aggregate(row)

# Tungsten ×™×•×¦×¨:
# for each row:
#   if row.age > 25:
#     count[row.name]++

# ×”×›×œ ×‘×œ×•×œ××” ××—×ª - ××”×™×¨ ×”×¨×‘×” ×™×•×ª×¨!</div>

                    <div class="warning-box">
                        <h3>ğŸ’¡ ×˜×™×¤</h3>
                        <p>Tungsten ×¢×•×‘×“ ××•×˜×•××˜×™×ª! ××™×Ÿ ×¦×•×¨×š ×‘×©×™× ×•×™×™× ×‘×§×•×“.</p>
                        <p>× ×™×ª×Ÿ ×œ×¨××•×ª ××ª ×”×§×•×“ ×©× ×•×¦×¨ ×¢×: <code>df.explain(mode="codegen")</code></p>
                    </div>
                </div>
            </div>
            </main>
        </div>
    </div>

    <!-- === TROUBLESHOOTING VIEW === -->
    <div id="view-troubleshooting" class="view-section">
        <div style="max-width: 1200px; margin: 0 auto;">
            <div style="text-align: center; margin-bottom: 50px;">
                <h1 style="font-size: 2.2rem; margin-bottom: 12px; font-weight: 800; color: var(--text-primary);">ğŸ”§ ××“×¨×™×š ×¤×ª×¨×•×Ÿ ×‘×¢×™×•×ª</h1>
                <p style="color: var(--text-secondary); font-size: 1.05rem;">×¤×ª×¨×•× ×•×ª ×œ×‘×¢×™×•×ª × ×¤×•×¦×•×ª ×‘-Spark</p>
            </div>

            <!-- Error 1: Out of Memory -->
            <div class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-red)">âŒ</span> Out of Memory Errors</h2>
                </div>
                <div class="card-body">
                    <div class="warning-box">
                        <h3>×©×’×™××•×ª × ×¤×•×¦×•×ª:</h3>
                        <code style="display: block; background: #2d2d2d; color: #ff6b6b; padding: 10px; border-radius: 4px; margin: 10px 0; direction: ltr; text-align: left;">
Container [pid=12345] is running beyond physical memory limits.<br>
Current usage: 1.6 GB of 1.4 GB physical memory used.<br>
Killing container.
                        </code>
                        <code style="display: block; background: #2d2d2d; color: #ff6b6b; padding: 10px; border-radius: 4px; margin: 10px 0; direction: ltr; text-align: left;">
java.lang.OutOfMemoryError: GC overhead limit exceeded
                        </code>
                    </div>

                    <div class="success-box">
                        <h3>âœ… ×¤×ª×¨×•× ×•×ª:</h3>
                        <h4>1. ×”×’×“×œ×ª Executor Memory</h4>
                        <div class="code-block">spark-submit \
    --executor-memory 8g \
    --driver-memory 4g \
    --executor-cores 4 \
    my_app.py</div>

                        <h4>2. ×”×§×˜× ×ª Executor Cores (×¤×—×•×ª tasks ×‘××§×‘×™×œ)</h4>
                        <div class="code-block">spark-submit \
    --executor-cores 2 \  # ×‘××§×•× 4-5
    --executor-memory 4g \
    my_app.py</div>

                        <h4>3. ×”×’×“×œ×ª ××¡×¤×¨ Partitions</h4>
                        <div class="code-block"># ×™×•×ª×¨ partitions = ×¤×—×•×ª × ×ª×•× ×™× per task
spark.conf.set("spark.sql.shuffle.partitions", "400")  # default: 200

# ××•
df = df.repartition(400)</div>

                        <h4>4. ×”×©×ª××© ×‘-Memory-Efficient Transformations</h4>
                        <div class="code-block"># âŒ ×’×¨×•×¢ - ××‘×™× ×”×›×œ ×œ-Driver
data = df.collect()

# âœ… ×˜×•×‘ - ×¢×™×‘×•×“ ×‘-Cluster
df.write.parquet("/output")

# âŒ ×’×¨×•×¢ - groupByKey
rdd.groupByKey().mapValues(sum)

# âœ… ×˜×•×‘ - reduceByKey (local aggregation)
rdd.reduceByKey(lambda a,b: a+b)</div>

                        <h4>5. Memory Overhead</h4>
                        <div class="code-block">spark-submit \
    --conf spark.executor.memoryOverhead=2g \
    --executor-memory 6g \
    my_app.py</div>
                    </div>
                </div>
            </div>

            <!-- Error 2: Slow Performance -->
            <div class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-orange)">ğŸŒ</span> ×‘×™×¦×•×¢×™× ××™×˜×™×™×</h2>
                </div>
                <div class="card-body">
                    <div class="warning-box">
                        <h3>×ª×¡××™× ×™×:</h3>
                        <ul>
                            <li>Job ×œ×•×§×— ×©×¢×•×ª ×‘××§×•× ×“×§×•×ª</li>
                            <li>×¨×•×‘ ×”-Tasks ××¡×ª×™×™××™× ××”×¨, ××‘×œ ×›××” Tasks ×œ×•×§×—×™× × ×¦×—</li>
                            <li>Shuffle Write/Read ×’×‘×•×” ×××•×“ ×‘-Spark UI</li>
                        </ul>
                    </div>

                    <div class="success-box">
                        <h3>âœ… ×¤×ª×¨×•× ×•×ª:</h3>
                        <h4>1. Data Skew - ×—×œ×•×§×” ×œ× ××—×™×“×”</h4>
                        <div class="code-block"># ×‘×“×™×§×” - ×”×× ×™×© ××¤×ª×— ×¢× ×”×¨×‘×” ×¢×¨×›×™×?
df.groupBy("key").count().orderBy(col("count").desc()).show()

# ×¤×ª×¨×•×Ÿ: Salting
from pyspark.sql.functions import rand, concat

df_salted = df.withColumn("salted_key",
    concat(col("key"), lit("_"), (rand() * 10).cast("int")))

result = df_salted.groupBy("salted_key").agg(...)

# ×”×¡×¨×ª salt
final = result.withColumn("key", split(col("salted_key"), "_")[0]) \
              .groupBy("key").agg(...)</div>

                        <h4>2. Shuffle Optimization</h4>
                        <div class="code-block"># ×”×§×˜× ×ª Shuffle
# âœ… filter ×œ×¤× ×™ join
df1.filter(col("date") > "2023-01-01").join(df2, "id")

# âœ… Broadcast join ×œ×˜×‘×œ××•×ª ×§×˜× ×•×ª
from pyspark.sql.functions import broadcast
large_df.join(broadcast(small_df), "id")

# âœ… Partition pruning ×¢× Parquet
df.write.partitionBy("year", "month").parquet("/data")
# ×§×¨×™××” ×¨×§ ×©×œ × ×ª×•× ×™× ×¨×œ×•×•× ×˜×™×™×
spark.read.parquet("/data").filter("year=2023 AND month=12")</div>

                        <h4>3. Caching × ×›×•×Ÿ</h4>
                        <div class="code-block"># cache × ×ª×•× ×™× ×©× ××©×›×™× ×™×•×ª×¨ ××¤×¢× ××—×ª
df_cached = df.filter(...).cache()

df_cached.count()  # ××¤×¢×™×œ ××ª ×”-cache
df_cached.show()   # ××”×™×¨!
df_cached.write.parquet("/output")  # ××”×™×¨!

# × ×™×§×•×™ ×‘×¡×•×£
df_cached.unpersist()</div>

                        <h4>4. AQE - Adaptive Query Execution (Spark 3.0+)</h4>
                        <div class="code-block">spark.conf.set("spark.sql.adaptive.enabled", "true")
spark.conf.set("spark.sql.adaptive.coalescePartitions.enabled", "true")
spark.conf.set("spark.sql.adaptive.skewJoin.enabled", "true")</div>
                    </div>
                </div>
            </div>

            <!-- Error 3: Connection Timeout -->
            <div class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-purple)">â±ï¸</span> Connection Timeout</h2>
                </div>
                <div class="card-body">
                    <div class="warning-box">
                        <h3>×©×’×™××•×ª:</h3>
                        <code style="display: block; background: #2d2d2d; color: #ff6b6b; padding: 10px; border-radius: 4px; margin: 10px 0; direction: ltr; text-align: left;">
java.util.concurrent.TimeoutException: Futures timed out after [120 seconds]
                        </code>
                    </div>

                    <div class="success-box">
                        <h3>âœ… ×¤×ª×¨×•× ×•×ª:</h3>
                        <div class="code-block"># ×”×’×“×œ×ª Timeouts
spark.conf.set("spark.network.timeout", "600s")  # default: 120s
spark.conf.set("spark.executor.heartbeatInterval", "60s")
spark.conf.set("spark.sql.broadcastTimeout", "600")  # Broadcast timeout</div>
                    </div>
                </div>
            </div>

            <!-- Error 4: File Not Found -->
            <div class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-blue)">ğŸ“</span> File Not Found / Permission Denied</h2>
                </div>
                <div class="card-body">
                    <div class="warning-box">
                        <h3>×©×’×™××•×ª:</h3>
                        <code style="display: block; background: #2d2d2d; color: #ff6b6b; padding: 10px; border-radius: 4px; margin: 10px 0; direction: ltr; text-align: left;">
org.apache.hadoop.mapred.InvalidInputException: Input path does not exist
                        </code>
                    </div>

                    <div class="success-box">
                        <h3>âœ… ×¤×ª×¨×•× ×•×ª:</h3>
                        <div class="code-block"># ×‘×“×™×§×ª ×§×™×•× ×”×§×•×‘×¥
from pyspark.sql.utils import AnalysisException

try:
    df = spark.read.parquet("/path/to/data")
except AnalysisException as e:
    print(f"File not found: {e}")

# ×§×¨×™××” ×¢× ××¤×©×¨×•×ª ×œ×§×‘×¦×™× ×—×¡×¨×™×
df = spark.read.option("pathGlobFilter", "*.parquet") \
               .option("recursiveFileLookup", "true") \
               .parquet("/path/to/data")

# ×‘×“×™×§×ª ×”×¨×©××•×ª
# ×•×•×“× ×©-HDFS/S3 permissions × ×›×•× ×™×
# hdfs dfs -ls /path/to/data
# hdfs dfs -chmod 755 /path/to/data</div>
                    </div>
                </div>
            </div>

            <!-- Error 5: Spark UI / Debug -->
            <div class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-green)">ğŸ”</span> ××™×š ×œ× ×¤×•×ª ×‘××’×™×</h2>
                </div>
                <div class="card-body">
                    <div class="info-box">
                        <h3>Spark UI - http://localhost:4040</h3>
                        <h4>1. Jobs Tab</h4>
                        <ul>
                            <li>×‘×“×•×§ ××™×–×” Job ×œ×•×§×— ×”×›×™ ×”×¨×‘×” ×–××Ÿ</li>
                            <li>×œ×—×¥ ×¢×œ Job ×›×“×™ ×œ×¨××•×ª Stages</li>
                        </ul>

                        <h4>2. Stages Tab</h4>
                        <ul>
                            <li>×‘×“×•×§ Duration - ××™×–×” Stage ××™×˜×™?</li>
                            <li>Shuffle Read/Write - ×’×‘×•×” = ×‘×¢×™×”!</li>
                            <li>Tasks - ×”×× ×™×© Tasks ×©×œ×•×§×—×™× ×”×¨×‘×” ×™×•×ª×¨ ×–××Ÿ? â†’ Data Skew</li>
                        </ul>

                        <h4>3. Storage Tab</h4>
                        <ul>
                            <li>×‘×“×•×§ RDDs/DataFrames ×©×‘-cache</li>
                            <li>Size in Memory - ×”×× ××ª××™× ×œ-Executor Memory?</li>
                        </ul>

                        <h4>4. Executors Tab</h4>
                        <ul>
                            <li>GC Time - ×’×‘×•×”? â†’ ×”×’×“×œ Executor Memory</li>
                            <li>Shuffle Read/Write - ×œ× ×××•×–×Ÿ? â†’ Data Skew</li>
                        </ul>
                    </div>

                    <div class="code-block"># ×”×¦×’×ª Execution Plan
df.explain(True)  # Logical + Physical + Optimized

# Output:
# == Parsed Logical Plan ==
# == Analyzed Logical Plan ==
# == Optimized Logical Plan ==
# == Physical Plan ==</div>

                    <div class="success-box">
                        <h3>ğŸ’¡ Debug Checklist</h3>
                        <ol>
                            <li>âœ… ×‘×“×•×§ Spark UI - ××™×¤×” ×”×–××Ÿ ×”×•×œ×š?</li>
                            <li>âœ… explain() - ×”×× ×™×© Shuffle ××™×•×ª×¨?</li>
                            <li>âœ… ×‘×“×•×§ Data Skew - groupBy("key").count()</li>
                            <li>âœ… ×‘×“×•×§ Memory - GC Time ×‘-Executors Tab</li>
                            <li>âœ… ×‘×“×•×§ Partitions - getNumPartitions()</li>
                            <li>âœ… ×‘×“×•×§ Logs - YARN/Spark logs</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- === CHEAT SHEET VIEW === -->
    <div id="view-cheatsheet" class="view-section">
        <div style="max-width: 1600px; margin: 0 auto;">
            <div style="text-align: center; margin-bottom: 50px;">
                <h1 style="font-size: 2.5rem; margin-bottom: 12px; font-weight: 800; color: var(--text-primary);">ğŸ“‹ PySpark - ××“×¨×™×š ××”×™×¨ ×•××§×™×£</h1>
                <p style="color: var(--text-secondary); font-size: 1.1rem;">×›×œ ×”×¤×§×•×“×•×ª, ×”×¤×•× ×§×¦×™×•×ª ×•×”×˜×™×¤×™× ×‘××§×•× ××—×“</p>
            </div>

            <!-- SparkSession -->
            <div class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-orange)">â—</span> ğŸš€ ××ª×—×•×œ - SparkSession & SparkContext</h2>
                </div>
                <div class="card-body">
                    <div class="code-block"># Spark 2.0+ - SparkSession (××•××œ×¥!)
from pyspark.sql import SparkSession

spark = SparkSession.builder \
    .appName("My App") \
    .master("local[*]") \
    .config("spark.sql.shuffle.partitions", "200") \
    .config("spark.executor.memory", "4g") \
    .getOrCreate()

# ×§×‘×œ×ª SparkContext ×-SparkSession (×œRDD)
sc = spark.sparkContext

# Spark 1.x - SparkContext (×™×©×Ÿ, ×¨×§ ×œ-RDD)
from pyspark import SparkContext
sc = SparkContext(master='local[*]', appName='my_app')

# ×¡×’×™×¨×”
spark.stop()</div>
                </div>
            </div>

            <!-- Creating DataFrames & RDDs -->
            <div class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-blue)">â—</span> ğŸ“ ×™×¦×™×¨×ª DataFrames & RDDs</h2>
                </div>
                <div class="card-body">
                    <div class="info-box">
                        <h3>ğŸ¯ sc.parallelize() vs .rdd - Quick Reference</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                            <div>
                                <h4 style="color: var(--spark-orange);">sc.parallelize(data)</h4>
                                <p><strong>Use when:</strong> You have Python list/tuple</p>
                                <div class="code-block" style="font-size: 0.8rem; margin-top: 10px;">data = [1, 2, 3, 4]
rdd = sc.parallelize(data)</div>
                            </div>
                            <div>
                                <h4 style="color: var(--spark-blue);">.rdd</h4>
                                <p><strong>Use when:</strong> Convert DataFrame â†’ RDD</p>
                                <div class="code-block" style="font-size: 0.8rem; margin-top: 10px;">df = spark.read.csv("file.csv")
rdd = df.rdd</div>
                            </div>
                        </div>
                        <p style="margin-top: 15px; font-weight: 600; color: var(--spark-orange);">
                            ğŸ’¡ Production tip: Prefer DataFrames over RDDs (Catalyst optimizer!)
                        </p>
                    </div>

                    <div class="feature-grid" style="grid-template-columns: repeat(2, 1fr);">
                        <div>
                            <h3 style="color: var(--spark-orange); margin-bottom: 15px;">ğŸ“Š DataFrame</h3>
                            <div class="code-block"># ××§×•×‘×¥
df = spark.read.json("/path/file.json")
df = spark.read.csv("/path/file.csv", header=True)
df = spark.read.parquet("/path/file.parquet")
df = spark.read.text("/path/file.txt")

# ×× ×ª×•× ×™× ×‘×–×™×›×¨×•×Ÿ
data = [("Alice", 25), ("Bob", 30)]
df = spark.createDataFrame(data, ["name", "age"])

# ×-Pandas
pandas_df = pd.DataFrame({"name": ["Alice"], "age": [25]})
df = spark.createDataFrame(pandas_df)

# ×-RDD
from pyspark.sql import Row
rdd = sc.textFile("/path/people.txt")
parts = rdd.map(lambda l: l.split(","))
people = parts.map(lambda p: Row(name=p[0], age=int(p[1])))
df = spark.createDataFrame(people)</div>
                        </div>

                        <div>
                            <h3 style="color: var(--spark-blue); margin-bottom: 15px;">ğŸ”¥ RDD</h3>
                            <div class="code-block"># ××§×•×‘×¥ ××• ×ª×™×§×™×™×”
rdd = sc.textFile('/data/file.txt')
rdd = sc.textFile('hdfs://host:8020/data/')
rdd = sc.textFile('s3a://bucket/data/')
rdd = sc.textFile('file:///local/path/')

# ×¨×§ CSV files
rdd = sc.textFile('/data/*.csv')

# ×× ×ª×•× ×™× ×‘×–×™×›×¨×•×Ÿ
data = [1, 2, 3, 4, 5]
rdd = sc.parallelize(data)

# Pair RDD (Key-Value)
data = [('apple', 5), ('banana', 3)]
pair_rdd = sc.parallelize(data)

# ×-DataFrame
rdd = df.rdd</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RDD Operations -->
            <div class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-green)">â—</span> ğŸ”¥ RDD - ×›×œ ×”×¤×¢×•×œ×•×ª</h2>
                </div>
                <div class="card-body">
                    <h3>ğŸ”„ Transformations (Lazy - ×œ× ××ª×‘×¦×¢×•×ª ××™×“)</h3>
                    <div style="overflow-x: auto; margin: 20px 0;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                            <thead style="background: linear-gradient(to left, #fff3e0, #ffe0b2); border-bottom: 2px solid var(--spark-orange);">
                                <tr>
                                    <th style="padding: 12px; text-align: left; border: 1px solid var(--border-color); font-weight: 700; direction: ltr;">×¤×¢×•×œ×”</th>
                                    <th style="padding: 12px; text-align: right; border: 1px solid var(--border-color); font-weight: 700;">×ª×™××•×¨</th>
                                    <th style="padding: 12px; text-align: left; border: 1px solid var(--border-color); font-weight: 700; direction: ltr;">×“×•×’××”</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">map(func)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">××™×¤×•×™ 1:1 - ××—×–×™×¨ RDD ×—×“×© ×¢× func ×¢×œ ×›×œ ××œ×× ×˜</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">rdd.map(lambda x: x * 2)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">filter(func)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×¡×™× ×•×Ÿ - ××—×–×™×¨ ×¨×§ ××œ×× ×˜×™× ×©×¢×•×‘×¨×™× ××ª ×”×ª× ××™</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">rdd.filter(lambda x: x > 10)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">flatMap(func)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">××™×¤×•×™ 1:N + ×”×©×˜×—×” - ×›×œ ××œ×× ×˜ ×™×›×•×œ ×œ×”×—×–×™×¨ 0 ××• ×™×•×ª×¨</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">rdd.flatMap(lambda x: x.split())</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">mapPartitions(func)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×¢×™×‘×•×“ partition ×©×œ× ×‘×‘×ª ××—×ª (×™×¢×™×œ!)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">rdd.mapPartitions(process_part)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">distinct()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×¢×¨×›×™× ×™×™×—×•×“×™×™× ×‘×œ×‘×“</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">rdd.distinct()</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">union(other)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">××™×—×•×“ ×©× ×™ RDDs (×›×•×œ×œ ×›×¤×™×œ×•×™×•×ª)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">rdd1.union(rdd2)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">intersect(other)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×—×™×ª×•×š - ×¢×¨×›×™× ××©×•×ª×¤×™×</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">rdd1.intersect(rdd2)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">subtract(other)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×”×¤×¨×© - ×¢×¨×›×™× ×‘-rdd1 ×©×œ× ×‘-rdd2</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">rdd1.subtract(rdd2)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">sample(fraction)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×“×’×™××” ××§×¨××™×ª</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">rdd.sample(False, 0.1)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">coalesce(n)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×”×§×˜× ×ª ××¡×¤×¨ partitions (×œ×œ× shuffle)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">rdd.coalesce(1)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">repartition(n)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×©×™× ×•×™ ××¡×¤×¨ partitions (×¢× shuffle)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">rdd.repartition(10)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h3>ğŸ”‘ Pair RDD Transformations (Key-Value)</h3>
                    <div style="overflow-x: auto; margin: 20px 0;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                            <thead style="background: linear-gradient(to left, #e3f2fd, #bbdefb); border-bottom: 2px solid var(--spark-blue);">
                                <tr>
                                    <th style="padding: 12px; text-align: left; border: 1px solid var(--border-color); font-weight: 700; direction: ltr;">×¤×¢×•×œ×”</th>
                                    <th style="padding: 12px; text-align: right; border: 1px solid var(--border-color); font-weight: 700;">×ª×™××•×¨</th>
                                    <th style="padding: 12px; text-align: left; border: 1px solid var(--border-color); font-weight: 700; direction: ltr;">×“×•×’××”</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-blue); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">reduceByKey(func)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×¦××¦×•× ×œ×¤×™ ××¤×ª×— (×™×¢×™×œ! ×¢× local reduce)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">pairs.reduceByKey(lambda a,b: a+b)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-blue); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">groupByKey()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×§×™×‘×•×¥ ×¢×¨×›×™× ×œ×¤×™ ××¤×ª×— (×¤×—×•×ª ×™×¢×™×œ!)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">pairs.groupByKey()</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-blue); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">mapValues(func)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">map ×¨×§ ×¢×œ ×”×¢×¨×›×™× (×©×•××¨ partitioning!)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">pairs.mapValues(lambda x: x * 2)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-blue); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">flatMapValues(func)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">flatMap ×¨×§ ×¢×œ ×”×¢×¨×›×™×</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">pairs.flatMapValues(lambda x: x)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-blue); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">keys() / values()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×”×—×–×¨×ª ×¨×§ ×”××¤×ª×—×•×ª / ×”×¢×¨×›×™×</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">pairs.keys() / pairs.values()</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-blue); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">sortByKey()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">××™×•×Ÿ ×œ×¤×™ ××¤×ª×—</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">pairs.sortByKey(ascending=True)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-blue); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">join(other)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">Inner join ×¢×œ ××¤×ª×—</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">rdd1.join(rdd2)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-blue); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">leftOuterJoin(other)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">Left outer join</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">rdd1.leftOuterJoin(rdd2)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h3>âš¡ Actions (××¤×¢×™×œ×•×ª ×‘×™×¦×•×¢ ×‘×¤×•×¢×œ!)</h3>
                    <div style="overflow-x: auto; margin: 20px 0;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                            <thead style="background: linear-gradient(to left, #e8f5e9, #c8e6c9); border-bottom: 2px solid var(--spark-green);">
                                <tr>
                                    <th style="padding: 12px; text-align: left; border: 1px solid var(--border-color); font-weight: 700; direction: ltr;">×¤×¢×•×œ×”</th>
                                    <th style="padding: 12px; text-align: right; border: 1px solid var(--border-color); font-weight: 700;">×ª×™××•×¨</th>
                                    <th style="padding: 12px; text-align: left; border: 1px solid var(--border-color); font-weight: 700; direction: ltr;">×“×•×’××”</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-green); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">collect()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×”×—×–×¨×ª ×›×œ ×”××œ×× ×˜×™× ×œ-Driver (×–×”×™×¨×•×ª! ×¨×§ ×œ× ×ª×•× ×™× ×§×˜× ×™×)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">rdd.collect()</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-green); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">count()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×¡×¤×™×¨×ª ××¡×¤×¨ ××œ×× ×˜×™×</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">rdd.count()</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-green); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">first()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×”×—×–×¨×ª ××œ×× ×˜ ×¨××©×•×Ÿ</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">rdd.first()</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-green); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">take(n)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×”×—×–×¨×ª N ××œ×× ×˜×™× ×¨××©×•× ×™×</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">rdd.take(10)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-green); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">reduce(func)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×¦××¦×•× ×œ×¢×¨×š ×™×—×™×“</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">rdd.reduce(lambda a,b: a+b)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-green); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">saveAsTextFile(path)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×©××™×¨×” ×›×§×‘×¦×™ ×˜×§×¡×˜</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">rdd.saveAsTextFile("/path")</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-green); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">countByKey()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×¡×¤×™×¨×ª ×¢×¨×›×™× ×œ×›×œ ××¤×ª×— (Pair RDD)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">pairs.countByKey()</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-green); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">collectAsMap()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×”××¨×” ×œ-dictionary (Pair RDD)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">pairs.collectAsMap()</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h3>ğŸ“Š Cache & Persistence</h3>
                    <div style="overflow-x: auto; margin: 20px 0;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                            <thead style="background: linear-gradient(to left, #f3e5f5, #e1bee7); border-bottom: 2px solid var(--spark-purple);">
                                <tr>
                                    <th style="padding: 12px; text-align: left; border: 1px solid var(--border-color); font-weight: 700; direction: ltr;">×¤×¢×•×œ×”</th>
                                    <th style="padding: 12px; text-align: right; border: 1px solid var(--border-color); font-weight: 700;">×ª×™××•×¨</th>
                                    <th style="padding: 12px; text-align: left; border: 1px solid var(--border-color); font-weight: 700; direction: ltr;">×“×•×’××”</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-purple); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">cache()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×©××™×¨×” ×‘×–×™×›×¨×•×Ÿ (MEMORY_ONLY)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">rdd.cache()</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-purple); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">persist(level)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×©××™×¨×” ×¢× storage level ××•×ª××</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">rdd.persist(MEMORY_AND_DISK)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-purple); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">unpersist()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×”×¡×¨×” ×-cache</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">rdd.unpersist()</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-purple); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">getNumPartitions()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">××¡×¤×¨ partitions</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">rdd.getNumPartitions()</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="warning-box">
                        <h3>ğŸ’¡ ×˜×™×¤ ×—×©×•×‘ - reduceByKey vs groupByKey</h3>
                        <p><strong>âœ… reduceByKey</strong> - ××‘×¦×¢ local reduce ×œ×¤× ×™ shuffle â†’ ×™×¢×™×œ ×××•×“!</p>
                        <p><strong>âŒ groupByKey</strong> - ××¢×‘×™×¨ ××ª ×›×œ ×”× ×ª×•× ×™× ×“×¨×š ×”×¨×©×ª â†’ ××™×˜×™!</p>
                        <div class="code-block" style="margin-top: 15px;"># âŒ ×œ× ×™×¢×™×œ
pairs.groupByKey().mapValues(lambda vals: sum(vals))

# âœ… ×™×¢×™×œ ×”×¨×‘×” ×™×•×ª×¨!
pairs.reduceByKey(lambda a,b: a+b)</div>
                    </div>
                </div>
            </div>

            <!-- DataFrame Operations -->
            <div class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-orange)">â—</span> ğŸ“Š DataFrame - ×¤×¢×•×œ×•×ª ×¢×™×§×¨×™×•×ª</h2>
                </div>
                <div class="card-body">
                    <div style="overflow-x: auto; margin: 20px 0;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                            <thead style="background: linear-gradient(to left, #fff3e0, #ffe0b2); border-bottom: 2px solid var(--spark-orange);">
                                <tr>
                                    <th style="padding: 12px; text-align: left; border: 1px solid var(--border-color); font-weight: 700; direction: ltr;">×¤×¢×•×œ×”</th>
                                    <th style="padding: 12px; text-align: right; border: 1px solid var(--border-color); font-weight: 700;">×ª×™××•×¨</th>
                                    <th style="padding: 12px; text-align: left; border: 1px solid var(--border-color); font-weight: 700; direction: ltr;">×“×•×’××”</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">select()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×‘×—×™×¨×ª ×¢××•×“×•×ª (×¢× cast ×•-alias)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">df.select(F.col("id").cast("int").alias("user_id"), F.col("name"))</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">filter() / where()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×¡×™× ×•×Ÿ ×©×•×¨×•×ª ×œ×¤×™ ×ª× ××™</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">df.filter(col("age") > 25)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">groupBy()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×§×™×‘×•×¥ ×œ×¤×™ ×¢××•×“×•×ª</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">df.groupBy("dept").count()</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">agg()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">aggregation ××¨×•×‘×”</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">df.groupBy("dept").agg(avg("salary"), max("age"))</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">orderBy() / sort()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">××™×•×Ÿ ×©×•×¨×•×ª</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">df.orderBy(col("age").desc())</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">join()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×—×™×‘×•×¨ DataFrames</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">df1.join(df2, "id", "inner")</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">withColumn()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×”×•×¡×¤×ª/×¢×“×›×•×Ÿ ×¢××•×“×”</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">df.withColumn("new", col("age") + 1)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">withColumnRenamed()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×©×™× ×•×™ ×©× ×¢××•×“×”</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">df.withColumnRenamed("old", "new")</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">drop()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">××—×™×§×ª ×¢××•×“×•×ª</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">df.drop("column_name")</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">distinct()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×©×•×¨×•×ª ×™×™×—×•×“×™×•×ª</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">df.distinct()</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">dropDuplicates()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×”×¡×¨×ª ×›×¤×™×œ×•×™×•×ª ×œ×¤×™ ×¢××•×“×•×ª</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">df.dropDuplicates(["id"])</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">union()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">××™×—×•×“ DataFrames (×œ×¤×™ ××™×§×•× ×¢××•×“×•×ª)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">df1.union(df2)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">show()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×”×¦×’×ª ×©×•×¨×•×ª</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">df.show(10, truncate=False)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">printSchema()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×”×¦×’×ª Schema</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">df.printSchema()</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">describe()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×¡×˜×˜×™×¡×˜×™×§×•×ª</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">df.describe().show()</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">count()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×¡×¤×™×¨×ª ×©×•×¨×•×ª</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">df.count()</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h3>â“ Missing Values (NULL handling)</h3>
                    <div class="code-block"># ××—×™×§×ª ×©×•×¨×•×ª ×¢× NULL
df.na.drop()
df.na.drop(subset=["age"])  # ×¨×§ ×× age ×”×•× NULL

# ××™×œ×•×™ NULL ×‘×¢×¨×š
df.na.fill(0)
df.na.fill({"age": 0, "name": "Unknown"})

# ×”×—×œ×¤×ª ×¢×¨×›×™×
df.na.replace(10, 20)
df.na.replace([10, 20], [100, 200])</div>
                </div>
            </div>

            <!-- SQL Functions -->
            <div class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-blue)">â—</span> ğŸ” SQL Functions - ××œ××™×</h2>
                </div>
                <div class="card-body">
                    <h3>ğŸ“Š Aggregation Functions</h3>
                    <div style="overflow-x: auto; margin: 20px 0;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                            <thead style="background: linear-gradient(to left, #e3f2fd, #bbdefb); border-bottom: 2px solid var(--spark-blue);">
                                <tr>
                                    <th style="padding: 12px; text-align: left; border: 1px solid var(--border-color); font-weight: 700; direction: ltr;">×¤×•× ×§×¦×™×”</th>
                                    <th style="padding: 12px; text-align: right; border: 1px solid var(--border-color); font-weight: 700;">×ª×™××•×¨</th>
                                    <th style="padding: 12px; text-align: left; border: 1px solid var(--border-color); font-weight: 700; direction: ltr;">×“×•×’××”</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-blue); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">count()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×¡×¤×™×¨×ª ×©×•×¨×•×ª</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">count("*")</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-blue); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">sum() / avg()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×¡×›×•× / ×××•×¦×¢</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">sum("amount") / avg("salary")</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-blue); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">min() / max()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">××™× ×™××•× / ××§×¡×™××•×</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">min("age") / max("age")</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-blue); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">stddev() / variance()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×¡×˜×™×™×ª ×ª×§×Ÿ / ×©×•× ×•×ª</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">stddev("value")</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-blue); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">collect_list()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">××™×¡×•×£ ×œ×¨×©×™××” (×¢× ×›×¤×™×œ×•×™×•×ª)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">collect_list("item")</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-blue); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">collect_set()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">××™×¡×•×£ ×œ×¨×©×™××” ×™×™×—×•×“×™×ª</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">collect_set("category")</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-blue); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">countDistinct()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×¡×¤×™×¨×ª ×¢×¨×›×™× ×™×™×—×•×“×™×™×</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">countDistinct("user_id")</td>
                                </tr>
                            </tbody>
                        </table>
                        </div>

                    <h3>ğŸ“ String Functions</h3>
                    <div style="overflow-x: auto; margin: 20px 0;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                            <thead style="background: linear-gradient(to left, #e8f5e9, #c8e6c9); border-bottom: 2px solid var(--spark-green);">
                                <tr>
                                    <th style="padding: 12px; text-align: left; border: 1px solid var(--border-color); font-weight: 700; direction: ltr;">×¤×•× ×§×¦×™×”</th>
                                    <th style="padding: 12px; text-align: right; border: 1px solid var(--border-color); font-weight: 700;">×ª×™××•×¨</th>
                                    <th style="padding: 12px; text-align: left; border: 1px solid var(--border-color); font-weight: 700; direction: ltr;">×“×•×’××”</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-green); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">upper() / lower()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">××•×ª×™×•×ª ×’×“×•×œ×•×ª / ×§×˜× ×•×ª</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">upper(col("name"))</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-green); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">concat()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×—×™×‘×•×¨ strings</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">concat(col("first"), lit(" "), col("last"))</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-green); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">substring()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×—×œ×§ ×-string</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">substring(col("text"), 1, 5)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-green); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">length()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">××•×¨×š string</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">length(col("name"))</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-green); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">trim()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×”×¡×¨×ª ×¨×•×•×—×™×</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">trim(col("text"))</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-green); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">split()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×¤×™×¦×•×œ string ×œ××¢×¨×š</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">split(col("text"), ",")</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-green); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">regexp_replace()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×”×—×œ×¤×” ×¢× regex</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">regexp_replace(col("text"), "\\d", "X")</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-green); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">like() / rlike()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×”×ª×××ª ×ª×‘× ×™×ª</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">col("name").like("A%")</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <h3>ğŸ“… Date & Time Functions</h3>
                    <div style="overflow-x: auto; margin: 20px 0;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                            <thead style="background: linear-gradient(to left, #f3e5f5, #e1bee7); border-bottom: 2px solid var(--spark-purple);">
                                <tr>
                                    <th style="padding: 12px; text-align: left; border: 1px solid var(--border-color); font-weight: 700; direction: ltr;">×¤×•× ×§×¦×™×”</th>
                                    <th style="padding: 12px; text-align: right; border: 1px solid var(--border-color); font-weight: 700;">×ª×™××•×¨</th>
                                    <th style="padding: 12px; text-align: left; border: 1px solid var(--border-color); font-weight: 700; direction: ltr;">×“×•×’××”</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-purple); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">current_date()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×ª××¨×™×š × ×•×›×—×™</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">current_date()</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-purple); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">year() / month() / day()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×—×™×œ×•×¥ ×—×œ×§×™ ×ª××¨×™×š</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">year(col("date"))</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-purple); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">date_add() / date_sub()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×”×•×¡×¤×”/×”×¤×—×ª×” ×©×œ ×™××™×</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">date_add(col("date"), 7)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-purple); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">datediff()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×”×¤×¨×© ×™××™× ×‘×™×Ÿ ×ª××¨×™×›×™×</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">datediff(col("end"), col("start"))</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-purple); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">date_format()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×¤×•×¨××˜ ×ª××¨×™×š</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">date_format(col("date"), "yyyy-MM-dd")</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-purple); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">to_date() / to_timestamp()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×”××¨×” ×œ-date/timestamp</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">to_date(col("str"), "yyyy-MM-dd")</td>
                                </tr>
                            </tbody>
                        </table>
                </div>

                    <h3>ğŸ”€ Conditional & Other Functions</h3>
                    <div style="overflow-x: auto; margin: 20px 0;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                            <thead style="background: linear-gradient(to left, #fff3e0, #ffe0b2); border-bottom: 2px solid var(--spark-orange);">
                                <tr>
                                    <th style="padding: 12px; text-align: left; border: 1px solid var(--border-color); font-weight: 700; direction: ltr;">×¤×•× ×§×¦×™×”</th>
                                    <th style="padding: 12px; text-align: right; border: 1px solid var(--border-color); font-weight: 700;">×ª×™××•×¨</th>
                                    <th style="padding: 12px; text-align: left; border: 1px solid var(--border-color); font-weight: 700; direction: ltr;">×“×•×’××”</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">when() / otherwise()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×ª× ××™ if-then-else</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">when(col("age") > 18, "Adult").otherwise("Minor")</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">coalesce()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×¢×¨×š ×œ×-null ×¨××©×•×Ÿ</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">coalesce(col("value"), lit(0))</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">isNull() / isNotNull()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×‘×“×™×§×ª null</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">col("value").isNull()</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">lit()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×™×¦×™×¨×ª literal value</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">lit("constant")</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">col() / expr()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×”×ª×™×™×—×¡×•×ª ×œ×¢××•×“×” / ×‘×™×˜×•×™ SQL</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">col("name") / expr("age + 1")</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">cast()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×”××¨×ª ×˜×™×¤×•×¡</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">col("age").cast("string")</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">explode()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×”×¨×—×‘×ª ××¢×¨×š ×œ×©×•×¨×•×ª</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">explode(col("array_column"))</td>
                                </tr>
                            </tbody>
                        </table>
            </div>
        </div>
    </div>

            <!-- Window Functions -->
            <div class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-green)">â—</span> ğŸªŸ Window Functions</h2>
                </div>
                <div class="card-body">
                    <div class="info-box">
                        <h3>××”×Ÿ Window Functions?</h3>
                        <p>×××¤×©×¨×•×ª ×—×™×©×•×‘×™× ×¢×œ "×—×œ×•×Ÿ" ×©×œ ×©×•×¨×•×ª - ×“×™×¨×•×’, lag/lead, running totals ×•×¢×•×“.</p>
                    </div>

                    <div style="overflow-x: auto; margin: 20px 0;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                            <thead style="background: linear-gradient(to left, #e3f2fd, #bbdefb); border-bottom: 2px solid var(--spark-blue);">
                                <tr>
                                    <th style="padding: 12px; text-align: left; border: 1px solid var(--border-color); font-weight: 700; direction: ltr;">×¤×•× ×§×¦×™×”</th>
                                    <th style="padding: 12px; text-align: right; border: 1px solid var(--border-color); font-weight: 700;">×ª×™××•×¨</th>
                                    <th style="padding: 12px; text-align: left; border: 1px solid var(--border-color); font-weight: 700; direction: ltr;">×“×•×’××”</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-blue); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">row_number()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">××¡×¤×•×¨ ×©×•×¨×•×ª ×‘×—×œ×•×Ÿ (1, 2, 3, ...)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">row_number().over(window_spec)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-blue); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">rank()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×“×™×¨×•×’ ×¢× ×¤×¢×¨×™× (1, 2, 2, 4, ...)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">rank().over(window_spec)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-blue); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">dense_rank()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×“×™×¨×•×’ ×œ×œ× ×¤×¢×¨×™× (1, 2, 2, 3, ...)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">dense_rank().over(window_spec)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-blue); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">lag(col, n)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×¢×¨×š ××”×©×•×¨×” ×”-N ×”×§×•×“××ª</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">lag("salary", 1).over(window_spec)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-blue); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">lead(col, n)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×¢×¨×š ××”×©×•×¨×” ×”-N ×”×‘××”</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">lead("salary", 1).over(window_spec)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-blue); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">ntile(n)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×—×œ×•×§×” ×œ-N ×§×‘×•×¦×•×ª ×©×•×•×ª (quartiles, deciles)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">ntile(4).over(window_spec)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-blue); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">percent_rank()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">××—×•×–×•×Ÿ ×™×—×¡×™: (rank - 1) / (total - 1)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">percent_rank().over(window_spec)</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-blue); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">cume_dist()</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×”×ª×¤×œ×’×•×ª ××¦×˜×‘×¨×ª</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; background: #f8f9fa;">cume_dist().over(window_spec)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="code-block"># ×“×•×’××” ××œ××”:
from pyspark.sql.window import Window
from pyspark.sql.functions import *

# ×”×’×“×¨×ª Window
window_spec = Window.partitionBy("department").orderBy("salary")

# ×©×™××•×©
df.withColumn("row_num", row_number().over(window_spec)) \
  .withColumn("rank", rank().over(window_spec)) \
  .withColumn("prev_salary", lag("salary", 1).over(window_spec)) \
  .withColumn("quartile", ntile(4).over(window_spec))

# Running Total
window_running = Window.partitionBy("dept") \
                      .orderBy("date") \
                      .rowsBetween(Window.unboundedPreceding, Window.currentRow)

df.withColumn("running_total", sum("amount").over(window_running))</div>
                </div>
            </div>

            <!-- UDFs -->
            <div class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-purple)">â—</span> ğŸ”§ UDFs - User Defined Functions</h2>
                </div>
                <div class="card-body">
                    <div class="warning-box">
                        <h3>âš ï¸ ×—×©×•×‘!</h3>
                        <p>UDFs ×‘-Python ××™×˜×™×•×ª ×™×•×ª×¨ ××¤×•× ×§×¦×™×•×ª ××•×‘× ×•×ª - ×”×©×ª××© ×¨×§ ×›×©×—×™×™×‘×™×!</p>
                        <p><strong>Pandas UDF</strong> ××”×™×¨×” ×”×¨×‘×” ×™×•×ª×¨ ×-UDF ×¨×’×™×œ×”!</p>
                    </div>

                    <div class="code-block"># Python UDF - ×¨×’×™×œ×”
from pyspark.sql.functions import udf
from pyspark.sql.types import StringType

@udf(returnType=StringType())
def categorize_age(age):
    if age < 18:
        return "Minor"
    elif age < 65:
        return "Adult"
    else:
        return "Senior"

# ×©×™××•×©
df.withColumn("category", categorize_age(col("age")))

# ×¨×™×©×•× ×œ-SQL
spark.udf.register("categorize_age", categorize_age, StringType())
spark.sql("SELECT categorize_age(age) FROM users")</div>

                    <div class="code-block"># Pandas UDF - ××”×™×¨×” ×™×•×ª×¨! (××•××œ×¥!)
from pyspark.sql.functions import pandas_udf
import pandas as pd

@pandas_udf("double")
def multiply_by_two(s: pd.Series) -> pd.Series:
    return s * 2

df.withColumn("doubled", multiply_by_two(col("value")))</div>
                </div>
            </div>

            <!-- SQL Queries -->
            <div class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-orange)">â—</span> ğŸ’¬ SQL Queries</h2>
                </div>
                <div class="card-body">
                    <div class="code-block"># ×¨×™×©×•× DataFrame ×›×˜×‘×œ×”
df.createOrReplaceTempView("users")
df.createGlobalTempView("global_users")

# ×”×¨×¦×ª SQL
result = spark.sql("""
    SELECT
        department,
        AVG(salary) as avg_salary,
        COUNT(*) as count
    FROM users
    WHERE age > 25
    GROUP BY department
    ORDER BY avg_salary DESC
""")

# ×’×™×©×” ×œ-Global Temp View
spark.sql("SELECT * FROM global_temp.global_users")</div>
                </div>
            </div>

            <!-- File Formats Comparison -->
            <div class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-orange)">â—</span> ğŸ“¦ ×”×©×•×•××ª ×¤×•×¨××˜×™ ×§×‘×¦×™×</h2>
                </div>
                <div class="card-body">
                    <div style="overflow-x: auto; margin: 20px 0;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                            <thead style="background: linear-gradient(to left, #fff3e0, #ffe0b2); border-bottom: 2px solid var(--spark-orange);">
                                <tr>
                                    <th style="padding: 12px; text-align: right; border: 1px solid var(--border-color); font-weight: 700;">×¤×•×¨××˜</th>
                                    <th style="padding: 12px; text-align: right; border: 1px solid var(--border-color); font-weight: 700;">×™×ª×¨×•× ×•×ª</th>
                                    <th style="padding: 12px; text-align: right; border: 1px solid var(--border-color); font-weight: 700;">×—×¡×¨×•× ×•×ª</th>
                                    <th style="padding: 12px; text-align: right; border: 1px solid var(--border-color); font-weight: 700;">××ª×™ ×œ×”×©×ª××©</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-orange);">Parquet</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: #e8f5e9;">âœ… ××”×™×¨ ×××•×“<br>âœ… Columnar<br>âœ… ×“×—×™×¡×” ××¢×•×œ×”<br>âœ… Schema ××•×‘× ×”</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">âŒ ×œ× ×§×¨×™× ×œ×‘× ×™ ××“×</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: #fff3e0;"><strong>â­ ×‘×¨×™×¨×ª ××—×“×œ!</strong><br>Analytics, Data Lake</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-blue);">ORC</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: #e8f5e9;">âœ… ×“×—×™×¡×” ××¢×•×œ×”<br>âœ… Columnar<br>âœ… ××”×™×¨</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">âŒ ×œ× ×§×¨×™× ×œ×‘× ×™ ××“×</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">Hive tables</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-green);">Avro</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: #e8f5e9;">âœ… Schema evolution<br>âœ… Row-based</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">âŒ ××™×˜×™ ×™×•×ª×¨ ×Parquet</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">Kafka Streaming<br>Schema ××©×ª× ×”</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-red);">CSV</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">âœ… ×§×¨×™× ×œ×‘× ×™ ××“×<br>âœ… Universal</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: #ffebee;">âŒ ××™×˜×™ ×××•×“<br>âŒ ×’×“×•×œ<br>âŒ ×‘×¢×™×•×ª encoding</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);"><strong>âš ï¸ ×¨×§ ×œ×¤×™×ª×•×—!</strong><br>×œ× ×œ×¤×¨×•×“×§×©×Ÿ!</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600;">JSON</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">âœ… ×§×¨×™×<br>âœ… Nested data</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: #ffebee;">âŒ ××™×˜×™<br>âŒ ×’×“×•×œ<br>âŒ ×œ× ×“×—×•×¡</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">Bronze layer<br>API responses</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- I/O Operations -->
            <div class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-red)">â—</span> ğŸ’¾ ×§×¨×™××” ×•×›×ª×™×‘×” - ×§×•×“</h2>
                </div>
                <div class="card-body">
                    <h3>ğŸ“– ×§×¨×™××” (Read)</h3>
                    <div class="code-block"># CSV
df = spark.read.csv(path, header=True, inferSchema=True)

# JSON
df = spark.read.json(path)

# Parquet (××•××œ×¥!)
df = spark.read.parquet(path)

# ORC
df = spark.read.orc(path)

# Text
df = spark.read.text(path)

# JDBC (Database)
df = spark.read \
    .format("jdbc") \
    .option("url", "jdbc:mysql://localhost:3306/db") \
    .option("dbtable", "table") \
    .option("user", "user") \
    .option("password", "pass") \
    .load()</div>

                    <h3>ğŸ’¾ ×›×ª×™×‘×” (Write)</h3>
                    <div class="code-block"># Parquet (××•××œ×¥!)
df.write.parquet("/output/path")

# ×¢× mode
df.write.mode("overwrite").parquet("/output/path")
# modes: append, overwrite, ignore, error (default)

# ×¢× Partitioning (×—×©×•×‘!)
df.write.partitionBy("year", "month").parquet("/output/path")

# Repartition ×œ×¤× ×™ ×›×ª×™×‘×” (××¡×¤×¨ ×§×‘×¦×™×)
df.coalesce(1).write.parquet("/output/single_file")
df.repartition(10).write.parquet("/output/10_files")</div>

                    <h3>ğŸ”„ ×”××¨×•×ª (Conversions)</h3>
                    <div class="code-block"># DataFrame â†’ RDD
rdd = df.rdd

# DataFrame â†’ Pandas (×–×”×™×¨×•×ª! ×¨×§ ×œ× ×ª×•× ×™× ×§×˜× ×™×)
pandas_df = df.toPandas()

# DataFrame â†’ JSON String
json_str = df.toJSON().first()

# RDD â†’ DataFrame
df = spark.createDataFrame(rdd, schema)</div>
                </div>
            </div>

            <!-- Storage Levels -->
            <div class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-purple)">â—</span> ğŸ’¾ Storage Levels</h2>
                </div>
                <div class="card-body">
                    <div style="overflow-x: auto; margin: 20px 0;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                            <thead style="background: linear-gradient(to left, #f3e5f5, #e1bee7); border-bottom: 2px solid var(--spark-purple);">
                                <tr>
                                    <th style="padding: 12px; text-align: left; border: 1px solid var(--border-color); font-weight: 700; direction: ltr;">Storage Level</th>
                                    <th style="padding: 12px; text-align: right; border: 1px solid var(--border-color); font-weight: 700;">×ª×™××•×¨</th>
                                    <th style="padding: 12px; text-align: right; border: 1px solid var(--border-color); font-weight: 700;">××ª×™ ×œ×”×©×ª××©</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-purple); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">MEMORY_ONLY</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×¨×§ ×‘×–×™×›×¨×•×Ÿ (default ×‘-cache())</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: #e8f5e9;">××”×™×¨! ×× ×™×© ××¡×¤×™×§ ×–×™×›×¨×•×Ÿ</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-purple); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">MEMORY_AND_DISK</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×–×™×›×¨×•×Ÿ + overflow ×œ×“×™×¡×§</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: #e8f5e9;">××•××œ×¥! ×× ×œ× ×‘×˜×•×— ×‘×–×™×›×¨×•×Ÿ</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-purple); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">MEMORY_ONLY_SER</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×–×™×›×¨×•×Ÿ ××¡×™×¨×™××œ×™×–×“ (×“×—×•×¡)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×—×•×¡×š ×–×™×›×¨×•×Ÿ, ××‘×œ ××™×˜×™ ×™×•×ª×¨</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600; color: var(--spark-purple); direction: ltr; text-align: left; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">DISK_ONLY</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">×¨×§ ×“×™×¡×§</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">× ×“×™×¨ - ×›×©×–×™×›×¨×•×Ÿ ××•×’×‘×œ ×××•×“</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="code-block"># ×©×™××•×©
from pyspark import StorageLevel

rdd.persist(StorageLevel.MEMORY_AND_DISK)
df.persist(StorageLevel.MEMORY_AND_DISK)</div>
                </div>
            </div>

            <!-- Spark Submit -->
            <div class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-orange)">â—</span> ğŸš€ Spark Submit - ×”×¨×¦×” ×¢×œ Cluster</h2>
                </div>
                <div class="card-body">
                    <div class="code-block">spark-submit \
    --master yarn \
    --deploy-mode cluster \
    \
    # Resources
    --executor-memory 8g \
    --driver-memory 4g \
    --executor-cores 4 \
    --num-executors 10 \
    \
    # Dynamic Allocation (××•××œ×¥!)
    --conf spark.dynamicAllocation.enabled=true \
    --conf spark.shuffle.service.enabled=true \
    --conf spark.dynamicAllocation.minExecutors=2 \
    --conf spark.dynamicAllocation.maxExecutors=50 \
    \
    # Performance
    --conf spark.sql.shuffle.partitions=200 \
    --conf spark.sql.adaptive.enabled=true \
    --conf spark.executor.memoryOverhead=2g \
    \
    # Dependencies
    --packages org.apache.spark:spark-sql-kafka-0-10_2.12:3.2.0 \
    --py-files utils.zip,helpers.py \
    \
    # Application
    --name "MyApp" \
    my_app.py arg1 arg2</div>

                    <div class="info-box" style="margin-top: 20px;">
                        <h3>ğŸ¯ Master Options</h3>
                        <ul>
                            <li><code>local[*]</code> - ××§×•××™, ×›×œ ×”-cores</li>
                            <li><code>yarn</code> - YARN cluster</li>
                            <li><code>spark://HOST:PORT</code> - Standalone cluster</li>
                            <li><code>k8s://...</code> - Kubernetes</li>
                        </ul>
                    </div>

                    <div class="info-box" style="margin-top: 20px;">
                        <h3>âš–ï¸ ×”×’×“×¨×•×ª ××•××œ×¦×•×ª</h3>
                        <ul>
                            <li><strong>Executor Memory:</strong> 4-8GB (×œ× ×™×•×ª×¨ ×-16GB)</li>
                            <li><strong>Executor Cores:</strong> 4-5 cores (×œ× ×™×•×ª×¨!)</li>
                            <li><strong>Num Executors:</strong> ×ª×œ×•×™ ×‘×’×•×“×œ Cluster</li>
                            <li><strong>Partitions:</strong> 2-4 partitions ×œ×›×œ CPU core</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Important Configurations -->
            <div class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-blue)">â—</span> âš™ï¸ Configurations ×—×©×•×‘×•×ª</h2>
                </div>
                <div class="card-body">
                    <div class="code-block"># ×”×’×“×¨×•×ª Performance ×—×©×•×‘×•×ª
spark.conf.set("spark.sql.shuffle.partitions", "200")  # default: 200
spark.conf.set("spark.sql.adaptive.enabled", "true")   # AQE (Spark 3.0+)
spark.conf.set("spark.sql.adaptive.coalescePartitions.enabled", "true")
spark.conf.set("spark.sql.adaptive.skewJoin.enabled", "true")

# Memory
spark.conf.set("spark.executor.memory", "8g")
spark.conf.set("spark.driver.memory", "4g")
spark.conf.set("spark.executor.memoryOverhead", "2g")

# Parallelism
spark.conf.set("spark.default.parallelism", "100")

# Broadcast
spark.conf.set("spark.sql.autoBroadcastJoinThreshold", "10485760")  # 10MB

# Timeouts
spark.conf.set("spark.network.timeout", "600s")
spark.conf.set("spark.sql.broadcastTimeout", "600")

# Logging
spark.sparkContext.setLogLevel("WARN")  # INFO, WARN, ERROR</div>
                </div>
            </div>

            <!-- Streaming -->
            <div class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-blue)">â—</span> ğŸŒŠ Structured Streaming</h2>
                </div>
                <div class="card-body">
                    <div class="code-block"># ×§×¨×™××” ×-Kafka
df = spark.readStream \
    .format("kafka") \
    .option("kafka.bootstrap.servers", "localhost:9092") \
    .option("subscribe", "my-topic") \
    .load()

# ×”××¨×” ×œ-string
from pyspark.sql.functions import col
lines = df.select(col("value").cast("string"))

# ×¢×™×‘×•×“
words = lines.selectExpr("explode(split(value, ' ')) as word")
word_counts = words.groupBy("word").count()

# ×›×ª×™×‘×”
query = word_counts.writeStream \
    .outputMode("update") \
    .format("console") \
    .option("checkpointLocation", "/checkpoint/path") \
    .start()

query.awaitTermination()

# Output Modes: append, complete, update
# Triggers: processingTime, once, continuous</div>
                </div>
            </div>

            <!-- Performance Tips -->
            <div class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-green)">â—</span> âš¡ Performance Tips</h2>
                </div>
                <div class="card-body">
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4>âœ… DO</h4>
                            <ul style="text-align: right; list-style-position: inside;">
                                <li>×”×©×ª××© ×‘-Parquet</li>
                                <li>Filter ××•×§×“×</li>
                                <li>Select ×¨×§ ×¢××•×“×•×ª × ×“×¨×©×•×ª</li>
                                <li>reduceByKey ×‘××§×•× groupByKey</li>
                                <li>Broadcast ×œ×˜×‘×œ××•×ª ×§×˜× ×•×ª</li>
                                <li>Cache × ×ª×•× ×™× ×©× ××©×›×™×</li>
                                <li>Partition ×œ×¤×™ ×©×™××•×©</li>
                            </ul>
                        </div>
                        <div class="feature-card">
                            <h4>âŒ DON'T</h4>
                            <ul style="text-align: right; list-style-position: inside;">
                                <li>collect() ×¢×œ × ×ª×•× ×™× ×’×“×•×œ×™×</li>
                                <li>CSV ×‘×¤×¨×•×“×§×©×Ÿ</li>
                                <li>groupByKey ×œ×œ× ×¦×•×¨×š</li>
                                <li>UDFs ×œ×œ× ×¦×•×¨×š</li>
                                <li>Partitions ×§×˜× ×™× ××“×™/×’×“×•×œ×™× ××“×™</li>
                                <li>Select * ×œ×œ× ×¦×•×¨×š</li>
                            </ul>
                        </div>
                    </div>

                    <h3 style="margin-top: 30px;">ğŸ¯ Quick Performance Checklist</h3>
                    <div class="code-block"># âœ… Broadcast Join ×œ×˜×‘×œ××•×ª ×§×˜× ×•×ª
from pyspark.sql.functions import broadcast
large_df.join(broadcast(small_df), "id")

# âœ… Filter â†’ Select â†’ Join (×‘×¡×“×¨ ×”×–×”!)
df.filter(col("date") > "2023-01-01") \
  .select("id", "name", "amount") \
  .join(df2, "id")

# âœ… Cache ×× × ××©×š 2+ ×¤×¢××™×
df_cached = df.filter(...).cache()
df_cached.count()  # materialize
df_cached.show()   # fast!

# âœ… Partitioning ×—×›×
df.write.partitionBy("year", "month").parquet("/data")

# âœ… Coalesce ×œ×¤× ×™ ×›×ª×™×‘×”
df.coalesce(10).write.parquet("/output")

# âœ… AQE - Adaptive Query Execution (Spark 3.0+)
spark.conf.set("spark.sql.adaptive.enabled", "true")</div>
                </div>
            </div>

            <!-- DataFrame vs RDD -->
            <div class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-blue)">â—</span> âš–ï¸ DataFrame vs RDD - ××ª×™ ×œ×”×©×ª××© ×‘××”?</h2>
                </div>
                <div class="card-body">
                    <div style="overflow-x: auto; margin: 20px 0;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                            <thead style="background: linear-gradient(to left, #fff3e0, #ffe0b2); border-bottom: 2px solid var(--spark-orange);">
                                <tr>
                                    <th style="padding: 12px; text-align: right; border: 1px solid var(--border-color); font-weight: 700;">×ª×›×•× ×”</th>
                                    <th style="padding: 12px; text-align: right; border: 1px solid var(--border-color); font-weight: 700;">DataFrame (××•××œ×¥!)</th>
                                    <th style="padding: 12px; text-align: right; border: 1px solid var(--border-color); font-weight: 700;">RDD</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600;">Schema</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: #e8f5e9;">âœ… ×™×© - ×˜×‘×œ×” ×¢× ×¢××•×“×•×ª ×•×˜×™×¤×•×¡×™×</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">âŒ ××™×Ÿ - ×¨×§ ××•×¡×£ × ×ª×•× ×™×</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600;">××•×¤×˜×™××™×–×¦×™×”</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: #e8f5e9;">âœ… Catalyst Optimizer - ××•×˜×•××˜×™!</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">âŒ ××™×Ÿ - ××•×¤×˜×™××™×–×¦×™×” ×™×“× ×™×ª</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600;">×ª××™×›×” ×‘-SQL</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: #e8f5e9;">âœ… ×›×Ÿ - ×©××™×œ×ª×•×ª SQL</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">âŒ ×œ×</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600;">×‘×™×¦×•×¢×™×</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: #e8f5e9;">âœ… ××”×™×¨ - Tungsten, Code Generation</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">âš ï¸ ××™×˜×™ ×™×•×ª×¨</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600;">×§×œ×•×ª ×©×™××•×©</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: #e8f5e9;">âœ… ×§×œ - API ×“×•××” ×œ-SQL/Pandas</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">âš ï¸ ×“×•×¨×© ×™×•×ª×¨ ×§×•×“</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); font-weight: 600;">××ª×™ ×œ×”×©×ª××©?</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color); background: #e8f5e9;">âœ… × ×ª×•× ×™× ××•×‘× ×™× (CSV, JSON, DB)</td>
                                    <td style="padding: 10px; border: 1px solid var(--border-color);">âš ï¸ × ×ª×•× ×™× ×œ× ××•×‘× ×™×, ×œ×•×’×™×§×” ××•×¨×›×‘×ª</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="success-box">
                        <h3>ğŸ’¡ ×”××œ×¦×”</h3>
                        <p><strong>×ª××™×“ ×”×ª×—×œ ×¢× DataFrame API!</strong></p>
                        <p>×¨×§ ×× ××ª×” ×¦×¨×™×š ×œ×•×’×™×§×” ×××•×“ ××•×¨×›×‘×ª ××• ×¢×‘×•×“×” ×¢× × ×ª×•× ×™× ×œ× ××•×‘× ×™× - ×”×©×ª××© ×‘-RDD.</p>
                    </div>
                </div>
            </div>

            <!-- Common Patterns -->
            <div class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-purple)">â—</span> ğŸ’¼ ×“×•×’×××•×ª ×©×™××•×©×™×•×ª (Common Patterns)</h2>
                </div>
                <div class="card-body">
                    <h3>ğŸ”§ Select ××ª×§×“× - Cast & Alias (××•××œ×¥!)</h3>
                    <div class="code-block"># âœ… ×“×•×’××” ××¢×©×™×ª - ×§×¨×™××” ×•× ×™×§×•×™ × ×ª×•× ×™×
from pyspark.sql.functions import col, trim, upper, when
from pyspark.sql.types import IntegerType, DoubleType, DateType

# ×§×¨×™××ª × ×ª×•× ×™× ×’×•×œ××™×™×
raw_df = spark.read.csv("/data/airports.csv", header=True)

# âœ… select ×¢× cast, alias, ×•-transformations
clean_df = raw_df.select(
    # ×”××¨×ª ×˜×™×¤×•×¡×™× + ×©×™× ×•×™ ×©××•×ª
    col('airport_id').cast(IntegerType()).alias('id'),
    trim(upper(col('airport_name'))).alias('name'),
    col('city'),
    col('country'),

    # ×”××¨×” ×œ××¡×¤×¨×™×
    col('latitude').cast(DoubleType()).alias('lat'),
    col('longitude').cast(DoubleType()).alias('lon'),

    # ×”××¨×” ×œ×ª××¨×™×š
    col('last_updated').cast(DateType()).alias('updated_date'),

    # ×—×™×©×•×‘×™×
    (col('latitude') + col('longitude')).alias('geo_sum'),

    # ×ª× ××™×
    when(col('active') == 'Y', True).otherwise(False).alias('is_active')
)

clean_df.show(5)</div>

                    <h3>ğŸ” Word Count (×“×•×’××” ×§×œ××¡×™×ª)</h3>
                    <div class="code-block"># RDD
lines = sc.textFile("/path/to/file.txt")
words = lines.flatMap(lambda line: line.split())
pairs = words.map(lambda word: (word.lower(), 1))
word_counts = pairs.reduceByKey(lambda a, b: a + b)
top_10 = word_counts.sortBy(lambda x: x[1], ascending=False).take(10)

# DataFrame (×¢×“×™×£!)
from pyspark.sql.functions import explode, split, lower
df = spark.read.text("/path/to/file.txt")
words = df.select(explode(split(col("value"), " ")).alias("word"))
word_counts = words.groupBy(lower(col("word"))).count()
word_counts.orderBy(col("count").desc()).show(10)</div>

                    <h3>ğŸ“Š ETL Pipeline - Bronze â†’ Silver â†’ Gold</h3>
                    <div class="code-block"># Bronze â†’ Silver (× ×™×§×•×™)
bronze_df = spark.read.json("/bronze/events/")
silver_df = bronze_df \
    .filter(col("timestamp").isNotNull()) \
    .filter(col("user_id").isNotNull()) \
    .dropDuplicates(["event_id"]) \
    .withColumn("date", to_date(col("timestamp")))

silver_df.write.mode("overwrite").parquet("/silver/events/")

# Silver â†’ Gold (aggregation)
silver_df = spark.read.parquet("/silver/events/")
gold_df = silver_df \
    .groupBy("date", "event_type") \
    .agg(
        count("*").alias("event_count"),
        countDistinct("user_id").alias("unique_users")
    )

gold_df.write.partitionBy("date").parquet("/gold/events_summary/")</div>

                    <h3>ğŸ”— Join ×¢× Lookup Table</h3>
                    <div class="code-block"># ×˜×‘×œ×” ×’×“×•×œ×” + ×˜×‘×œ×” ×§×˜× ×” = Broadcast Join
from pyspark.sql.functions import broadcast

transactions = spark.read.parquet("/data/transactions")
products = spark.read.parquet("/data/products")  # ×§×˜×Ÿ

# Broadcast Join (×™×¢×™×œ!)
result = transactions.join(broadcast(products), "product_id") \
    .select("transaction_id", "product_name", "amount")</div>

                    <h3>ğŸ“ˆ Top N per Group (Window Function)</h3>
                    <div class="code-block">from pyspark.sql.window import Window
from pyspark.sql.functions import row_number

# Top 3 ××•×¦×¨×™× ×‘×›×œ ×§×˜×’×•×¨×™×”
window = Window.partitionBy("category").orderBy(col("sales").desc())

top_products = df.withColumn("rank", row_number().over(window)) \
                 .filter(col("rank") <= 3)</div>

                    <h3>ğŸŒŠ Streaming - Real-time Analytics</h3>
                    <div class="code-block"># ×§×¨×™××” ×-Kafka, ×¢×™×‘×•×“, ×›×ª×™×‘×” ×œ-Parquet
df = spark.readStream \
    .format("kafka") \
    .option("kafka.bootstrap.servers", "localhost:9092") \
    .option("subscribe", "events") \
    .load()

# ×¢×™×‘×•×“
events = df.selectExpr("CAST(value AS STRING) as json") \
    .select(from_json(col("json"), schema).alias("data")) \
    .select("data.*")

# ×›×ª×™×‘×”
query = events.writeStream \
    .outputMode("append") \
    .format("parquet") \
    .option("path", "/output/streaming") \
    .option("checkpointLocation", "/checkpoint") \
    .start()

query.awaitTermination()</div>
                </div>
            </div>

            <!-- Common Errors -->
            <div class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-red)">â—</span> ğŸ”§ ×‘×¢×™×•×ª × ×¤×•×¦×•×ª ×•×¤×ª×¨×•× ×•×ª</h2>
                </div>
                <div class="card-body">
                    <div class="warning-box">
                        <h3>âš ï¸ Out of Memory</h3>
                        <div class="code-block"># ×¤×ª×¨×•× ×•×ª:
--executor-memory 8g
--driver-memory 4g
--executor-cores 2  # ×¤×—×•×ª tasks ×‘××§×‘×™×œ
--conf spark.sql.shuffle.partitions=400
--conf spark.executor.memoryOverhead=2g</div>
                    </div>

                    <div class="warning-box" style="margin-top: 20px;">
                        <h3>âš ï¸ Data Skew (×—×œ×•×§×” ×œ× ××—×™×“×”)</h3>
                        <div class="code-block"># ×‘×“×™×§×”:
df.groupBy("key").count().orderBy(col("count").desc()).show()

# ×¤×ª×¨×•×Ÿ - Salting:
from pyspark.sql.functions import rand, concat
df.withColumn("salted_key",
    concat(col("key"), lit("_"), (rand()*10).cast("int")))</div>
                    </div>

                    <div class="warning-box" style="margin-top: 20px;">
                        <h3>âš ï¸ Slow Performance (×‘×™×¦×•×¢×™× ××™×˜×™×™×)</h3>
                        <div class="code-block"># Debug ×¢× explain():
df.explain(True)

# ×‘×“×™×§×ª Spark UI:
# http://localhost:4040
# â†’ Jobs â†’ Stages â†’ Tasks

# ×”×’×“×¨×•×ª Performance:
spark.conf.set("spark.sql.adaptive.enabled", "true")
spark.conf.set("spark.sql.adaptive.coalescePartitions.enabled", "true")
spark.conf.set("spark.sql.adaptive.skewJoin.enabled", "true")</div>
                    </div>

                    <div class="warning-box" style="margin-top: 20px;">
                        <h3>âš ï¸ Connection Timeout</h3>
                        <div class="code-block"># ×”×’×“×œ×ª Timeouts:
spark.conf.set("spark.network.timeout", "600s")
spark.conf.set("spark.executor.heartbeatInterval", "60s")</div>
                    </div>
                </div>
            </div>

            <!-- Golden Rules -->
            <div class="content-card" style="background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); border: 2px solid var(--spark-orange);">
                <div class="card-header" style="background: linear-gradient(135deg, var(--spark-orange), #FFB74D);">
                    <h2 style="color: white; margin: 0;">â­ Golden Rules - ×—×•×§×™ ×”×–×”×‘</h2>
                </div>
                <div class="card-body">
                    <div class="feature-grid">
                        <div class="feature-card" style="border-color: var(--spark-orange);">
                            <h4>1ï¸âƒ£ DataFrame > RDD</h4>
                            <p><strong>×ª××™×“</strong> ×”×ª×—×œ ×¢× DataFrame API</p>
                            <p>Catalyst Optimizer + ××”×™×¨ ×™×•×ª×¨</p>
                        </div>
                        <div class="feature-card" style="border-color: var(--spark-orange);">
                            <h4>2ï¸âƒ£ Parquet > CSV</h4>
                            <p><strong>×ª××™×“</strong> ×”×©×ª××© ×‘-Parquet</p>
                            <p>××”×™×¨ ×¤×™ 10-100 ×-CSV!</p>
                        </div>
                        <div class="feature-card" style="border-color: var(--spark-orange);">
                            <h4>3ï¸âƒ£ Filter ××•×§×“×</h4>
                            <p>×¡× ×Ÿ × ×ª×•× ×™× <strong>××™×“</strong> ××—×¨×™ ×§×¨×™××”</p>
                            <p>×¤×—×•×ª × ×ª×•× ×™× = ××”×™×¨ ×™×•×ª×¨</p>
                        </div>
                        <div class="feature-card" style="border-color: var(--spark-orange);">
                            <h4>4ï¸âƒ£ Broadcast Joins</h4>
                            <p>×˜×‘×œ××•×ª ×§×˜× ×•×ª? <strong>Broadcast!</strong></p>
                            <p>××•× ×¢ Shuffle ×™×§×¨</p>
                        </div>
                        <div class="feature-card" style="border-color: var(--spark-orange);">
                            <h4>5ï¸âƒ£ Cache ×‘×—×›××”</h4>
                            <p>×¨×§ × ×ª×•× ×™× ×©× ××©×›×™× <strong>2+ ×¤×¢××™×</strong></p>
                            <p>××—×¨×ª - ×‘×–×‘×•×– ×–×™×›×¨×•×Ÿ</p>
                        </div>
                        <div class="feature-card" style="border-color: var(--spark-orange);">
                            <h4>6ï¸âƒ£ ××œ ×ª×¢×©×” collect()</h4>
                            <p><strong>×œ×¢×•×œ× ×œ×</strong> ×¢×œ × ×ª×•× ×™× ×’×“×•×œ×™×</p>
                            <p>Driver OOM guaranteed!</p>
                        </div>
                        <div class="feature-card" style="border-color: var(--spark-orange);">
                            <h4>7ï¸âƒ£ reduceByKey > groupByKey</h4>
                            <p><strong>×ª××™×“</strong> reduceByKey</p>
                            <p>Local reduce = ×¤×—×•×ª Shuffle</p>
                        </div>
                        <div class="feature-card" style="border-color: var(--spark-orange);">
                            <h4>8ï¸âƒ£ Partitioning ×—×›×</h4>
                            <p>Partition ×œ×¤×™ <strong>×©×™××•×©</strong></p>
                            <p>2-4 partitions ×œ×›×œ core</p>
                        </div>
                        <div class="feature-card" style="border-color: var(--spark-orange);">
                            <h4>9ï¸âƒ£ UDFs ×‘××©×•×¨×”</h4>
                            <p>×¤×•× ×§×¦×™×•×ª ××•×‘× ×•×ª <strong>×ª××™×“</strong> ××”×™×¨×•×ª ×™×•×ª×¨</p>
                            <p>Pandas UDF > Python UDF</p>
                        </div>
                        <div class="feature-card" style="border-color: var(--spark-orange);">
                            <h4>ğŸ”Ÿ explain() ×ª××™×“</h4>
                            <p>×‘×“×•×§ ××ª ×”-<strong>Execution Plan</strong></p>
                            <p>df.explain(True)</p>
                        </div>
                    </div>

                    <div class="success-box" style="margin-top: 30px;">
                        <h3>ğŸ¯ ×ª×–×›×•×¨×ª ××—×¨×•× ×”</h3>
                        <p style="font-size: 1.1rem; font-weight: 600; margin-bottom: 15px;">×”×¡×“×¨ ×”× ×›×•×Ÿ:</p>
                        <div class="code-block"># 1. ×§×¨×
df = spark.read.parquet("/data")

# 2. ×¡× ×Ÿ ××™×“!
df = df.filter(col("date") >= "2023-01-01")

# 3. ×‘×—×¨ ×¨×§ ××” ×©×¦×¨×™×š
df = df.select("id", "name", "amount")

# 4. Join (×¢× broadcast ×× ××¤×©×¨)
df = df.join(broadcast(small_df), "id")

# 5. ×˜×¨× ×¡×¤×•×¨××¦×™×•×ª
df = df.withColumn("total", col("amount") * col("quantity"))

# 6. Aggregations
result = df.groupBy("category").agg(sum("total"))

# 7. Cache ×× × ××©×š
result = result.cache()
result.count()  # materialize

# 8. ×©××•×¨
result.write.partitionBy("date").parquet("/output")</div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- === BEST PRACTICES VIEW === -->
    <div id="view-bestpractices" class="view-section">
        <div style="max-width: 1200px; margin: 0 auto;">
            <div style="text-align: center; margin-bottom: 50px;">
                <h1 style="font-size: 2.2rem; margin-bottom: 12px; font-weight: 800; color: var(--text-primary);">â­ Best Practices</h1>
                <p style="color: var(--text-secondary); font-size: 1.05rem;">×¢×§×¨×•× ×•×ª ×•×©×™×˜×•×ª ×¢×‘×•×“×” ××•××œ×¦×•×ª</p>
            </div>

            <!-- Data Formats -->
            <div class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-orange)">ğŸ’¾</span> ×¤×•×¨××˜×™× ×•×§×‘×¦×™×</h2>
                </div>
                <div class="card-body">
                    <div class="success-box">
                        <h3>âœ… DO - ×”×©×ª××© ×‘-Parquet</h3>
                        <ul>
                            <li><strong>Parquet = ×‘×¨×™×¨×ª ××—×“×œ!</strong> - ××”×™×¨ ×¤×™ 10-100 ×-CSV</li>
                            <li>Columnar format - ×§×¨×™××” ×¨×§ ×©×œ ×¢××•×“×•×ª × ×“×¨×©×•×ª</li>
                            <li>×“×—×™×¡×” ××¢×•×œ×” - ×—×•×¡×š ××§×•× ×•×¨×•×—×‘ ×¤×¡</li>
                            <li>Schema ××•×‘× ×” - ×œ× ×¦×¨×™×š inferSchema</li>
                        </ul>
                        <div class="code-block"># âœ… Write Parquet with Partitioning
df.write \
    .partitionBy("year", "month", "day") \
    .mode("overwrite") \
    .parquet("/data/output")

# âœ… Read Parquet - ×¨×§ × ×ª×•× ×™× ×¨×œ×•×•× ×˜×™×™×!
df = spark.read.parquet("/data/output") \
          .filter("year=2023 AND month=12")</div>
                    </div>

                    <div class="warning-box">
                        <h3>âŒ DON'T - ××œ ×ª×©×ª××© ×‘-CSV ×‘×¤×¨×•×“×§×©×Ÿ</h3>
                        <ul>
                            <li>××™×˜×™ ×××•×“</li>
                            <li>×’×“×•×œ (×œ× ×“×—×•×¡)</li>
                            <li>×¦×¨×™×š inferSchema ××• schema ×™×“× ×™</li>
                            <li>×‘×¢×™×•×ª ×¢× encoding, delimiters, quotes</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Performance -->
            <div class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-blue)">âš¡</span> ×‘×™×¦×•×¢×™×</h2>
                </div>
                <div class="card-body">
                    <div class="feature-grid">
                        <div class="feature-card">
                            <h4>âœ… Filter ××•×§×“×</h4>
                            <p>×¡× ×Ÿ × ×ª×•× ×™× ××™×“ ××—×¨×™ ×§×¨×™××”</p>
                            <div class="code-block" style="font-size: 0.75rem; margin-top: 10px;"># âœ… ×˜×•×‘
df.filter("date > '2023-01-01'") \
  .join(df2, "id")</div>
                        </div>

                        <div class="feature-card">
                            <h4>âœ… Select ×¨×§ ×¢××•×“×•×ª × ×“×¨×©×•×ª</h4>
                            <p>Column Pruning</p>
                            <div class="code-block" style="font-size: 0.75rem; margin-top: 10px;"># âœ… ×˜×•×‘
df.select("id", "name", "age")</div>
                        </div>

                        <div class="feature-card">
                            <h4>âœ… Broadcast Join</h4>
                            <p>×œ×˜×‘×œ××•×ª < 10MB</p>
                            <div class="code-block" style="font-size: 0.75rem; margin-top: 10px;"># âœ… ×˜×•×‘
broadcast(small_df)</div>
                        </div>

                        <div class="feature-card">
                            <h4>âœ… reduceByKey</h4>
                            <p>×‘××§×•× groupByKey</p>
                            <div class="code-block" style="font-size: 0.75rem; margin-top: 10px;"># âœ… ×˜×•×‘
reduceByKey(add)</div>
                        </div>

                        <div class="feature-card">
                            <h4>âœ… Cache ×‘×—×›××”</h4>
                            <p>×¨×§ × ×ª×•× ×™× ×©× ××©×›×™×</p>
                            <div class="code-block" style="font-size: 0.75rem; margin-top: 10px;"># âœ… ×˜×•×‘
df.cache()
df.count()  # materialize</div>
                        </div>

                        <div class="feature-card">
                            <h4>âŒ ××œ ×ª×¢×©×” collect()</h4>
                            <p>×¢×œ × ×ª×•× ×™× ×’×“×•×œ×™×!</p>
                            <div class="code-block" style="font-size: 0.75rem; margin-top: 10px;"># âŒ ×’×¨×•×¢
big_df.collect()</div>
                        </div>
                    </div>

                    <div class="success-box" style="margin-top: 30px;">
                        <h3>ğŸ¯ Golden Rules</h3>
                        <ol>
                            <li><strong>Push Down</strong> - filter/select ××•×§×“× ×›×›×œ ×”××¤×©×¨</li>
                            <li><strong>Avoid Shuffle</strong> - broadcast, partitionBy, coalesce</li>
                            <li><strong>Cache Smart</strong> - ×¨×§ × ×ª×•× ×™× ×©× ××©×›×™× 2+ ×¤×¢××™×</li>
                            <li><strong>Right Partitions</strong> - 2-4 partitions ×œ×›×œ core</li>
                            <li><strong>Parquet Always</strong> - ×œ× CSV!</li>
                        </ol>
                    </div>
                </div>
            </div>

            <!-- Code Quality -->
            <div class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-green)">ğŸ“</span> ××™×›×•×ª ×§×•×“</h2>
                </div>
                <div class="card-body">
                    <div class="code-block"># âœ… ×§×•×“ × ×§×™ ×•×§×¨×™×

from pyspark.sql.functions import col, avg, count
from pyspark.sql import SparkSession

# 1. ×”×’×“×¨×•×ª ×‘×¨×•×¨×•×ª
spark = SparkSession.builder \
    .appName("User Analytics") \
    .config("spark.sql.shuffle.partitions", "200") \
    .getOrCreate()

# 2. ×§×¨×™××” + validation
df = spark.read.parquet("/data/users") \
          .filter(col("created_at").isNotNull())

# 3. ×˜×¨× ×¡×¤×•×¨××¦×™×•×ª ×¢× ×©××•×ª ××©×ª× ×™× ×‘×¨×•×¨×™×
active_users = df.filter(col("status") == "active")

user_stats = active_users.groupBy("country") \
    .agg(
        count("*").alias("total_users"),
        avg("age").alias("avg_age")
    )

# 4. ×©××™×¨×” ×¢× partitioning
user_stats.write \
    .partitionBy("country") \
    .mode("overwrite") \
    .parquet("/output/user_stats")

# 5. Cleanup
spark.stop()</div>

                    <div class="info-box">
                        <h3>ğŸ’¡ ×¢×§×¨×•× ×•×ª</h3>
                        <ul>
                            <li>âœ… ×©××•×ª ××©×ª× ×™× ×ª×™××•×¨×™×™×</li>
                            <li>âœ… ×”×¢×¨×•×ª ×œ××”, ×œ× ××”</li>
                            <li>âœ… Error handling</li>
                            <li>âœ… Logging</li>
                            <li>âœ… Configuration ××¨×›×–×™×ª</li>
                            <li>âœ… Unit tests</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Resource Management -->
            <div class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-purple)">ğŸ›ï¸</span> × ×™×”×•×œ ××©××‘×™×</h2>
                </div>
                <div class="card-body">
                    <div class="success-box">
                        <h3>×”×’×“×¨×•×ª ××•××œ×¦×•×ª</h3>
                        <div class="code-block">spark-submit \
    --master yarn \
    --deploy-mode cluster \
    \
    # Memory Settings
    --executor-memory 8g \
    --driver-memory 4g \
    --executor-cores 4 \
    --num-executors 10 \
    \
    # Dynamic Allocation (××•××œ×¥!)
    --conf spark.dynamicAllocation.enabled=true \
    --conf spark.shuffle.service.enabled=true \
    --conf spark.dynamicAllocation.minExecutors=2 \
    --conf spark.dynamicAllocation.maxExecutors=50 \
    \
    # Performance
    --conf spark.sql.shuffle.partitions=200 \
    --conf spark.sql.adaptive.enabled=true \
    --conf spark.sql.adaptive.coalescePartitions.enabled=true \
    \
    # Memory Overhead
    --conf spark.executor.memoryOverhead=2g \
    \
    my_app.py</div>
                    </div>

                    <div class="warning-box">
                        <h3>âš–ï¸ ××™×š ×œ×‘×—×•×¨ Executor Size?</h3>
                        <ul>
                            <li><strong>Executor Memory:</strong> 4-8GB (×œ× ×™×•×ª×¨ ×-16GB)</li>
                            <li><strong>Executor Cores:</strong> 4-5 cores (×œ× ×™×•×ª×¨!)</li>
                            <li><strong>Num Executors:</strong> ×ª×œ×•×™ ×‘×’×•×“×œ Cluster</li>
                        </ul>
                        <p style="margin-top: 15px;"><strong>× ×•×¡×—×”:</strong></p>
                        <code>Total Cores = num_executors Ã— executor_cores</code><br>
                        <code>Total Memory = num_executors Ã— executor_memory</code>
                    </div>
                </div>
            </div>

            <!-- Production Checklist -->
            <div class="content-card">
                <div class="card-header">
                    <h2><span style="color:var(--spark-red)">âœ…</span> Production Checklist</h2>
                </div>
                <div class="card-body">
                    <div class="feature-grid" style="grid-template-columns: 1fr;">
                        <div class="info-box">
                            <h3>×œ×¤× ×™ ×”×¤×¦×” ×œ×¤×¨×•×“×§×©×Ÿ:</h3>
                            <ul style="list-style: none; padding: 0;">
                                <li>â˜ <strong>Data Format:</strong> Parquet ×¢× Partitioning</li>
                                <li>â˜ <strong>Error Handling:</strong> try/except + logging</li>
                                <li>â˜ <strong>Resource Config:</strong> Dynamic Allocation ××•×’×“×¨</li>
                                <li>â˜ <strong>Monitoring:</strong> Spark UI accessible</li>
                                <li>â˜ <strong>Logging:</strong> Log4j ×¢× Rolling Appender</li>
                                <li>â˜ <strong>Checkpoints:</strong> ×¢×‘×•×¨ Streaming</li>
                                <li>â˜ <strong>Testing:</strong> Unit tests + Integration tests</li>
                                <li>â˜ <strong>Documentation:</strong> README + Config docs</li>
                                <li>â˜ <strong>Performance:</strong> × ×‘×“×§ ×¢×œ × ×ª×•× ×™× ×××™×ª×™×™×</li>
                                <li>â˜ <strong>Alerting:</strong> ××•×’×“×¨ alerting ×¢×œ failures</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- === EXERCISES VIEW === -->
    <div id="view-exercises" class="view-section">
        <div class="exercise-list">
            <div style="text-align: center; margin-bottom: 50px;">
                <h1 style="font-size: 2.2rem; margin-bottom: 12px; font-weight: 800; color: var(--text-primary);">ğŸ“ ×ª×¨×’×™×œ×™× ××¢×©×™×™×</h1>
                <p style="color: var(--text-secondary); font-size: 1.05rem;">×ª×¨×’×œ×• ××ª ×”× ×•×©××™× ×©×œ××“×ª×</p>
            </div>

            <!-- Exercise 1 - RDD Basics -->
            <div class="exercise-card">
                <div class="ex-header">
                    <div class="ex-number">×ª×¨×’×™×œ 1</div>
                    <div class="ex-title">RDD - ×¡×¤×™×¨×ª ××™×œ×™× (Word Count)</div>
                </div>
                <div class="ex-content">
                    <p><strong>××©×™××”:</strong> ×§×¨× ×§×•×‘×¥ ×˜×§×¡×˜ ×•×¡×¤×•×¨ ×›××” ×¤×¢××™× ×›×œ ××™×œ×” ××•×¤×™×¢×”.</p>
                    <ul>
                        <li>×§×¨× ×§×•×‘×¥ ×˜×§×¡×˜ ×‘×××¦×¢×•×ª <code>sc.textFile()</code></li>
                        <li>×¤×¦×œ ×›×œ ×©×•×¨×” ×œ××™×œ×™×</li>
                        <li>×”××¨ ×›×œ ××™×œ×” ×œ-(word, 1)</li>
                        <li>×¦××¦× ×œ×¤×™ ××¤×ª×— ×œ×¡×¤×™×¨×ª ×”××™×œ×™×</li>
                        <li>×”×¦×’ ××ª 10 ×”××™×œ×™× ×”× ×¤×•×¦×•×ª ×‘×™×•×ª×¨</li>
                    </ul>
                    <button class="solution-toggle" onclick="toggleSolution(this)">ğŸ”“ ×”×¦×’ ×¤×ª×¨×•×Ÿ</button>
                    <div class="solution-content">
                    <div class="code-block"># ×¤×ª×¨×•×Ÿ
lines = sc.textFile("/path/to/file.txt")

words = lines.flatMap(lambda line: line.split())

word_pairs = words.map(lambda word: (word.lower(), 1))

word_counts = word_pairs.reduceByKey(lambda a, b: a + b)

top_10 = word_counts.sortBy(lambda x: x[1], ascending=False).take(10)

for word, count in top_10:
    print(f"{word}: {count}")</div>
                    </div>
                </div>
            </div>

            <!-- Exercise 2 - DataFrame Operations -->
            <div class="exercise-card">
                <div class="ex-header">
                    <div class="ex-number">×ª×¨×’×™×œ 2</div>
                    <div class="ex-title">DataFrame - × ×™×ª×•×— × ×ª×•× ×™ ××›×™×¨×•×ª</div>
                </div>
                <div class="ex-content">
                    <p><strong>××©×™××”:</strong> × ×ª×— × ×ª×•× ×™ ××›×™×¨×•×ª ××§×•×‘×¥ CSV.</p>
                    <ul>
                        <li>×§×¨× ×§×•×‘×¥ CSV ×¢× ×¢××•×“×•×ª: product, category, price, quantity, date</li>
                        <li>×¡× ×Ÿ ×¨×§ ××›×™×¨×•×ª ×-2023</li>
                        <li>×”×•×¡×£ ×¢××•×“×”: total_price = price * quantity</li>
                        <li>××¦× ××ª ×¡×š ×”××›×™×¨×•×ª ×œ×¤×™ ×§×˜×’×•×¨×™×”</li>
                        <li>××™×™×Ÿ ×œ×¤×™ ×¡×š ××›×™×¨×•×ª (×™×•×¨×“)</li>
                    </ul>
                    <button class="solution-toggle" onclick="toggleSolution(this)">ğŸ”“ ×”×¦×’ ×¤×ª×¨×•×Ÿ</button>
                    <div class="solution-content">
                    <div class="code-block"># ×¤×ª×¨×•×Ÿ
from pyspark.sql.functions import col, year, sum as _sum

# ×§×¨×™××ª ×”× ×ª×•× ×™×
df = spark.read.csv("/path/to/sales.csv", header=True, inferSchema=True)

# ×¡×™× ×•×Ÿ ×œ-2023
df_2023 = df.filter(year(col("date")) == 2023)

# ×”×•×¡×¤×ª total_price
df_with_total = df_2023.withColumn("total_price", col("price") * col("quantity"))

# ×§×™×‘×•×¥ ×œ×¤×™ ×§×˜×’×•×¨×™×”
sales_by_category = df_with_total.groupBy("category") \
    .agg(_sum("total_price").alias("total_sales"))

# ××™×•×Ÿ
result = sales_by_category.orderBy(col("total_sales").desc())

result.show()</div>
                    </div>
                </div>
            </div>

            <!-- Exercise 3 - Joins -->
            <div class="exercise-card">
                <div class="ex-header">
                    <div class="ex-number">×ª×¨×’×™×œ 3</div>
                    <div class="ex-title">Joins - ×—×™×‘×•×¨ ×˜×‘×œ××•×ª</div>
                </div>
                <div class="ex-content">
                    <p><strong>××©×™××”:</strong> ×—×‘×¨ ×‘×™×Ÿ ×˜×‘×œ×ª ××©×ª××©×™× ×œ×˜×‘×œ×ª ×”×–×× ×•×ª.</p>
                    <ul>
                        <li>×˜×‘×œ×” 1: users (id, name, city)</li>
                        <li>×˜×‘×œ×” 2: orders (order_id, user_id, amount)</li>
                        <li>×—×‘×¨ ××ª ×”×˜×‘×œ××•×ª</li>
                        <li>×—×©×‘ ×¡×š ×”×–×× ×•×ª ×œ×›×œ ××©×ª××©</li>
                        <li>×”×¦×’ ××©×ª××©×™× ×œ×œ× ×”×–×× ×•×ª (×× ×™×©)</li>
                    </ul>
                    <button class="solution-toggle" onclick="toggleSolution(this)">ğŸ”“ ×”×¦×’ ×¤×ª×¨×•×Ÿ</button>
                    <div class="solution-content">
                    <div class="code-block"># ×¤×ª×¨×•×Ÿ
from pyspark.sql.functions import sum, coalesce

users = spark.createDataFrame([
    (1, "Alice", "Tel Aviv"),
    (2, "Bob", "Haifa"),
    (3, "Charlie", "Jerusalem")
], ["id", "name", "city"])

orders = spark.createDataFrame([
    (101, 1, 100),
    (102, 1, 200),
    (103, 2, 150)
], ["order_id", "user_id", "amount"])

# Left Join - ×›×•×œ×œ ××©×ª××©×™× ×œ×œ× ×”×–×× ×•×ª
result = users.join(orders, users.id == orders.user_id, "left")

# ×§×™×‘×•×¥ ×•×¡×™×›×•×
from pyspark.sql.functions import lit

user_totals = result.groupBy("id", "name", "city") \
    .agg(
        coalesce(sum("amount"), lit(0)).alias("total_orders")
    )

user_totals.show()

# ××©×ª××©×™× ×œ×œ× ×”×–×× ×•×ª
no_orders = user_totals.filter(col("total_orders") == 0)
no_orders.show()</div>
                    </div>
                </div>
            </div>

            <!-- Exercise 4 - Window Functions -->
            <div class="exercise-card">
                <div class="ex-header">
                    <div class="ex-number">×ª×¨×’×™×œ 4</div>
                    <div class="ex-title">Window Functions - ×“×™×¨×•×’ ×¢×•×‘×“×™×</div>
                </div>
                <div class="ex-content">
                    <p><strong>××©×™××”:</strong> ×“×¨×’ ×¢×•×‘×“×™× ×œ×¤×™ ××©×›×•×¨×ª ×‘×›×œ ××—×œ×§×”.</p>
                    <ul>
                        <li>×˜×‘×œ×”: employees (name, department, salary)</li>
                        <li>×”×•×¡×£ ×¢××•×“×ª rank ×œ×¤×™ ××©×›×•×¨×ª ×‘×›×œ ××—×œ×§×”</li>
                        <li>××¦× ××ª 3 ×”××©×›×•×¨×•×ª ×”×’×‘×•×”×•×ª ×‘×›×œ ××—×œ×§×”</li>
                        <li>×—×©×‘ ××©×›×•×¨×ª ×××•×¦×¢×ª per ××—×œ×§×” ×•×”×•×¡×£ ×›×¢××•×“×”</li>
                    </ul>
                    <button class="solution-toggle" onclick="toggleSolution(this)">ğŸ”“ ×”×¦×’ ×¤×ª×¨×•×Ÿ</button>
                    <div class="solution-content">
                    <div class="code-block"># ×¤×ª×¨×•×Ÿ
from pyspark.sql.window import Window
from pyspark.sql.functions import rank, avg

employees = spark.createDataFrame([
    ("Alice", "Engineering", 120000),
    ("Bob", "Engineering", 110000),
    ("Charlie", "Engineering", 105000),
    ("David", "Sales", 90000),
    ("Eve", "Sales", 95000)
], ["name", "department", "salary"])

# ×”×’×“×¨×ª window
window_spec = Window.partitionBy("department").orderBy(col("salary").desc())

# ×”×•×¡×¤×ª rank
ranked = employees.withColumn("rank", rank().over(window_spec))

# Top 3 per department
top_3 = ranked.filter(col("rank") <= 3)

# ××©×›×•×¨×ª ×××•×¦×¢×ª per department
window_spec2 = Window.partitionBy("department")
with_avg = top_3.withColumn("dept_avg_salary", avg("salary").over(window_spec2))

with_avg.show()</div>
                    </div>
                </div>
            </div>

            <!-- Exercise 5 - Streaming -->
            <div class="exercise-card">
                <div class="ex-header">
                    <div class="ex-number">×ª×¨×’×™×œ 5</div>
                    <div class="ex-title">Structured Streaming - ×¡×¤×™×¨×” ×‘×–××Ÿ ×××ª</div>
                </div>
                <div class="ex-content">
                    <p><strong>××©×™××”:</strong> ×¡×¤×•×¨ ×”×•×“×¢×•×ª ×‘×–××Ÿ ×××ª ×-Kafka.</p>
                    <ul>
                        <li>×§×¨× stream ×-Kafka topic</li>
                        <li>×”××¨ ××ª value ×œ-string</li>
                        <li>×¤×¦×œ ×œ××™×œ×™× ×•×¡×¤×•×¨</li>
                        <li>×›×ª×•×‘ ×œconsole ×¢× update mode</li>
                        <li>×”×•×¡×£ checkpoint</li>
                    </ul>
                    <button class="solution-toggle" onclick="toggleSolution(this)">ğŸ”“ ×”×¦×’ ×¤×ª×¨×•×Ÿ</button>
                    <div class="solution-content">
                    <div class="code-block"># ×¤×ª×¨×•×Ÿ
from pyspark.sql.functions import explode, split

# ×§×¨×™××” ×-Kafka
df = spark.readStream \
    .format("kafka") \
    .option("kafka.bootstrap.servers", "localhost:9092") \
    .option("subscribe", "messages") \
    .load()

# ×”××¨×” ×œ-string
lines = df.selectExpr("CAST(value AS STRING)")

# ×¤×™×¦×•×œ ×•×¡×¤×™×¨×”
words = lines.select(explode(split(col("value"), " ")).alias("word"))
word_counts = words.groupBy("word").count()

# ×›×ª×™×‘×” ×œconsole
query = word_counts.writeStream \
    .outputMode("update") \
    .format("console") \
    .option("checkpointLocation", "/tmp/checkpoint") \
    .start()

query.awaitTermination()</div>
                    </div>
                </div>
            </div>

            <!-- Exercise 6 - Optimization -->
            <div class="exercise-card">
                <div class="ex-header">
                    <div class="ex-number">×ª×¨×’×™×œ 6</div>
                    <div class="ex-title">××•×¤×˜×™××™×–×¦×™×” - ×©×™×¤×•×¨ ×‘×™×¦×•×¢×™×</div>
                </div>
                <div class="ex-content">
                    <p><strong>××©×™××”:</strong> ××•×¤×˜× ××ª ×”×§×•×“ ×”×‘×:</p>
                    <div class="code-block"># ×§×•×“ ×œ× ×××•×¤×˜×
large_df = spark.read.csv("/data/large.csv")
small_df = spark.read.csv("/data/small.csv")

result = large_df.join(small_df, "id") \
    .filter(col("date") >= "2023-01-01") \
    .select("*") \
    .groupBy("category").count()

result.show()
result.show()  # ×©×™××•×© ×—×•×–×¨</div>

                    <p><strong>×‘×¢×™×•×ª:</strong></p>
                    <ul>
                        <li>âŒ Join ×œ×¤× ×™ filter</li>
                        <li>âŒ Select ×©×œ ×›×œ ×”×¢××•×“×•×ª</li>
                        <li>âŒ ××™×Ÿ cache ×œ×©×™××•×© ×—×•×–×¨</li>
                        <li>âŒ ×œ× ××©×ª××© ×‘-broadcast ×œ×˜×‘×œ×” ×§×˜× ×”</li>
                    </ul>

                    <button class="solution-toggle" onclick="toggleSolution(this)">ğŸ”“ ×”×¦×’ ×¤×ª×¨×•×Ÿ</button>
                    <div class="solution-content">
                    <div class="code-block"># ×¤×ª×¨×•×Ÿ ×××•×¤×˜×
from pyspark.sql.functions import broadcast

# ×§×¨×™××” + filter ××™×“
large_df = spark.read.csv("/data/large.csv") \
    .filter(col("date") >= "2023-01-01") \
    .select("id", "category", "date")  # ×¨×§ ×¢××•×“×•×ª × ×“×¨×©×•×ª

small_df = spark.read.csv("/data/small.csv")

# Broadcast join
result = large_df.join(broadcast(small_df), "id") \
    .groupBy("category").count() \
    .cache()  # cache ×œ×©×™××•×© ×—×•×–×¨

result.show()
result.show()  # ×¤×¢× ×©× ×™×™×” ××”×™×¨×”!</div>
                    </div>
                </div>
            </div>

            <!-- Exercise 7 - UDFs -->
            <div class="exercise-card">
                <div class="ex-header">
                    <div class="ex-number">×ª×¨×’×™×œ 7</div>
                    <div class="ex-title">UDF - ×§×˜×’×•×¨×™×–×¦×™×” ××•×ª×××ª ××™×©×™×ª</div>
                </div>
                <div class="ex-content">
                    <p><strong>××©×™××”:</strong> ×¦×•×¨ UDF ×œ×§×˜×’×•×¨×™×–×¦×™×” ×©×œ ×¦×™×•× ×™×.</p>
                    <ul>
                        <li>90-100: Excellent</li>
                        <li>80-89: Good</li>
                        <li>70-79: Average</li>
                        <li>××ª×—×ª ×œ-70: Need Improvement</li>
                    </ul>
                    <button class="solution-toggle" onclick="toggleSolution(this)">ğŸ”“ ×”×¦×’ ×¤×ª×¨×•×Ÿ</button>
                    <div class="solution-content">
                    <div class="code-block"># ×¤×ª×¨×•×Ÿ
from pyspark.sql.functions import udf
from pyspark.sql.types import StringType

# ×”×’×“×¨×ª UDF
@udf(returnType=StringType())
def grade_category(score):
    if score >= 90:
        return "Excellent"
    elif score >= 80:
        return "Good"
    elif score >= 70:
        return "Average"
    else:
        return "Need Improvement"

# × ×ª×•× ×™ ×“×•×’××”
students = spark.createDataFrame([
    ("Alice", 95),
    ("Bob", 85),
    ("Charlie", 75),
    ("David", 65)
], ["name", "score"])

# ×©×™××•×© ×‘-UDF
result = students.withColumn("grade", grade_category(col("score")))
result.show()</div>

                    <p><strong>×‘×•× ×•×¡:</strong> ×”××¨ ×œ-Pandas UDF ×œ×‘×™×¦×•×¢×™× ×˜×•×‘×™× ×™×•×ª×¨!</p>
                    <div class="code-block"># Pandas UDF - ×™×¢×™×œ ×™×•×ª×¨!
from pyspark.sql.functions import pandas_udf
import pandas as pd

@pandas_udf("string")
def grade_category_pandas(scores: pd.Series) -> pd.Series:
    def categorize(score):
        if score >= 90:
            return "Excellent"
        elif score >= 80:
            return "Good"
        elif score >= 70:
            return "Average"
        else:
            return "Need Improvement"

    return scores.apply(categorize)

result = students.withColumn("grade", grade_category_pandas(col("score")))
result.show()</div>
                    </div>
                </div>
            </div>

        </div>
    </div>

</div>

<div class="copy-notification" id="copyNotification">
    âœ… ×”×•×¢×ª×§ ×œ×œ×•×—!
</div>

<script>
    /* === NAVIGATION === */
    function switchView(viewId, btn) {
        document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
        document.getElementById('view-' + viewId).classList.add('active');

        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        btn.classList.add('active');
    }

    function showTheorySection(sectionId, btn) {
        document.querySelectorAll('.theory-section').forEach(el => el.classList.remove('active'));
        document.getElementById('theory-' + sectionId).classList.add('active');

        document.querySelectorAll('.theory-nav-item').forEach(el => el.classList.remove('active'));
        btn.classList.add('active');
    }

    function scrollToSection(sectionId, btn) {
        const section = document.getElementById(sectionId);
        if (section) {
            section.scrollIntoView({ behavior: 'smooth', block: 'start' });

            // Update active state
            const parent = btn.closest('.theory-sidebar');
            if (parent) {
                parent.querySelectorAll('.theory-nav-item').forEach(el => el.classList.remove('active'));
                btn.classList.add('active');
            }
        }
    }

    /* === DARK MODE === */
    function toggleDarkMode() {
        document.body.classList.toggle('dark-mode');
        const isDark = document.body.classList.contains('dark-mode');
        const btn = document.getElementById('darkModeToggle');
        btn.textContent = isDark ? 'â˜€ï¸ ××¦×‘ ×™×•×' : 'ğŸŒ™ ××¦×‘ ×œ×™×œ×”';
        localStorage.setItem('darkMode', isDark);
    }

    // Load dark mode preference
    if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
        document.getElementById('darkModeToggle').textContent = 'â˜€ï¸ ××¦×‘ ×™×•×';
    }

    /* === SEARCH === */
    function toggleSearch() {
        const searchBar = document.getElementById('searchBar');
        const isVisible = searchBar.style.display !== 'none';
        searchBar.style.display = isVisible ? 'none' : 'block';
        if (!isVisible) {
            document.getElementById('searchInput').focus();
        } else {
            document.getElementById('searchResults').innerHTML = '';
        }
    }

    // Search database - ×›×œ ×”×¤×•× ×§×¦×™×•×ª ××”-Cheat Sheet
    const searchDatabase = [
        // === RDD Creation ===
        { term: 'sc.parallelize', aliases: ['parallelize'], type: 'RDD Creation', description: '×™×¦×™×¨×ª RDD ×-Python list - use when you have data in memory', example: 'sc.parallelize([1, 2, 3, 4])', view: 'rdd' },
        { term: '.rdd', aliases: ['df.rdd', 'dataframe to rdd'], type: 'RDD Creation', description: '×”××¨×ª DataFrame ×œ-RDD - use when converting existing DataFrame', example: 'df = spark.read.csv("file.csv"); rdd = df.rdd', view: 'rdd' },
        { term: 'parallelize vs rdd', aliases: ['sc.parallelize vs .rdd', 'rdd creation'], type: 'RDD Creation', description: 'parallelize = from Python list | .rdd = from DataFrame', example: 'sc.parallelize(data) vs df.rdd', view: 'rdd' },

        // === RDD Transformations ===
        { term: 'map', type: 'RDD Transform', description: '××™×¤×•×™ 1:1 - ××—×–×™×¨ RDD ×—×“×© ×¢× func ×¢×œ ×›×œ ××œ×× ×˜', example: 'rdd.map(lambda x: x * 2)', view: 'cheatsheet' },
        { term: 'filter', type: 'RDD Transform', description: '×¡×™× ×•×Ÿ - ××—×–×™×¨ ×¨×§ ××œ×× ×˜×™× ×©×¢×•×‘×¨×™× ××ª ×”×ª× ××™', example: 'rdd.filter(lambda x: x > 10)', view: 'cheatsheet' },
        { term: 'flatMap', type: 'RDD Transform', description: '××™×¤×•×™ 1:N + ×”×©×˜×—×” - ×›×œ ××œ×× ×˜ ×™×›×•×œ ×œ×”×—×–×™×¨ 0 ××• ×™×•×ª×¨', example: 'rdd.flatMap(lambda x: x.split())', view: 'cheatsheet' },
        { term: 'mapPartitions', type: 'RDD Transform', description: '×¢×™×‘×•×“ partition ×©×œ× ×‘×‘×ª ××—×ª (×™×¢×™×œ!)', example: 'rdd.mapPartitions(process_part)', view: 'cheatsheet' },
        { term: 'distinct', type: 'RDD Transform', description: '×¢×¨×›×™× ×™×™×—×•×“×™×™× ×‘×œ×‘×“', example: 'rdd.distinct()', view: 'cheatsheet' },
        { term: 'union', type: 'RDD Transform', description: '××™×—×•×“ ×©× ×™ RDDs (×›×•×œ×œ ×›×¤×™×œ×•×™×•×ª)', example: 'rdd1.union(rdd2)', view: 'cheatsheet' },
        { term: 'intersect', aliases: ['intersection'], type: 'RDD Transform', description: '×—×™×ª×•×š - ×¢×¨×›×™× ××©×•×ª×¤×™×', example: 'rdd1.intersect(rdd2)', view: 'cheatsheet' },
        { term: 'subtract', type: 'RDD Transform', description: '×”×¤×¨×© - ×¢×¨×›×™× ×‘-rdd1 ×©×œ× ×‘-rdd2', example: 'rdd1.subtract(rdd2)', view: 'cheatsheet' },
        { term: 'sample', type: 'RDD Transform', description: '×“×’×™××” ××§×¨××™×ª', example: 'rdd.sample(False, 0.1)', view: 'cheatsheet' },
        { term: 'coalesce', type: 'RDD Transform', description: '×”×§×˜× ×ª ××¡×¤×¨ partitions (×œ×œ× shuffle)', example: 'rdd.coalesce(1)', view: 'cheatsheet' },
        { term: 'repartition', type: 'RDD Transform', description: '×©×™× ×•×™ ××¡×¤×¨ partitions (×¢× shuffle)', example: 'rdd.repartition(10)', view: 'cheatsheet' },

        // === Pair RDD (Key-Value) ===
        { term: 'reduceByKey', type: 'Pair RDD', description: '×¦××¦×•× ×œ×¤×™ ××¤×ª×— (×™×¢×™×œ! ×¢× local reduce)', example: 'pairs.reduceByKey(lambda a,b: a+b)', view: 'cheatsheet' },
        { term: 'groupByKey', type: 'Pair RDD', description: '×§×™×‘×•×¥ ×¢×¨×›×™× ×œ×¤×™ ××¤×ª×— (×¤×—×•×ª ×™×¢×™×œ!)', example: 'pairs.groupByKey()', view: 'cheatsheet' },
        { term: 'mapValues', type: 'Pair RDD', description: 'map ×¨×§ ×¢×œ ×”×¢×¨×›×™× (×©×•××¨ partitioning!)', example: 'pairs.mapValues(lambda x: x * 2)', view: 'cheatsheet' },
        { term: 'flatMapValues', type: 'Pair RDD', description: 'flatMap ×¨×§ ×¢×œ ×”×¢×¨×›×™×', example: 'pairs.flatMapValues(lambda x: x)', view: 'cheatsheet' },
        { term: 'keys', type: 'Pair RDD', description: '×”×—×–×¨×ª ×¨×§ ×”××¤×ª×—×•×ª', example: 'pairs.keys()', view: 'cheatsheet' },
        { term: 'values', type: 'Pair RDD', description: '×”×—×–×¨×ª ×¨×§ ×”×¢×¨×›×™×', example: 'pairs.values()', view: 'cheatsheet' },
        { term: 'sortByKey', type: 'Pair RDD', description: '××™×•×Ÿ ×œ×¤×™ ××¤×ª×—', example: 'pairs.sortByKey(ascending=True)', view: 'cheatsheet' },
        { term: 'join', aliases: ['rdd join'], type: 'Pair RDD', description: 'Inner join ×¢×œ ××¤×ª×—', example: 'rdd1.join(rdd2)', view: 'cheatsheet' },
        { term: 'leftOuterJoin', type: 'Pair RDD', description: 'Left outer join', example: 'rdd1.leftOuterJoin(rdd2)', view: 'cheatsheet' },

        // === RDD Actions ===
        { term: 'collect', type: 'RDD Action', description: '×”×—×–×¨×ª ×›×œ ×”××œ×× ×˜×™× ×œ-Driver (×–×”×™×¨×•×ª!)', example: 'rdd.collect()', view: 'cheatsheet' },
        { term: 'count', type: 'RDD Action', description: '×¡×¤×™×¨×ª ××¡×¤×¨ ××œ×× ×˜×™×', example: 'rdd.count()', view: 'cheatsheet' },
        { term: 'first', type: 'RDD Action', description: '×”×—×–×¨×ª ××œ×× ×˜ ×¨××©×•×Ÿ', example: 'rdd.first()', view: 'cheatsheet' },
        { term: 'take', type: 'RDD Action', description: '×”×—×–×¨×ª N ××œ×× ×˜×™× ×¨××©×•× ×™×', example: 'rdd.take(10)', view: 'cheatsheet' },
        { term: 'reduce', type: 'RDD Action', description: '×¦××¦×•× ×œ×¢×¨×š ×™×—×™×“', example: 'rdd.reduce(lambda a,b: a+b)', view: 'cheatsheet' },
        { term: 'saveAsTextFile', type: 'RDD Action', description: '×©××™×¨×” ×›×§×‘×¦×™ ×˜×§×¡×˜', example: 'rdd.saveAsTextFile("/path")', view: 'cheatsheet' },
        { term: 'countByKey', type: 'RDD Action', description: '×¡×¤×™×¨×ª ×¢×¨×›×™× ×œ×›×œ ××¤×ª×— (Pair RDD)', example: 'pairs.countByKey()', view: 'cheatsheet' },
        { term: 'collectAsMap', type: 'RDD Action', description: '×”××¨×” ×œ-dictionary (Pair RDD)', example: 'pairs.collectAsMap()', view: 'cheatsheet' },

        // === Cache & Persistence ===
        { term: 'cache', type: 'Performance', description: '×©××™×¨×” ×‘×–×™×›×¨×•×Ÿ (MEMORY_ONLY)', example: 'rdd.cache()', view: 'cheatsheet' },
        { term: 'persist', type: 'Performance', description: '×©××™×¨×” ×¢× storage level ××•×ª××', example: 'rdd.persist(MEMORY_AND_DISK)', view: 'cheatsheet' },
        { term: 'unpersist', type: 'Performance', description: '×”×¡×¨×” ×-cache', example: 'rdd.unpersist()', view: 'cheatsheet' },
        { term: 'getNumPartitions', type: 'RDD Info', description: '××¡×¤×¨ partitions', example: 'rdd.getNumPartitions()', view: 'cheatsheet' },

        // === DataFrame Operations ===
        { term: 'select', type: 'DataFrame', description: '×‘×—×™×¨×ª ×¢××•×“×•×ª (×¢× cast ×•-alias)', example: 'df.select(F.col("id").cast("int").alias("user_id"))', view: 'cheatsheet' },
        { term: 'filter', aliases: ['where'], type: 'DataFrame', description: '×¡×™× ×•×Ÿ ×©×•×¨×•×ª ×œ×¤×™ ×ª× ××™', example: 'df.filter(col("age") > 25)', view: 'cheatsheet' },
        { term: 'where', aliases: ['filter'], type: 'DataFrame', description: '×¡×™× ×•×Ÿ ×©×•×¨×•×ª ×œ×¤×™ ×ª× ××™', example: 'df.where(col("age") > 25)', view: 'cheatsheet' },
        { term: 'groupBy', type: 'DataFrame', description: '×§×™×‘×•×¥ ×œ×¤×™ ×¢××•×“×•×ª', example: 'df.groupBy("dept").count()', view: 'cheatsheet' },
        { term: 'agg', aliases: ['aggregate'], type: 'DataFrame', description: 'aggregation ××¨×•×‘×”', example: 'df.groupBy("dept").agg(avg("salary"), max("age"))', view: 'cheatsheet' },
        { term: 'orderBy', aliases: ['sort'], type: 'DataFrame', description: '××™×•×Ÿ ×©×•×¨×•×ª', example: 'df.orderBy(col("age").desc())', view: 'cheatsheet' },
        { term: 'sort', aliases: ['orderBy'], type: 'DataFrame', description: '××™×•×Ÿ ×©×•×¨×•×ª', example: 'df.sort(col("age").desc())', view: 'cheatsheet' },
        { term: 'withColumn', type: 'DataFrame', description: '×”×•×¡×¤×ª/×¢×“×›×•×Ÿ ×¢××•×“×”', example: 'df.withColumn("new", col("age") + 1)', view: 'cheatsheet' },
        { term: 'withColumnRenamed', type: 'DataFrame', description: '×©×™× ×•×™ ×©× ×¢××•×“×”', example: 'df.withColumnRenamed("old", "new")', view: 'cheatsheet' },
        { term: 'drop', type: 'DataFrame', description: '××—×™×§×ª ×¢××•×“×•×ª', example: 'df.drop("column_name")', view: 'cheatsheet' },
        { term: 'dropDuplicates', aliases: ['drop_duplicates'], type: 'DataFrame', description: '×”×¡×¨×ª ×›×¤×™×œ×•×™×•×ª ×œ×¤×™ ×¢××•×“×•×ª', example: 'df.dropDuplicates(["id"])', view: 'cheatsheet' },
        { term: 'show', type: 'DataFrame', description: '×”×¦×’×ª ×©×•×¨×•×ª', example: 'df.show(10, truncate=False)', view: 'cheatsheet' },
        { term: 'printSchema', type: 'DataFrame', description: '×”×¦×’×ª Schema', example: 'df.printSchema()', view: 'cheatsheet' },
        { term: 'describe', type: 'DataFrame', description: '×¡×˜×˜×™×¡×˜×™×§×•×ª', example: 'df.describe().show()', view: 'cheatsheet' },

        // === I/O ===
        { term: 'parquet', type: 'I/O', description: '×§×¨×™××ª/×›×ª×™×‘×ª Parquet', example: 'spark.read.parquet(path)', view: 'cheatsheet' },
        { term: 'csv', type: 'I/O', description: '×§×¨×™××ª/×›×ª×™×‘×ª CSV', example: 'spark.read.csv(path, header=True)', view: 'cheatsheet' },
        { term: 'json', type: 'I/O', description: '×§×¨×™××ª/×›×ª×™×‘×ª JSON', example: 'spark.read.json(path)', view: 'cheatsheet' },
        { term: 'read', type: 'I/O', description: '×§×¨×™××ª ×§×‘×¦×™×', example: 'spark.read.format("csv").load()', view: 'cheatsheet' },
        { term: 'write', type: 'I/O', description: '×›×ª×™×‘×ª ×§×‘×¦×™×', example: 'df.write.parquet(path)', view: 'cheatsheet' },

        // === Advanced ===
        { term: 'broadcast', type: 'Advanced', description: 'Broadcast Join - ×™×¢×™×œ ×œ×˜×‘×œ××•×ª ×§×˜× ×•×ª', example: 'broadcast(small_df)', view: 'cheatsheet' },
        { term: 'window', type: 'SQL Functions', description: 'Window Functions', example: 'row_number().over(window_spec)', view: 'cheatsheet' },
        { term: 'row_number', type: 'Window', description: '××¡×¤×•×¨ ×©×•×¨×•×ª', example: 'row_number().over(window_spec)', view: 'cheatsheet' },
        { term: 'rank', type: 'Window', description: '×“×™×¨×•×’ ×¢× ×“×™×œ×•×’×™×', example: 'rank().over(window_spec)', view: 'cheatsheet' },
        { term: 'dense_rank', type: 'Window', description: '×“×™×¨×•×’ ×œ×œ× ×“×™×œ×•×’×™×', example: 'dense_rank().over(window_spec)', view: 'cheatsheet' },
        { term: 'ntile', type: 'Window', description: '×—×œ×•×§×” ×œ-N ×§×‘×•×¦×•×ª', example: 'ntile(4).over(window_spec)', view: 'cheatsheet' },
        { term: 'percent_rank', type: 'Window', description: '××—×•×–×•×Ÿ ×™×—×¡×™', example: 'percent_rank().over(window_spec)', view: 'cheatsheet' },
        { term: 'cume_dist', type: 'Window', description: '×”×ª×¤×œ×’×•×ª ××¦×˜×‘×¨×ª', example: 'cume_dist().over(window_spec)', view: 'cheatsheet' },
        { term: 'lag', type: 'Window', description: '×¢×¨×š ×§×•×“×', example: 'lag("col", 1).over(window_spec)', view: 'cheatsheet' },
        { term: 'lead', type: 'Window', description: '×¢×¨×š ×”×‘×', example: 'lead("col", 1).over(window_spec)', view: 'cheatsheet' },
        { term: 'UDF', aliases: ['udf'], type: 'Functions', description: 'User Defined Functions', example: '@udf(returnType=StringType())', view: 'cheatsheet' },

        // === Aggregations ===
        { term: 'sum', type: 'Aggregation', description: '×¡×›×•×', example: 'sum("column")', view: 'cheatsheet' },
        { term: 'avg', aliases: ['mean'], type: 'Aggregation', description: '×××•×¦×¢', example: 'avg("salary")', view: 'cheatsheet' },
        { term: 'max', type: 'Aggregation', description: '××§×¡×™××•×', example: 'max("age")', view: 'cheatsheet' },
        { term: 'min', type: 'Aggregation', description: '××™× ×™××•×', example: 'min("age")', view: 'cheatsheet' },
        { term: 'count', type: 'Aggregation', description: '×¡×¤×™×¨×”', example: 'count("*")', view: 'cheatsheet' },
        { term: 'countDistinct', type: 'Aggregation', description: '×¡×¤×™×¨×ª ×¢×¨×›×™× ×™×™×—×•×“×™×™×', example: 'countDistinct("user_id")', view: 'cheatsheet' },

        // === Streaming ===
        { term: 'readStream', type: 'Streaming', description: 'Structured Streaming - ×§×¨×™××”', example: 'spark.readStream.format("kafka")', view: 'streaming' },
        { term: 'writeStream', type: 'Streaming', description: 'Structured Streaming - ×›×ª×™×‘×”', example: 'df.writeStream.format("console")', view: 'streaming' },
        { term: 'kafka', type: 'Streaming', description: '×§×¨×™××”/×›×ª×™×‘×” ×-Kafka', example: '.format("kafka").option("subscribe", "topic")', view: 'streaming' },
        { term: 'watermark', type: 'Streaming', description: 'Watermark ×œ××™×¨×•×¢×™× ×××•×—×¨×™×', example: 'withWatermark("timestamp", "10 minutes")', view: 'streaming' },
        { term: 'outputMode', aliases: ['output mode', 'append', 'complete', 'update'], type: 'Streaming', description: '××¦×‘×™ ×¤×œ×˜ - Append/Complete/Update', example: '.outputMode("update")', view: 'streaming' },
        { term: 'append mode', aliases: ['append'], type: 'Streaming', description: '×¨×§ ×©×•×¨×•×ª ×—×“×©×•×ª - ×œ× ××¢×“×›×Ÿ ×©×•×¨×•×ª ×§×™×™××•×ª', example: '.outputMode("append")', view: 'streaming' },
        { term: 'complete mode', aliases: ['complete'], type: 'Streaming', description: '×›×œ ×˜×‘×œ×ª ×”×ª×•×¦××” ×‘×›×œ batch - ×“×•×¨×© aggregation', example: '.outputMode("complete")', view: 'streaming' },
        { term: 'update mode', aliases: ['update'], type: 'Streaming', description: '×¨×§ ×©×•×¨×•×ª ×©×”×©×ª× ×• - ×™×¢×™×œ ×™×•×ª×¨ ×-complete', example: '.outputMode("update")', view: 'streaming' },
        { term: 'awaitTermination', type: 'Streaming', description: '×”××ª× ×” ×œ×¡×™×•× streaming query', example: 'query.awaitTermination()', view: 'streaming' },
        { term: 'checkpoint', aliases: ['checkpointLocation'], type: 'Streaming', description: 'Checkpoint ×œ××¦×‘ streaming - ×—×•×‘×” ×‘×¤×¨×•×“×§×©×Ÿ', example: '.option("checkpointLocation", "/path")', view: 'streaming' },

        // === Performance & Tuning ===
        { term: 'shuffle', type: 'Performance', description: 'Shuffle Optimization', example: 'reduceByKey vs groupByKey', view: 'cheatsheet' },
        { term: 'partition', aliases: ['partitioning'], type: 'Performance', description: '× ×™×”×•×œ Partitions', example: 'repartition(), coalesce()', view: 'cheatsheet' },
        { term: 'spark-submit', type: 'Deployment', description: '×”×¨×¦×ª Spark Application', example: 'spark-submit --master yarn --executor-memory 4g', view: 'cheatsheet' },

        // === Common Functions ===
        { term: 'col', type: 'Functions', description: '×”×ª×™×™×—×¡×•×ª ×œ×¢××•×“×”', example: 'col("name")', view: 'cheatsheet' },
        { term: 'lit', type: 'Functions', description: '×¢×¨×š ×§×‘×•×¢', example: 'lit(100)', view: 'cheatsheet' },
        { term: 'when', type: 'Functions', description: '×ª× ××™ if-then', example: 'when(col("age") > 18, "adult")', view: 'cheatsheet' },
        { term: 'coalesce', aliases: ['coalesce function'], type: 'Functions', description: '×¢×¨×š ×¨××©×•×Ÿ ×©××™× ×• null', example: 'coalesce(col("a"), col("b"))', view: 'cheatsheet' },
        { term: 'cast', type: 'Functions', description: '×”××¨×ª ×˜×™×¤×•×¡', example: 'col("id").cast("int")', view: 'cheatsheet' },
        { term: 'alias', type: 'Functions', description: '×©×™× ×•×™ ×©× ×¢××•×“×”', example: 'col("name").alias("full_name")', view: 'cheatsheet' }
    ];

    function performSearch(query) {
        const resultsDiv = document.getElementById('searchResults');

        if (!query || query.length < 2) {
            resultsDiv.innerHTML = '';
            return;
        }

        // × ×§×” ××ª ×”×©××™×œ×ª× ××¡×•×’×¨×™×™× ×•×ª×•×•×™× ××™×•×—×“×™× ×œ×—×™×¤×•×© ×’××™×© ×™×•×ª×¨
        const cleanQuery = query.toLowerCase().replace(/[()]/g, '').trim();

        const results = searchDatabase.filter(item => {
            const cleanTerm = item.term.toLowerCase().replace(/[()]/g, '');
            const cleanExample = item.example.toLowerCase().replace(/[()]/g, '');

            // ×—×™×¤×•×© ×‘××•× ×— ×¢×¦××• (×¢× ×•×‘×œ×™ ×¡×•×’×¨×™×™×)
            if (cleanTerm.includes(cleanQuery)) return true;

            // ×—×™×¤×•×© ×‘-aliases ×× ×§×™×™××™×
            if (item.aliases && item.aliases.some(alias =>
                alias.toLowerCase().replace(/[()]/g, '').includes(cleanQuery)
            )) return true;

            // ×—×™×¤×•×© ×‘×ª×™××•×¨
            if (item.description.includes(query)) return true;

            // ×—×™×¤×•×© ×‘×“×•×’××
            if (cleanExample.includes(cleanQuery)) return true;

            return false;
        });

        if (results.length === 0) {
            resultsDiv.innerHTML = '<div style="padding: 20px; text-align: center; color: var(--text-secondary);">×œ× × ××¦××• ×ª×•×¦××•×ª</div>';
            return;
        }

        resultsDiv.innerHTML = results.map(item => `
            <div class="search-result-item" onclick="navigateToSection('${item.section || ''}', '${item.view || ''}')">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <strong style="color: var(--spark-orange); font-size: 1.1rem; font-family: 'JetBrains Mono', monospace;">${highlightText(item.term, query)}</strong>
                    <span style="background: var(--spark-blue); color: white; padding: 4px 12px; border-radius: 12px; font-size: 0.75rem;">${item.type}</span>
                </div>
                <div style="color: var(--text-secondary); margin-bottom: 8px;">${item.description}</div>
                <code style="background: var(--code-bg); color: var(--code-text); padding: 8px 12px; border-radius: 4px; display: block; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;">${item.example}</code>
            </div>
        `).join('');
    }

    function highlightText(text, query) {
        const regex = new RegExp(`(${query})`, 'gi');
        return text.replace(regex, '<span class="search-highlight">$1</span>');
    }

    function navigateToSection(sectionId, viewId) {
        toggleSearch(); // Close search

        // ×× ×™×© viewId ×™×©×™×¨ ××”×—×™×¤×•×©, ×”×©×ª××© ×‘×•
        if (viewId) {
            const navItem = document.querySelector(`.nav-item[onclick*="${viewId}"]`);
            if (navItem) navItem.click();
            return;
        }

        // ××—×¨×ª, × ×¡×” ×œ×§×‘×•×¢ ×œ×¤×™ sectionId
        const viewMap = {
            'rdd-': 'rdd',
            'df-': 'dataframes',
            'stream-': 'streaming',
            'adv-': 'advanced',
            'theory-': 'theory'
        };

        let targetView = 'rdd';
        for (const [prefix, view] of Object.entries(viewMap)) {
            if (sectionId.startsWith(prefix)) {
                targetView = view;
                break;
            }
        }

        // Switch to correct view
        const navItem = document.querySelector(`.nav-item[onclick*="${targetView}"]`);
        if (navItem) navItem.click();

        // Scroll to section
        setTimeout(() => {
            const section = document.getElementById(sectionId);
            if (section) {
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }, 300);
    }

    /* === SOLUTION TOGGLE === */
    function toggleSolution(button) {
        const content = button.nextElementSibling;
        content.classList.toggle('show');
        button.textContent = content.classList.contains('show') ? 'ğŸ”’ ×”×¡×ª×¨ ×¤×ª×¨×•×Ÿ' : 'ğŸ”“ ×”×¦×’ ×¤×ª×¨×•×Ÿ';
    }

    /* === COPY CODE BLOCKS === */
    document.querySelectorAll('.code-block').forEach(code => {
        code.addEventListener('click', () => {
            const text = code.textContent.trim();
            navigator.clipboard.writeText(text).then(() => {
                const notification = document.getElementById('copyNotification');
                notification.classList.add('show');
                setTimeout(() => notification.classList.remove('show'), 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
            });
        });
    });
</script>

</body>
</html>
